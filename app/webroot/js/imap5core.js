(function(){if(!window.imap5){window.imap5={};var a=window.imap5;a.div=[];a.background=[];a.foreground=[];a.usermap=[];a.map=[];a.mode=[];a.geometry=[];a.svg=[];a.g=[];a.svgcoord=[];a.zoom=[];a.zoomcontrol=[];a.panhome=[];a.zoomin=[];a.zoomout=[];a.selected=[];a.infobox=[];a.coords=[];a.selectedOverlay=[];a.selectedVerticesObj=[];a.marker=[];a.maplabel=[];a.mappath=[];a.mappoly=[];a.maprect=[];a.mapcurve=[];a.maplegend=[];a.mapabbr=[];a.geoareasize=[];a.mapbubble=[];a.mapbubblesize=[];a.piechart=
[];a.path=[];a.poly=[];a.rect=[];a.curve=[];a.groupHL=[];a.center=[];a.grouphighlight=[];a.fadeout=[];a.heatmap=[];a.categorylegend=[];a.maptitle=[];a.base=[];a.precision=6;a.factor=[];a.setMode=function(b){a.mode[b.usermap]=b.mode;da(b);if("edit"==a.mode[b.usermap])for(var c in a.maplabel[b.usermap])a.maplabel[b.usermap].hasOwnProperty(c)&&(a.maplabel[b.usermap][c].getElementsByTagName("text")[0].style.pointerEvents="auto");else for(c in a.maplabel[b.usermap])a.maplabel[b.usermap].hasOwnProperty(c)&&
(a.maplabel[b.usermap][c].getElementsByTagName("text")[0].style.pointerEvents="none");P(b)};a.setGeometry=function(b){a.usermap[b.usermap].map.geometry[b.geometry]=b.data;R(b);ea(b);V(b)};a.setGeometries=function(b){for(var c in b.geometry)b.geometry.hasOwnProperty(c)&&(a.usermap[b.usermap].map.geometry[c]=b.geometry[c],a.mapabbr[b.usermap].hasOwnProperty(c)&&(a.mapabbr[b.usermap][c].setLabel(b.geometry[c].title),"undefined"!=typeof b.geometry[c].hideAbbreviation&&(b.geometry[c].hideAbbreviation?
a.mapabbr[b.usermap][c].hide():a.mapabbr[b.usermap][c].show())),a.mapbubble[b.usermap].hasOwnProperty(c)&&(a.mapbubble[b.usermap][c]._options.bubblevalue=b.geometry[c].bubblevalue));ea(b);V(b);P(b);for(c in a.usermap[b.usermap].map.geometry)a.usermap[b.usermap].map.geometry.hasOwnProperty(c)&&R({usermap:b.usermap,geometry:c});if("undefined"!=typeof a.usermap[b.usermap].map.bubblemap&&"undefined"!=typeof a.usermap[b.usermap].map.bubblemap.enable&&a.usermap[b.usermap].map.bubblemap.enable){var h=0;
for(c in a.geometry[b.usermap])Math.abs(a.usermap[b.usermap].map.geometry[c].bubblevalue)>=h&&(h=Math.abs(a.usermap[b.usermap].map.geometry[c].bubblevalue));a.usermap[b.usermap].map.bubblemap.maxbubble=h;for(c in a.mapbubble[b.usermap])a.mapbubble[b.usermap].hasOwnProperty(c)&&a.mapbubble[b.usermap][c].drawMapBubble()}};a.setFadeOut=function(b){a.usermap[b.usermap].map.fadeout=b.fadeout;a.fadeout[b.usermap].enable=b.fadeout.enable};a.setGroupHighlight=function(b){a.usermap[b.usermap].map.grouphighlight=
b.grouphighlight;a.grouphighlight[b.usermap].enable=b.grouphighlight.enable};a.setHeatMap=function(b){a.usermap[b.usermap].map.heatmap=b.heatmap;a.heatmap[b.usermap].enable=b.heatmap.enable;V(b);for(var c in a.usermap[b.usermap].map.geometry)a.usermap[b.usermap].map.geometry.hasOwnProperty(c)&&R({usermap:b.usermap,geometry:c})};a.setCategoryLegend=function(b){var c="undefined"==typeof a.usermap[b.usermap].map.categorylegend?!1:a.usermap[b.usermap].map.categorylegend.enable;a.usermap[b.usermap].map.categorylegend=
b.categorylegend;a.usermap[b.usermap].map.categorylegend.enable?c?(a.categorylegend[b.usermap].setOptions(b.categorylegend),a.categorylegend[b.usermap].drawCategoryLegend(),a.updateCategoryLegend(b)):a.categorylegend[b.usermap]=new fa(b,a.usermap[b.usermap].map.categorylegend):c&&a.categorylegend[b.usermap].remove();P(b)};a.setMapTitle=function(b){a.usermap[b.usermap].map.maptitle=b.maptitle;"undefined"!==typeof a.maptitle[b.usermap]&&null!==a.maptitle[b.usermap]?(a.maptitle[b.usermap].setOptions(b.maptitle),
a.maptitle[b.usermap].drawMapTitle()):a.maptitle[b.usermap]=new ga(b,b.maptitle)};a.setBubbleMap=function(b){var c="undefined"==typeof a.usermap[b.usermap].map.bubblemap?!1:a.usermap[b.usermap].map.bubblemap.enable;a.usermap[b.usermap].map.bubblemap=b.bubblemap;if(a.usermap[b.usermap].map.bubblemap.enable)if(c){var c=0,h;for(h in a.geometry[b.usermap])Math.abs(a.usermap[b.usermap].map.geometry[h].bubblevalue)>=c&&(c=Math.abs(a.usermap[b.usermap].map.geometry[h].bubblevalue));a.usermap[b.usermap].map.bubblemap.maxbubble=
c;for(h in a.mapbubble[b.usermap])a.mapbubble[b.usermap].hasOwnProperty(h)&&a.mapbubble[b.usermap][h].drawMapBubble()}else{c=0;a.mapbubblesize[b.usermap].length=0;for(h in a.geometry[b.usermap])a.mapbubblesize[b.usermap].push({id:a.geometry[b.usermap][h].id,bubblesize:Math.abs(a.usermap[b.usermap].map.geometry[h].bubblevalue)}),Math.abs(a.usermap[b.usermap].map.geometry[h].bubblevalue)>=c&&(c=Math.abs(a.usermap[b.usermap].map.geometry[h].bubblevalue));a.mapbubblesize[b.usermap].sort(function(a,b){return b.bubblesize-
a.bubblesize});a.usermap[b.usermap].map.bubblemap.maxbubble=c;for(c=0;c<a.mapbubblesize[b.usermap].length;c++)if(a.mapbubblesize[b.usermap].hasOwnProperty(c)&&(h=a.mapbubblesize[b.usermap][c].id,a.geometry[b.usermap].hasOwnProperty(h))){var e={};e.lat=a.geometry[b.usermap][h].centroid.lat;e.lng=a.geometry[b.usermap][h].centroid.lng;e.bubblevalue=a.usermap[b.usermap].map.geometry[h].bubblevalue;a.mapbubble[b.usermap][h]=new ha(b,h,e)}}else if(c)for(h in a.mapbubble[b.usermap])a.mapbubble[b.usermap].hasOwnProperty(h)&&
a.mapbubble[b.usermap][h].remove()};a.setPieChart=function(b){var c="undefined"==typeof a.usermap[b.usermap].map.piechart?!1:a.usermap[b.usermap].map.piechart.enable;a.usermap[b.usermap].map.piechart=b.piechart;if(a.usermap[b.usermap].map.piechart.enable)if(c)for(var h in a.piechart[b.usermap])a.piechart[b.usermap].hasOwnProperty(h)&&a.piechart[b.usermap][h].drawPieChart();else for(h in a.geometry[b.usermap])a.geometry[b.usermap].hasOwnProperty(h)&&(c={},c.lat=a.geometry[b.usermap][h].centroid.lat,
c.lng=a.geometry[b.usermap][h].centroid.lng,c.pievalue=a.usermap[b.usermap].map.geometry[h].pievalue,a.piechart[b.usermap][h]=new ia(b,h,c));else if(c)for(h in a.piechart[b.usermap])a.piechart[b.usermap].hasOwnProperty(h)&&a.piechart[b.usermap][h].remove()};a.setZoomSetting=function(b){for(var c in b.zoom_setting)b.zoom_setting.hasOwnProperty(c)&&(a.usermap[b.usermap].map.zoom_setting[c]=b.zoom_setting[c]);a.panhome[b.usermap].style.visibility="undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.homeControl?
a.usermap[b.usermap].map.zoom_setting.homeControl?"visible":"hidden":"visible";a.zoomin[b.usermap].style.visibility="undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.zoomControl?a.usermap[b.usermap].map.zoom_setting.zoomControl?"visible":"hidden":"visible";a.zoomout[b.usermap].style.visibility="undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.zoomControl?a.usermap[b.usermap].map.zoom_setting.zoomControl?"visible":"hidden":"visible"};a.setMarkers=function(b){for(var c in b.marker)b.marker.hasOwnProperty(c)&&
(a.usermap[b.usermap].map.marker[c]=b.marker[c],"undefined"!==typeof a.marker[b.usermap][c]&&null!==a.marker[b.usermap][c]?(a.marker[b.usermap][c].setOptions(b.marker[c]),a.marker[b.usermap][c].drawMarker()):a.marker[b.usermap][c]=new ja(b,c,b.marker[c]),a.marker[b.usermap][c].toggleCategory())};a.delMarkers=function(b){a.marker[b.usermap][b.id].remove()};a.setMapLabels=function(b){for(var c in b.maplabel)b.maplabel.hasOwnProperty(c)&&(a.usermap[b.usermap].map.maplabel[c]=b.maplabel[c],"undefined"!==
typeof a.maplabel[b.usermap][c]&&null!==a.maplabel[b.usermap][c]?(a.maplabel[b.usermap][c].setOptions(b.maplabel[c]),a.maplabel[b.usermap][c].drawMapLabel()):a.maplabel[b.usermap][c]=new ka(b,c,b.maplabel[c]),a.maplabel[b.usermap][c].toggleCategory())};a.delMapLabels=function(b){a.maplabel[b.usermap][b.id].remove()};a.setMapPaths=function(b){for(var c in b.mappath)b.mappath.hasOwnProperty(c)&&(a.usermap[b.usermap].map.mappath[c]=b.mappath[c],"undefined"!==typeof a.mappath[b.usermap][c]&&null!==a.mappath[b.usermap][c]?
(a.mappath[b.usermap][c].setOptions(b.mappath[c]),a.mappath[b.usermap][c].drawMapPath()):a.mappath[b.usermap][c]=new W(b,c,b.mappath[c]),a.mappath[b.usermap][c].toggleCategory())};a.delMapPaths=function(b){a.selectedVerticesObj[b.usermap]==a.mappath[b.usermap][b.id]&&(a.selectedVerticesObj[b.usermap]=null);a.mappath[b.usermap][b.id].remove()};a.selectMapPaths=function(b){a.mappath[b.usermap][b.id].createVertices()};a.setMapPolys=function(b){for(var c in b.mappoly)b.mappoly.hasOwnProperty(c)&&(a.usermap[b.usermap].map.mappoly[c]=
b.mappoly[c],"undefined"!==typeof a.mappoly[b.usermap][c]&&null!==a.mappoly[b.usermap][c]?(a.mappoly[b.usermap][c].setOptions(b.mappoly[c]),a.mappoly[b.usermap][c].drawMapPoly()):a.mappoly[b.usermap][c]=new X(b,c,b.mappoly[c]),a.mappoly[b.usermap][c].toggleCategory())};a.delMapPolys=function(b){a.selectedVerticesObj[b.usermap]==a.mappoly[b.usermap][b.id]&&(a.selectedVerticesObj[b.usermap]=null);a.mappoly[b.usermap][b.id].remove()};a.selectMapPolys=function(b){a.mappoly[b.usermap][b.id].createVertices()};
a.setMapRects=function(b){for(var c in b.maprect)b.maprect.hasOwnProperty(c)&&(a.usermap[b.usermap].map.maprect[c]=b.maprect[c],"undefined"!==typeof a.maprect[b.usermap][c]&&null!==a.maprect[b.usermap][c]?(a.maprect[b.usermap][c].setOptions(b.maprect[c]),a.maprect[b.usermap][c].drawMapRect()):a.maprect[b.usermap][c]=new Y(b,c,b.maprect[c]),a.maprect[b.usermap][c].toggleCategory())};a.delMapRects=function(b){a.selectedVerticesObj[b.usermap]==a.maprect[b.usermap][b.id]&&(a.selectedVerticesObj[b.usermap]=
null);a.maprect[b.usermap][b.id].remove()};a.selectMapRects=function(b){a.maprect[b.usermap][b.id].createVertices()};a.setMapCurves=function(b){for(var c in b.mapcurve)b.mapcurve.hasOwnProperty(c)&&(a.usermap[b.usermap].map.mapcurve[c]=b.mapcurve[c],"undefined"!==typeof a.mapcurve[b.usermap][c]&&null!==a.mapcurve[b.usermap][c]?(a.mapcurve[b.usermap][c].setOptions(b.mapcurve[c]),a.mapcurve[b.usermap][c].drawMapCurve()):a.mapcurve[b.usermap][c]=new Z(b,c,b.mapcurve[c]),a.mapcurve[b.usermap][c].toggleCategory())};
a.delMapCurves=function(b){a.selectedVerticesObj[b.usermap]==a.mapcurve[b.usermap][b.id]&&(a.selectedVerticesObj[b.usermap]=null);a.mapcurve[b.usermap][b.id].remove()};a.selectMapCurves=function(b){a.mapcurve[b.usermap][b.id].createVertices()};a.setMapLegends=function(b){for(var c in b.maplegend)b.maplegend.hasOwnProperty(c)&&(a.usermap[b.usermap].map.maplegend[c]=b.maplegend[c],"undefined"!==typeof a.maplegend[b.usermap][c]&&null!==a.maplegend[b.usermap][c]?(a.maplegend[b.usermap][c].setOptions(b.maplegend[c]),
a.maplegend[b.usermap][c].drawMapLegend()):a.maplegend[b.usermap][c]=new la(b,c,b.maplegend[c]),a.maplegend[b.usermap][c].toggleCategory())};a.delMapLegends=function(b){a.maplegend[b.usermap][b.id].remove()};a.initUserMap=function(b){a.usermap[b.id]=b};a.initMap=function(b){a.map[b.id]=b};a.init=function(b){b.base||(b.base="");if(b.usermap&&(a.touchdevices="ontouchstart"in document.documentElement&&null==navigator.userAgent.match(/Windows NT/i),a.mode[b.usermap]="normal",a.geometry[b.usermap]=[],
a.selected[b.usermap]=[],a.infobox[b.usermap]=[],a.coords[b.usermap]=[],a.selectedOverlay[b.usermap]=null,a.selectedVerticesObj[b.usermap]=null,a.marker[b.usermap]=[],a.maplabel[b.usermap]=[],a.mappath[b.usermap]=[],a.mappoly[b.usermap]=[],a.maprect[b.usermap]=[],a.mapcurve[b.usermap]=[],a.maplegend[b.usermap]=[],a.mapabbr[b.usermap]=[],a.geoareasize[b.usermap]=[],a.mapbubble[b.usermap]=[],a.mapbubblesize[b.usermap]=[],a.piechart[b.usermap]=[],a.path[b.usermap]=[],a.poly[b.usermap]=[],a.rect[b.usermap]=
[],a.curve[b.usermap]=[],a.groupHL[b.usermap]=[],a.grouphighlight[b.usermap]={},a.fadeout[b.usermap]={},a.heatmap[b.usermap]={},a.categorylegend[b.usermap]={},a.maptitle[b.usermap]={},a.base[b.usermap]=b.base,a.factor[b.usermap]=1,document.writeln("\x3c!--[if lt IE 9]>"),document.writeln("<div>You can only view this map using Internet Explorer 9 or above, please upgrade or use other modern browsers like chrome, firefox or safari</div>"),document.writeln("<![endif]--\x3e"),document.writeln('<div id="imap5_'+
b.usermap+'"></div>'),a.div[b.usermap]=document.getElementById("imap5_"+b.usermap),b.local)){a.local=!0;var c=document.createElement("script");c.type="application/javascript";c.src=b.base+"imap5usermap_"+b.usermap+".js?"+Math.random(1E5);c.onerror=function(){};c.onload=function(){ta(b)};document.body.appendChild(c)}};a.updateCategoryLegend=function(a){P(a)};var S=function(a,c,h,e){var f,d=(e.x-h.x)*(a.y-h.y)-(e.y-h.y)*(a.x-h.x);f=(c.x-a.x)*(a.y-h.y)-(c.y-a.y)*(a.x-h.x);a=(e.y-h.y)*(c.x-a.x)-(e.x-
h.x)*(c.y-a.y);0!=a?(d/=a,f/=a,f=0<=d&&1>=d&&0<=f&&1>=f?!0:!1):f=!1;return f},ua=function(a,c,h,e){return T({x:a.x,y:a.y},{x:a.x,y:c.y},h,e)||T({x:a.x,y:c.y},{x:c.x,y:c.y},h,e)||T({x:c.x,y:c.y},{x:c.x,y:a.y},h,e)||T({x:c.x,y:a.y},{x:a.x,y:a.y},h,e)?!0:!1},T=function(a,c,h,e){return S({x:h.x,y:h.y},{x:h.x,y:e.y},a,c)||S({x:h.x,y:e.y},{x:e.x,y:e.y},a,c)||S({x:e.x,y:e.y},{x:e.x,y:h.y},a,c)||S({x:e.x,y:h.y},{x:h.x,y:h.y},a,c)?!0:!1},va=function(b){var c=0,h=0,e=0;if(3<b.length){for(var f=0;f<b.length-
1;f++)b.hasOwnProperty(f)&&(e+=(b[f].lng+b[f+1].lng)*(b[f].lng*q(b[f+1].lat)-b[f+1].lng*q(b[f].lat)),h+=(q(b[f].lat)+q(b[f+1].lat))*(b[f].lng*q(b[f+1].lat)-b[f+1].lng*q(b[f].lat)),c=c+b[f].lng*q(b[f+1].lat)-b[f+1].lng*q(b[f].lat));c/=2;h=l(L(h/(6*c)),a.precision);e=l(e/(6*c),a.precision)}else h=l(b[0].lat,a.precision),e=l(b[0].lng,a.precision);return{lat:h,lng:e}},x=function(a){89.5<a&&(a=89.5);-89.5>a&&(a=-89.5);return a},w=function(a){180<a&&(a=-180+(a-180)%360);-180>a&&(a=180+(a+180)%360);return a},
M=function(a,c){return 89.5<a||-89.5>a||180<c||-180>c},wa=function(a,c){var h=Math.max(Math.abs(a/32768),Math.abs(c/32768));return h=1<h?2*Math.round(h):1},s=function(b,c,h){var e;document.getElementById("imap5_"+b.usermap+"_hint")?e=document.getElementById("imap5_"+b.usermap+"_hint"):(e=document.createElement("div"),e.id="imap5_"+b.usermap+"_hint",a.div[b.usermap].appendChild(e));e.style.backgroundColor="#FFFF88";e.style.pointerEvents="none";e.style.position="fixed";e.style.padding="2px";e.style.margin=
"5px";e.style.border="1px solid gray";e.style.borderRadius="5px";e.style.top=c.clientY+10+"px";e.style.left=c.clientX+10+"px";e.style.font="12px Arial";e.style.display="block";e.innerHTML=h},C=function(a){divhint=document.getElementById("imap5_"+a.usermap+"_hint");divhint.style.display="none"},F=function(a){return parseInt($(a).substring(0,2),16)},G=function(a){return parseInt($(a).substring(2,4),16)},H=function(a){return parseInt($(a).substring(4,6),16)},$=function(a){return"#"==a.charAt(0)?a.substring(1,
7):a},N=function(a,c){for(var h=parseInt(a).toString(16),e=c-h.length,f=0;f<e;f++)h="0"+h;return h},aa=function(a,c,h){var e,f,d;e=F(a);f=G(a);d=H(a);var k;a=F(c);k=G(c);c=H(c);f+=(k-f)*h/100;d+=(c-d)*h/100;return"#"+N(e+(a-e)*h/100,2)+N(f,2)+N(d,2)},ba=function(a,c,h){var e,f=c.length;if(a<c[0])e=h[0];else if(a>=c[f-1])e=h[f];else for(var d=0;d<f-1;d++)if(a>=c[d]&&a<c[d+1]){e=h[d+1];break}return e},ma=function(b){var c=0,h=0,e;for(e in a.usermap[b.usermap].map.geometry)!a.usermap[b.usermap].map.geometry.hasOwnProperty(e)||
"undefined"!=typeof a.usermap[b.usermap].map.geometry[e].disableHeatMap&&a.usermap[b.usermap].map.geometry[e].disableHeatMap||(a.usermap[b.usermap].map.geometry[e].heatvalue<c&&(c=a.usermap[b.usermap].map.geometry[e].heatvalue),a.usermap[b.usermap].map.geometry[e].heatvalue>h&&(h=a.usermap[b.usermap].map.geometry[e].heatvalue));return{hmin:c,hmax:h}},D=function(b,c){return _result=a.heatmap[b.usermap].enable?"undefined"!=typeof a.usermap[b.usermap].map.geometry[c].disableHeatMap&&a.usermap[b.usermap].map.geometry[c].disableHeatMap?
a.usermap[b.usermap].map.geometry[c].fill:"continuous"==a.usermap[b.usermap].map.heatmap.heattype?aa(a.usermap[b.usermap].map.heatmap.continuous.startcolor,a.usermap[b.usermap].map.heatmap.continuous.endcolor,a.heatmap[b.usermap].hmax==a.heatmap[b.usermap].hmin?0:100*((a.usermap[b.usermap].map.geometry[c].heatvalue+Math.abs(a.heatmap[b.usermap].hmin))/(a.heatmap[b.usermap].hmax-a.heatmap[b.usermap].hmin))):ba(a.usermap[b.usermap].map.geometry[c].heatvalue,a.usermap[b.usermap].map.heatmap.discrete.rangeset.split(","),
a.usermap[b.usermap].map.heatmap.discrete.colorset.split(",")):a.usermap[b.usermap].map.geometry[c].fill},O=function(b,c){return _result=a.heatmap[b.usermap].enable?"undefined"!=typeof a.usermap[b.usermap].map.geometry[c].disableHeatMap&&a.usermap[b.usermap].map.geometry[c].disableHeatMap?a.usermap[b.usermap].map.geometry[c].fill_mouseover:"continuous"==a.usermap[b.usermap].map.heatmap.heattype?a.usermap[b.usermap].map.heatmap.continuous.highlightcolor:a.usermap[b.usermap].map.heatmap.discrete.highlightcolor:
a.usermap[b.usermap].map.geometry[c].fill_mouseover},l=function(a,c){var h=Math.pow(10,c);return Math.round(a*h)/h},na=function(a,c){var h=c.x-a.x,e=c.y-a.y;return Math.sqrt(h*h+e*e)},I=function(a,c){for(var h=c*Math.pow(1/1.5,4),e=-1,f=1;20>f;f++)if(0.1>Math.abs(a-h*Math.pow(1.5,f))){e=f+1;break}return e},ea=function(b){a.groupHL[b.usermap]=[];for(var c in a.geometry[b.usermap])a.geometry[b.usermap].hasOwnProperty(c)&&(a.geometry[b.usermap][c].group={},a.geometry[b.usermap][c].group.id="undefined"==
typeof a.usermap[b.usermap].map.geometry[c].group?0:a.usermap[b.usermap].map.geometry[c].group,"undefined"==typeof a.groupHL[b.usermap][a.geometry[b.usermap][c].group.id]&&(a.groupHL[b.usermap][a.geometry[b.usermap][c].group.id]=[]),a.groupHL[b.usermap][a.geometry[b.usermap][c].group.id].push(c))},V=function(b){if(a.heatmap[b.usermap].enable)if("continuous"==a.usermap[b.usermap].map.heatmap.heattype){var c={},c=ma(b);a.heatmap[b.usermap].hmin=c.hmin;a.heatmap[b.usermap].hmax=c.hmax}else{var c=a.usermap[b.usermap].map.heatmap.discrete.rangeset.split(",").length,
h=a.usermap[b.usermap].map.heatmap.discrete.colorset.split(",").length;0<c&&0<h&&h==c+1||(a.heatmap[b.usermap].enable=!1)}},P=function(b){for(var c in a.usermap[b.usermap].map.mappoly)a.usermap[b.usermap].map.mappoly.hasOwnProperty(c)&&a.mappoly[b.usermap].hasOwnProperty(c)&&a.mappoly[b.usermap][c].toggleCategory();for(c in a.usermap[b.usermap].map.maprect)a.usermap[b.usermap].map.maprect.hasOwnProperty(c)&&a.maprect[b.usermap].hasOwnProperty(c)&&a.maprect[b.usermap][c].toggleCategory();for(c in a.usermap[b.usermap].map.mappath)a.usermap[b.usermap].map.mappath.hasOwnProperty(c)&&
a.mappath[b.usermap].hasOwnProperty(c)&&a.mappath[b.usermap][c].toggleCategory();for(c in a.usermap[b.usermap].map.mapcurve)a.usermap[b.usermap].map.mapcurve.hasOwnProperty(c)&&a.mapcurve[b.usermap].hasOwnProperty(c)&&a.mapcurve[b.usermap][c].toggleCategory();for(c in a.usermap[b.usermap].map.maplabel)a.usermap[b.usermap].map.maplabel.hasOwnProperty(c)&&a.maplabel[b.usermap].hasOwnProperty(c)&&a.maplabel[b.usermap][c].toggleCategory();for(c in a.usermap[b.usermap].map.marker)a.usermap[b.usermap].map.marker.hasOwnProperty(c)&&
a.marker[b.usermap].hasOwnProperty(c)&&a.marker[b.usermap][c].toggleCategory();for(c in a.usermap[b.usermap].map.maplegend)a.usermap[b.usermap].map.maplegend.hasOwnProperty(c)&&a.maplegend[b.usermap].hasOwnProperty(c)&&a.maplegend[b.usermap][c].toggleCategory()},R=function(b){"undefined"!=typeof a.usermap[b.usermap].map.geometry[b.geometry]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[b.geometry].fill&&(a.heatmap[b.usermap].enable?"undefined"!=typeof a.usermap[b.usermap].map.geometry[b.geometry].disableHeatMap&&
a.usermap[b.usermap].map.geometry[b.geometry].disableHeatMap?a.geometry[b.usermap].hasOwnProperty(b.geometry)&&a.geometry[b.usermap][b.geometry].setAttribute("fill",a.usermap[b.usermap].map.geometry[b.geometry].fill):"continuous"==a.usermap[b.usermap].map.heatmap.heattype?a.geometry[b.usermap].hasOwnProperty(b.geometry)&&a.geometry[b.usermap][b.geometry].setAttribute("fill",aa(a.usermap[b.usermap].map.heatmap.continuous.startcolor,a.usermap[b.usermap].map.heatmap.continuous.endcolor,a.heatmap[b.usermap].hmax==
a.heatmap[b.usermap].hmin?0:100*((a.usermap[b.usermap].map.geometry[b.geometry].heatvalue+Math.abs(a.heatmap[b.usermap].hmin))/(a.heatmap[b.usermap].hmax-a.heatmap[b.usermap].hmin)))):a.geometry[b.usermap].hasOwnProperty(b.geometry)&&a.geometry[b.usermap][b.geometry].setAttribute("fill",ba(a.usermap[b.usermap].map.geometry[b.geometry].heatvalue,a.usermap[b.usermap].map.heatmap.discrete.rangeset.split(","),a.usermap[b.usermap].map.heatmap.discrete.colorset.split(","))):a.geometry[b.usermap].hasOwnProperty(b.geometry)&&
a.geometry[b.usermap][b.geometry].setAttribute("fill",a.usermap[b.usermap].map.geometry[b.geometry].fill))},r=function(a){return document.createElementNS("http://www.w3.org/2000/svg",a)},da=function(b){if("edit"==a.mode[b.usermap])for(var c in a.geometry[b.usermap])a.geometry[b.usermap].hasOwnProperty(c)&&(a.geometry[b.usermap][c].style.cursor="pointer");else for(c in a.geometry[b.usermap])if(a.geometry[b.usermap].hasOwnProperty(c)){var h=a.geometry[b.usermap][c].id;a.geometry[b.usermap][c].style.cursor=
"undefined"!=typeof a.usermap[b.usermap].map.geometry[h]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[h].link?"pointer":"auto"}},ta=function(b){var c=a.usermap[b.usermap].map.id,h=a.usermap[b.usermap].map.lat,e=a.usermap[b.usermap].map.lng,f=a.usermap[b.usermap].map.zoom;a.zoom[b.usermap]={};a.zoom[b.usermap].initzoom="undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.init?l(a.usermap[b.usermap].map.zoom_setting.init.zoom,a.precision):l(f,a.precision);a.zoom[b.usermap].initlat="undefined"!=
typeof a.usermap[b.usermap].map.zoom_setting.init?l(a.usermap[b.usermap].map.zoom_setting.init.lat,a.precision):l(h,a.precision);a.zoom[b.usermap].initlng="undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.init?l(a.usermap[b.usermap].map.zoom_setting.init.lng,a.precision):l(e,a.precision);"undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.editing?(a.zoom[b.usermap].loadeditingsetting=!0,a.zoom[b.usermap].currentzoom=l(a.usermap[b.usermap].map.zoom_setting.editing.zoom,a.precision),a.zoom[b.usermap].currentx=
l(a.usermap[b.usermap].map.zoom_setting.editing.x,a.precision),a.zoom[b.usermap].currenty=l(a.usermap[b.usermap].map.zoom_setting.editing.y,a.precision)):(a.zoom[b.usermap].loadeditingsetting=!1,a.zoom[b.usermap].currentzoom=l(f,a.precision),a.zoom[b.usermap].currentlat=l(h,a.precision),a.zoom[b.usermap].currentlng=l(e,a.precision));a.zoom[b.usermap].currentzoomlevel=I(a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].initzoom);a.div[b.usermap].style.width=a.usermap[b.usermap].div.style.width;a.div[b.usermap].style.height=
a.usermap[b.usermap].div.style.height;a.div[b.usermap].style.position="relative";if(!a.touchdevices&&(a.div[b.usermap].onmousemove=function(d){if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmousemove(d);"marker"==a.mode[b.usermap]&&(this.style.cursor="pointer",s(b,d,"Click to add a marker"));"maplabel"==a.mode[b.usermap]&&(this.style.cursor="pointer",s(b,d,"Click to add a map label"));if("mappath"==a.mode[b.usermap])if("undefined"!=typeof a.path[b.usermap][1]&&null!==a.path[b.usermap][1]){if("undefined"!=
typeof a.coords[b.usermap]&&0<a.coords[b.usermap].length){this.style.cursor="pointer";s(b,d,"Right Click to end a map path");var g=a.svgcoord[b.usermap];g.x=d.clientX;g.y=d.clientY;g=v(g,a.g[b.usermap]);g.x/=a.map[c].precision/a.factor[b.usermap];g.y/=a.map[c].precision/a.factor[b.usermap];var k=g.x,g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k);a.path[b.usermap][1]._movingpoints=g+","+k;a.path[b.usermap][1].drawMapPath()}}else this.style.cursor=
"pointer",s(b,d,"Click to start a map path");"mappoly"==a.mode[b.usermap]&&("undefined"!=typeof a.poly[b.usermap][1]&&null!==a.poly[b.usermap][1]?"undefined"!=typeof a.coords[b.usermap]&&0<a.coords[b.usermap].length&&(this.style.cursor="pointer",1<a.coords[b.usermap].length&&s(b,d,"Right Click to end a polygon"),g=a.svgcoord[b.usermap],g.x=d.clientX,g.y=d.clientY,g=v(g,a.g[b.usermap]),g.x/=a.map[c].precision/a.factor[b.usermap],g.y/=a.map[c].precision/a.factor[b.usermap],k=g.x,g=360*(Math.atan(Math.pow(Math.E,
g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k),a.poly[b.usermap][1]._movingpoints=g+","+k,a.poly[b.usermap][1].drawMapPoly()):(this.style.cursor="pointer",s(b,d,"Click to start a polygon")));"maprect"==a.mode[b.usermap]&&("undefined"!=typeof a.rect[b.usermap][1]&&null!==a.rect[b.usermap][1]?"undefined"!=typeof a.coords[b.usermap]&&1==a.coords[b.usermap].length&&(this.style.cursor="pointer",s(b,d,"Right Click to end a rectangle"),g=a.svgcoord[b.usermap],g.x=d.clientX,g.y=d.clientY,
g=v(g,a.g[b.usermap]),g.x/=a.map[c].precision/a.factor[b.usermap],g.y/=a.map[c].precision/a.factor[b.usermap],k=g.x,g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k),a.rect[b.usermap][1]._movingpoints=g+","+k,a.rect[b.usermap][1].drawMapRect()):(this.style.cursor="pointer",s(b,d,"Click to start a rectangle")));"mapcurve"==a.mode[b.usermap]&&("undefined"!=typeof a.curve[b.usermap][1]&&null!==a.curve[b.usermap][1]?"undefined"!=typeof a.coords[b.usermap]&&
0<a.coords[b.usermap].length&&(this.style.cursor="pointer",1<a.coords[b.usermap].length?s(b,d,"Right Click to confirm the curvature"):s(b,d,"Click to define the end point of a curve"),g=a.svgcoord[b.usermap],g.x=d.clientX,g.y=d.clientY,g=v(g,a.g[b.usermap]),g.x/=a.map[c].precision/a.factor[b.usermap],g.y/=a.map[c].precision/a.factor[b.usermap],k=g.x,g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k),a.curve[b.usermap][1]._movingpoints=g+","+k,
a.curve[b.usermap][1].drawMapCurve()):(this.style.cursor="pointer",s(b,d,"Click to define the starting point of a curve")));d.preventDefault&&d.preventDefault();a.usermap[b.usermap].map.zoom_setting.draggable&&this._mousedown&&(10<Math.abs(d.pageX-this._mousepositionx)||10<Math.abs(d.pageY-this._mousepositiony))&&(this._mapdragged=!0,k=(this._mousepositionx-d.pageX)/a.zoom[b.usermap].currentzoom,g=(this._mousepositiony-d.pageY)/a.zoom[b.usermap].currentzoom,this._mousepositionx=d.pageX,this._mousepositiony=
d.pageY,a.zoom[b.usermap].currentx=l(a.zoom[b.usermap].currentx+k,a.precision),a.zoom[b.usermap].currenty=l(a.zoom[b.usermap].currenty-g,a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx))},a.div[b.usermap].onmousedown=function(a){a.preventDefault&&a.preventDefault();this._mousepositionx=a.pageX;this._mousepositiony=a.pageY;this._mousedown=!0;this._mapdragged=!1},a.div[b.usermap].onmouseup=function(a){a.preventDefault&&a.preventDefault();this._mousedown=
!1;this._mousepositiony=this._mousepositionx=0},a.div[b.usermap].onmousewheel=function(d){d.preventDefault&&d.preventDefault();if(a.usermap[b.usermap].map.zoom_setting.mouseWheel){a.zoom[b.usermap].prevzoom=a.zoom[b.usermap].currentzoom;var g=a.zoom[b.usermap].currentzoom;d||(d=window.event);var k=I(a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].initzoom);d.wheelDelta&&(0<d.wheelDelta?20>k&&(a.zoom[b.usermap].currentzoom=l(1.5*a.zoom[b.usermap].currentzoom,a.precision)):1<k&&(a.zoom[b.usermap].currentzoom=
l(a.zoom[b.usermap].currentzoom/1.5,a.precision)));var e=a.svgcoord[b.usermap];e.x=d.clientX;e.y=d.clientY;for(var e=v(e,a.g[b.usermap]),f=this,h=0,n=0;f;)h+=f.offsetLeft,n+=f.offsetTop,f=f.offsetParent;e.x/=a.map[c].precision/a.factor[b.usermap];e.y/=a.map[c].precision/a.factor[b.usermap];f=e.x;e=360*(Math.atan(Math.pow(Math.E,e.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;M(e,f)?a.zoom[b.usermap].currentzoom=l(g,a.precision):0<d.wheelDelta?20>k&&(a.zoom[b.usermap].currentx=l(a.zoom[b.usermap].currentx-
0.5*((parseFloat(this.style.width)/2-(d.pageX-h))/a.zoom[b.usermap].currentzoom),a.precision),a.zoom[b.usermap].currenty=l(a.zoom[b.usermap].currenty+0.5*((parseFloat(this.style.height)/2-(d.pageY-n))/a.zoom[b.usermap].currentzoom),a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx)):1<k&&(a.zoom[b.usermap].currentx=l(a.zoom[b.usermap].currentx+(parseFloat(this.style.width)/2-(d.pageX-h))/a.zoom[b.usermap].currentzoom*(1-1/1.5),a.precision),a.zoom[b.usermap].currenty=
l(a.zoom[b.usermap].currenty-(parseFloat(this.style.height)/2-(d.pageY-n))/a.zoom[b.usermap].currentzoom*(1-1/1.5),a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx))}},a.div[b.usermap].addEventListener)){a.setMouseWheelEvent=function(a){d(a)};var d=function(d){d.preventDefault&&d.preventDefault();if(a.usermap[b.usermap].map.zoom_setting.mouseWheel){a.zoom[b.usermap].prevzoom=a.zoom[b.usermap].currentzoom;var g=a.zoom[b.usermap].currentzoom;d||(d=
window.event);var k=I(a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].initzoom);d.detail&&(0>d.detail?20>k&&(a.zoom[b.usermap].currentzoom=l(1.5*a.zoom[b.usermap].currentzoom,a.precision)):1<k&&(a.zoom[b.usermap].currentzoom=l(a.zoom[b.usermap].currentzoom/1.5,a.precision)));var e=a.svgcoord[b.usermap];e.x=d.pageX;e.y=d.pageY;for(var e=v(e,a.g[b.usermap]),f=this,h=0,n=0;f;)h+=f.offsetLeft,n+=f.offsetTop,f=f.offsetParent;e.x/=a.map[c].precision/a.factor[b.usermap];e.y/=a.map[c].precision/a.factor[b.usermap];
f=e.x;e=360*(Math.atan(Math.pow(Math.E,e.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;M(e,f)?a.zoom[b.usermap].currentzoom=l(g,a.precision):0>d.detail?20>k&&(a.zoom[b.usermap].currentx=l(a.zoom[b.usermap].currentx-0.5*((parseInt(this.style.width)/2-(d.pageX-h))/a.zoom[b.usermap].currentzoom),a.precision),a.zoom[b.usermap].currenty=l(a.zoom[b.usermap].currenty+0.5*((parseInt(this.style.height)/2-(d.pageY-n))/a.zoom[b.usermap].currentzoom),a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,
a.zoom[b.usermap].currentx)):1<k&&(a.zoom[b.usermap].currentx=l(a.zoom[b.usermap].currentx+(parseInt(this.style.width)/2-(d.pageX-h))/a.zoom[b.usermap].currentzoom*(1-1/1.5),a.precision),a.zoom[b.usermap].currenty=l(a.zoom[b.usermap].currenty-(parseInt(this.style.height)/2-(d.pageY-n))/a.zoom[b.usermap].currentzoom*(1-1/1.5),a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx))}};a.div[b.usermap].addEventListener("DOMMouseScroll",d,!1)}a.touchdevices||
(a.div[b.usermap].oncontextmenu=function(d){if("mappath"==a.mode[b.usermap]){if(0<a.coords[b.usermap].length){var g=a.svgcoord[b.usermap];g.x=d.clientX;g.y=d.clientY;g=v(g,a.g[b.usermap]);g.x/=a.map[c].precision/a.factor[b.usermap];g.y/=a.map[c].precision/a.factor[b.usermap];d=g.x;g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;g=x(g);d=w(d);a.coords[b.usermap].push(l(g,a.precision)+","+l(d,a.precision));a.path[b.usermap][1]._movingpoints="";a.path[b.usermap][1].drawMapPath();
d="";for(g=0;g<a.coords[b.usermap].length;g++)""!=d&&(d+=" "),d+=a.coords[b.usermap][g];var g=0,k;for(k in a.mappath[b.usermap])a.mappath[b.usermap].hasOwnProperty(k)&&"undefined"!==typeof a.mappath[b.usermap][k]&&null!==a.mappath[b.usermap][k]&&a.mappath[b.usermap][k]._id>g&&(g=Number(a.mappath[b.usermap][k]._id));k={event:"newmappath",object:"mappath"};k.points=d;k.id=g+1;window.console&&console.log(JSON.stringify(k));a.coords[b.usermap].length=0;a.g[b.usermap].removeChild(a.path[b.usermap][1]);
a.path[b.usermap][1]=null}return!1}if("mappoly"==a.mode[b.usermap]){if(1<a.coords[b.usermap].length){g=a.svgcoord[b.usermap];g.x=d.clientX;g.y=d.clientY;g=v(g,a.g[b.usermap]);g.x/=a.map[c].precision/a.factor[b.usermap];g.y/=a.map[c].precision/a.factor[b.usermap];d=g.x;g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;g=x(g);d=w(d);a.coords[b.usermap].push(l(g,a.precision)+","+l(d,a.precision));a.poly[b.usermap][1]._movingpoints="";a.poly[b.usermap][1].drawMapPoly();
d="";for(g=0;g<a.coords[b.usermap].length;g++)""!=d&&(d+=" "),d+=a.coords[b.usermap][g];g=0;for(k in a.mappoly[b.usermap])a.mappoly[b.usermap].hasOwnProperty(k)&&"undefined"!==typeof a.mappoly[b.usermap][k]&&null!==a.mappoly[b.usermap][k]&&a.mappoly[b.usermap][k]._id>g&&(g=Number(a.mappoly[b.usermap][k]._id));g+=1;k={event:"newmappoly",object:"mappoly"};k.points=d;k.id=g;window.console&&console.log(JSON.stringify(k));a.coords[b.usermap].length=0;a.g[b.usermap].removeChild(a.poly[b.usermap][1]);a.poly[b.usermap][1]=
null}return!1}if("maprect"==a.mode[b.usermap]){if(1==a.coords[b.usermap].length){g=a.svgcoord[b.usermap];g.x=d.clientX;g.y=d.clientY;g=v(g,a.g[b.usermap]);g.x/=a.map[c].precision/a.factor[b.usermap];g.y/=a.map[c].precision/a.factor[b.usermap];d=g.x;g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;g=x(g);d=w(d);var e=a.coords[b.usermap][0].split(",")[0],f=a.coords[b.usermap][0].split(",")[1];a.coords[b.usermap].push(l(e,a.precision)+","+l(d,a.precision));a.coords[b.usermap].push(l(g,
a.precision)+","+l(d,a.precision));a.coords[b.usermap].push(l(g,a.precision)+","+l(f,a.precision));a.rect[b.usermap][1]._movingpoints="";a.rect[b.usermap][1].drawMapRect();d="";for(g=0;g<a.coords[b.usermap].length;g++)""!=d&&(d+=" "),d+=a.coords[b.usermap][g];g=0;for(k in a.maprect[b.usermap])a.maprect[b.usermap].hasOwnProperty(k)&&"undefined"!==typeof a.maprect[b.usermap][k]&&null!==a.maprect[b.usermap][k]&&a.maprect[b.usermap][k]._id>g&&(g=Number(a.maprect[b.usermap][k]._id));g+=1;k={event:"newmaprect",
object:"maprect"};k.points=d;k.id=g;window.console&&console.log(JSON.stringify(k));a.coords[b.usermap].length=0;a.g[b.usermap].removeChild(a.rect[b.usermap][1]);a.rect[b.usermap][1]=null}return!1}if("mapcurve"==a.mode[b.usermap]){if(1<a.coords[b.usermap].length){g=a.svgcoord[b.usermap];g.x=d.clientX;g.y=d.clientY;g=v(g,a.g[b.usermap]);g.x/=a.map[c].precision/a.factor[b.usermap];g.y/=a.map[c].precision/a.factor[b.usermap];d=g.x;g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-
Math.PI/4)/Math.PI;g=x(g);d=w(d);a.coords[b.usermap].push(l(g,a.precision)+","+l(d,a.precision));a.curve[b.usermap][1]._movingpoints="";a.curve[b.usermap][1].drawMapCurve();d="";for(g=0;g<a.coords[b.usermap].length;g++)""!=d&&(d+=" "),d+=a.coords[b.usermap][g];g=0;for(k in a.mapcurve[b.usermap])a.mapcurve[b.usermap].hasOwnProperty(k)&&"undefined"!==typeof a.mapcurve[b.usermap][k]&&null!==a.mapcurve[b.usermap][k]&&a.mapcurve[b.usermap][k]._id>g&&(g=Number(a.mapcurve[b.usermap][k]._id));g+=1;k={event:"newmapcurve",
object:"mapcurve"};k.points=d;k.id=g;window.console&&console.log(JSON.stringify(k));a.coords[b.usermap].length=0;a.g[b.usermap].removeChild(a.curve[b.usermap][1]);a.curve[b.usermap][1]=null}return!1}},a.div[b.usermap].onclick=function(d){if(!this._mapdragged&&!this._transformed&&"normal"!=a.mode[b.usermap]&&"edit"!=a.mode[b.usermap]){if("marker"==a.mode[b.usermap]){var g=a.svgcoord[b.usermap];g.x=d.clientX;g.y=d.clientY;g=v(g,a.g[b.usermap]);g.x/=a.map[c].precision/a.factor[b.usermap];g.y/=a.map[c].precision/
a.factor[b.usermap];var k=g.x,g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k),e=0,f;for(f in a.marker[b.usermap])a.marker[b.usermap].hasOwnProperty(f)&&"undefined"!==typeof a.marker[b.usermap][f]&&null!==a.marker[b.usermap][f]&&a.marker[b.usermap][f]._id>e&&(e=Number(a.marker[b.usermap][f]._id));var e=e+1,h={event:"newmarker",object:"marker"};h.lat=l(g,a.precision);h.lng=l(k,a.precision);h.id=e;window.console&&console.log(JSON.stringify(h))}if("maplabel"==
a.mode[b.usermap]){g=a.svgcoord[b.usermap];g.x=d.clientX;g.y=d.clientY;g=v(g,a.g[b.usermap]);g.x/=a.map[c].precision/a.factor[b.usermap];g.y/=a.map[c].precision/a.factor[b.usermap];k=g.x;g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;g=x(g);k=w(k);e=0;for(f in a.maplabel[b.usermap])a.maplabel[b.usermap].hasOwnProperty(f)&&"undefined"!==typeof a.maplabel[b.usermap][f]&&null!==a.maplabel[b.usermap][f]&&a.maplabel[b.usermap][f]._id>e&&(e=Number(a.maplabel[b.usermap][f]._id));
e+=1;h={event:"newmaplabel",object:"maplabel"};h.lat=l(g,a.precision);h.lng=l(k,a.precision);h.id=e;window.console&&console.log(JSON.stringify(h))}"mappath"==a.mode[b.usermap]&&(g=a.svgcoord[b.usermap],g.x=d.clientX,g.y=d.clientY,g=v(g,a.g[b.usermap]),g.x/=a.map[c].precision/a.factor[b.usermap],g.y/=a.map[c].precision/a.factor[b.usermap],k=g.x,g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k),a.coords[b.usermap].push(l(g,a.precision)+","+l(k,
a.precision)),"undefined"!=typeof a.path[b.usermap][1]&&null!==a.path[b.usermap][1]?a.path[b.usermap][1].addPoint(l(g,a.precision),l(k,a.precision)):(oa.points=l(g,a.precision)+","+l(k,a.precision),a.path[b.usermap][1]=new W(b,0,oa)),a.path[b.usermap][1].drawMapPath());"mappoly"==a.mode[b.usermap]&&(g=a.svgcoord[b.usermap],g.x=d.clientX,g.y=d.clientY,g=v(g,a.g[b.usermap]),g.x/=a.map[c].precision/a.factor[b.usermap],g.y/=a.map[c].precision/a.factor[b.usermap],k=g.x,g=360*(Math.atan(Math.pow(Math.E,
g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k),a.coords[b.usermap].push(l(g,a.precision)+","+l(k,a.precision)),"undefined"!=typeof a.poly[b.usermap][1]&&null!==a.poly[b.usermap][1]?a.poly[b.usermap][1].addPoint(l(g,a.precision),l(k,a.precision)):(pa.points=l(g,a.precision)+","+l(k,a.precision),a.poly[b.usermap][1]=new X(b,0,pa)),a.poly[b.usermap][1].drawMapPoly());"maprect"==a.mode[b.usermap]&&0==a.coords[b.usermap].length&&(g=a.svgcoord[b.usermap],g.x=d.clientX,g.y=d.clientY,
g=v(g,a.g[b.usermap]),g.x/=a.map[c].precision/a.factor[b.usermap],g.y/=a.map[c].precision/a.factor[b.usermap],k=g.x,g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k),a.coords[b.usermap].push(l(g,a.precision)+","+l(k,a.precision)),qa.points=l(g,a.precision)+","+l(k,a.precision),a.rect[b.usermap][1]=new Y(b,0,qa),a.rect[b.usermap][1]._movingpoints=l(g,a.precision)+","+l(k,a.precision),a.rect[b.usermap][1].drawMapRect());"mapcurve"==a.mode[b.usermap]&&
2>a.coords[b.usermap].length&&(g=a.svgcoord[b.usermap],g.x=d.clientX,g.y=d.clientY,g=v(g,a.g[b.usermap]),g.x/=a.map[c].precision/a.factor[b.usermap],g.y/=a.map[c].precision/a.factor[b.usermap],k=g.x,g=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI,g=x(g),k=w(k),a.coords[b.usermap].push(l(g,a.precision)+","+l(k,a.precision)),"undefined"!=typeof a.curve[b.usermap][1]&&null!==a.curve[b.usermap][1]?a.curve[b.usermap][1].addPoint(l(g,a.precision),l(k,a.precision)):
(ra.points=l(g,a.precision)+","+l(k,a.precision),a.curve[b.usermap][1]=new Z(b,0,ra)),a.curve[b.usermap][1].drawMapCurve())}});a.touchdevices&&(a.div[b.usermap].ontouchstart=function(a){a.preventDefault&&a.preventDefault();this._mousedown=!0;1==a.touches.length?(this._mousepositionx=a.touches[0].pageX,this._mousepositiony=a.touches[0].pageY,this._mapdragged=!1):2==a.touches.length&&(this._transformed=!0,this._pos={},this._pos.start=[],this._pos.start[0]={},this._pos.start[1]={},this._pos.start[0].x=
a.touches[0].pageX,this._pos.start[0].y=a.touches[0].pageY,this._pos.start[1].x=a.touches[1].pageX,this._pos.start[1].y=a.touches[1].pageY)});a.touchdevices&&(a.div[b.usermap].ontouchmove=function(d){var k;d.preventDefault&&d.preventDefault();if(!this._mousedown)return!1;if(1==d.touches.length){if(a.usermap[b.usermap].map.zoom_setting.draggable&&!this._transformed&&(10<Math.abs(d.touches[0].pageX-this._mousepositionx)||10<Math.abs(d.touches[0].pageY-this._mousepositiony))){this._mapdragged=!0;var e=
(this._mousepositiony-d.touches[0].pageY)/a.zoom[b.usermap].currentzoom;a.zoom[b.usermap].currentx=l(a.zoom[b.usermap].currentx+(this._mousepositionx-d.touches[0].pageX)/a.zoom[b.usermap].currentzoom,a.precision);a.zoom[b.usermap].currenty=l(a.zoom[b.usermap].currenty-e,a.precision);this._mousepositionx=d.touches[0].pageX;this._mousepositiony=d.touches[0].pageY;A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx)}}else if(2==d.touches.length&&a.usermap[b.usermap].map.zoom_setting.mouseWheel){a.zoom[b.usermap].prevzoom=
a.zoom[b.usermap].currentzoom;e=I(a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].initzoom);this._pos.move=[];this._pos.move[0]={};this._pos.move[1]={};this._pos.move[0].x=d.touches[0].pageX;this._pos.move[0].y=d.touches[0].pageY;this._pos.move[1].x=d.touches[1].pageX;this._pos.move[1].y=d.touches[1].pageY;var f=na(this._pos.move[0],this._pos.move[1]),h=na(this._pos.start[0],this._pos.start[1]);l(a.zoom[b.usermap].currentzoom);k=this._pos.start[0];var r=this._pos.start[1];d=(k.x+r.x)/2;k=(r.y+k.y)/
2;var n=a.svgcoord[b.usermap];n.x=d;n.y=k;for(var n=v(n,a.g[b.usermap]),q=this,s=r=0;q;)r+=q.offsetLeft,s+=q.offsetTop,q=q.offsetParent;n.x/=a.map[c].precision/a.factor[b.usermap];n.y/=a.map[c].precision/a.factor[b.usermap];q=n.x;n=360*(Math.atan(Math.pow(Math.E,n.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;50<Math.abs(f-h)&&(this._transformed=!0,M(n,q)||(f>h?20>e&&(a.zoom[b.usermap].currentzoom=l(1.5*a.zoom[b.usermap].currentzoom,a.precision),a.zoom[b.usermap].currentx=l(a.zoom[b.usermap].currentx-
0.5*((parseInt(this.style.width)/2-(d-r))/a.zoom[b.usermap].currentzoom),a.precision),a.zoom[b.usermap].currenty=l(a.zoom[b.usermap].currenty+0.5*((parseInt(this.style.height)/2-(k-s))/a.zoom[b.usermap].currentzoom),a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx)):1<e&&(a.zoom[b.usermap].currentzoom=l(a.zoom[b.usermap].currentzoom/1.5,a.precision),a.zoom[b.usermap].currentx=l(a.zoom[b.usermap].currentx+(parseInt(this.style.width)/2-(d-r))/a.zoom[b.usermap].currentzoom*
(1-1/1.5),a.precision),a.zoom[b.usermap].currenty=l(a.zoom[b.usermap].currenty-(parseInt(this.style.height)/2-(k-s))/a.zoom[b.usermap].currentzoom*(1-1/1.5),a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx)),this._pos.start[0].x=this._pos.move[0].x,this._pos.start[0].y=this._pos.move[0].y,this._pos.start[1].x=this._pos.move[1].x,this._pos.start[1].y=this._pos.move[1].y))}});a.touchdevices&&(a.div[b.usermap].ontouchend=function(a){a.preventDefault&&
a.preventDefault();0==a.touches.length&&(this._mousedown=this._mapdragged=this._transformed=!1,this._mousepositiony=this._mousepositionx=0,this._pos={})});a.background[b.usermap]=document.createElement("div");for(var k in a.usermap[b.usermap].div.style)a.usermap[b.usermap].div.style.hasOwnProperty(k)&&("backgroundImage"==k?""!=a.usermap[b.usermap].div.style[k]&&(a.background[b.usermap].style[k]="url('"+a.base[b.usermap]+a.usermap[b.usermap].div.style[k]+"?"+Math.random(1E5)+"')"):a.background[b.usermap].style[k]=
a.usermap[b.usermap].div.style[k]);a.background[b.usermap].style.position="absolute";a.background[b.usermap].style.top="0px";a.background[b.usermap].style.left="0px";a.background[b.usermap].style.width="100%";a.background[b.usermap].style.height="100%";a.div[b.usermap].appendChild(a.background[b.usermap]);a.foreground[b.usermap]=document.createElement("div");a.foreground[b.usermap].style.width="100%";a.foreground[b.usermap].style.height="100%";a.foreground[b.usermap].style.position="absolute";a.foreground[b.usermap].style.top=
a.usermap[b.usermap].div.style.borderWidth;a.foreground[b.usermap].style.left=a.usermap[b.usermap].div.style.borderWidth;a.div[b.usermap].appendChild(a.foreground[b.usermap]);a.zoomcontrol[b.usermap]=document.createElement("div");a.zoomcontrol[b.usermap].style.position="absolute";a.zoomcontrol[b.usermap].style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+5+"px";a.zoomcontrol[b.usermap].style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+5+"px";a.zoomcontrol[b.usermap].style.zIndex=
"1";a.zoomcontrol[b.usermap].style.backgroundColor="rgba(0,0,0,0)";a.panhome[b.usermap]=document.createElement("div");a.panhome[b.usermap].style.width=a.touchdevices?"24px":"16px";a.panhome[b.usermap].style.height=a.touchdevices?"24px":"16px";a.panhome[b.usermap].style.position="absolute";a.panhome[b.usermap].style.top="5px";a.panhome[b.usermap].style.left="5px";a.panhome[b.usermap].style.backgroundColor=a.usermap[b.usermap].map.zoom_setting.style.backgroundColor;a.panhome[b.usermap].style.borderWidth=
"1px";a.panhome[b.usermap].style.borderColor=a.usermap[b.usermap].map.zoom_setting.style.borderColor;a.panhome[b.usermap].style.borderStyle="solid";a.panhome[b.usermap].style.borderRadius="2px";a.panhome[b.usermap].unselectable="on";a.panhome[b.usermap].style.visibility="undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.homeControl?a.usermap[b.usermap].map.zoom_setting.homeControl?"visible":"hidden":"visible";a.panhome[b.usermap].style.cursor="pointer";a.panhome[b.usermap].title="home";h=r("svg");
h.setAttribute("xmlns","http://www.w3.org/2000/svg");h.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");h.setAttribute("version","1.1");a.touchdevices?(h.setAttribute("width","24px"),h.setAttribute("height","24px")):(h.setAttribute("width","16px"),h.setAttribute("height","16px"));h.style.overflow="hidden";e=r("polyline");a.touchdevices?e.setAttribute("points","3,14 12,3 21,14"):e.setAttribute("points","2.5,9.5 8.5,3.5 14.5,9.5");e.style.fill="none";e.style.stroke=a.usermap[b.usermap].map.zoom_setting.style.symbolColor;
e.style.strokeWidth=1.5;h.appendChild(e);e=r("polyline");a.touchdevices?e.setAttribute("points","4.5,14 4.5,22 19.5,22 19.5,14"):e.setAttribute("points","4.5,7.5 4.5,14.5 12.5,14.5 12.5,7.5");e.style.fill="none";e.style.stroke=a.usermap[b.usermap].map.zoom_setting.style.symbolColor;e.style.strokeWidth=1;h.appendChild(e);e=r("polyline");a.touchdevices?e.setAttribute("points","9.5,22 9.5,13.5 14.5,13.5 14.5,22"):e.setAttribute("points","6.5,14.5 6.5,9.5 10.5,9.5 10.5,14.5");e.style.fill="none";e.style.stroke=
a.usermap[b.usermap].map.zoom_setting.style.symbolColor;e.style.strokeWidth=1;h.appendChild(e);a.panhome[b.usermap].appendChild(h);a.panhome[b.usermap].onmouseup=function(a){};a.panhome[b.usermap].onmousedown=function(a){};a.panhome[b.usermap].onmousemove=function(a){};a.panhome[b.usermap].onmousewheel=function(a){};a.panhome[b.usermap].addEventListener&&a.panhome[b.usermap].addEventListener("DOMMouseScroll",function(a){},!1);a.touchdevices||(a.panhome[b.usermap].onclick=function(d){d.stopPropagation&&
d.stopPropagation();U(b,a.usermap[b.usermap].map.zoom,a.usermap[b.usermap].map.lat,a.usermap[b.usermap].map.lng)});a.touchdevices&&(a.panhome[b.usermap].ontouchstart=function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();this._touch=1==a.touches.length?!0:!1});a.touchdevices&&(a.panhome[b.usermap].ontouchend=function(d){this._touch&&U(b,a.usermap[b.usermap].map.zoom,a.usermap[b.usermap].map.lat,a.usermap[b.usermap].map.lng)});a.zoomcontrol[b.usermap].appendChild(a.panhome[b.usermap]);
a.zoomin[b.usermap]=document.createElement("div");a.zoomin[b.usermap].style.width=a.touchdevices?"24px":"16px";a.zoomin[b.usermap].style.height=a.touchdevices?"24px":"16px";a.zoomin[b.usermap].style.position="absolute";a.zoomin[b.usermap].style.top=a.touchdevices?"34px":"24px";a.zoomin[b.usermap].style.left="5px";a.zoomin[b.usermap].style.backgroundColor=a.usermap[b.usermap].map.zoom_setting.style.backgroundColor;a.zoomin[b.usermap].style.borderWidth="1px";a.zoomin[b.usermap].style.borderColor=a.usermap[b.usermap].map.zoom_setting.style.borderColor;
a.zoomin[b.usermap].style.borderStyle="solid";a.zoomin[b.usermap].style.borderRadius="2px";a.zoomin[b.usermap].style.unselectable="on";a.zoomin[b.usermap].style.visibility="undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.zoomControl?a.usermap[b.usermap].map.zoom_setting.zoomControl?"visible":"hidden":"visible";a.zoomin[b.usermap].style.cursor="pointer";a.zoomin[b.usermap].title="zoom in";h=r("svg");h.setAttribute("xmlns","http://www.w3.org/2000/svg");h.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");
h.setAttribute("version","1.1");a.touchdevices?(h.setAttribute("width","24px"),h.setAttribute("height","24px")):(h.setAttribute("width","16px"),h.setAttribute("height","16px"));h.style.overflow="hidden";e=r("polyline");a.touchdevices?e.setAttribute("points","4,12 20,12"):e.setAttribute("points","3,8 13,8");e.style.fill="none";e.style.stroke=a.usermap[b.usermap].map.zoom_setting.style.symbolColor;e.style.strokeWidth=2;h.appendChild(e);e=r("polyline");a.touchdevices?e.setAttribute("points","12,4 12,20"):
e.setAttribute("points","8,3 8,13");e.style.fill="none";e.style.stroke=a.usermap[b.usermap].map.zoom_setting.style.symbolColor;e.style.strokeWidth=2;h.appendChild(e);a.zoomin[b.usermap].appendChild(h);a.zoomin[b.usermap].onmouseup=function(a){};a.zoomin[b.usermap].onmousedown=function(a){};a.zoomin[b.usermap].onmousemove=function(a){};a.zoomin[b.usermap].onmousewheel=function(a){};a.zoomin[b.usermap].addEventListener&&a.zoomin[b.usermap].addEventListener("DOMMouseScroll",function(a){},!1);a.touchdevices||
(a.zoomin[b.usermap].onclick=function(d){d.preventDefault&&d.preventDefault();d.stopPropagation&&d.stopPropagation();a.zoom[b.usermap].prevzoom=a.zoom[b.usermap].currentzoom;20>I(a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].initzoom)&&(a.zoom[b.usermap].currentzoom=l(1.5*a.zoom[b.usermap].currentzoom,a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx))});a.touchdevices&&(a.zoomin[b.usermap].ontouchstart=function(a){a.preventDefault&&a.preventDefault();
a.stopPropagation&&a.stopPropagation();this._touch=1==a.touches.length?!0:!1});a.touchdevices&&(a.zoomin[b.usermap].ontouchend=function(d){a.zoom[b.usermap].prevzoom=a.zoom[b.usermap].currentzoom;d=I(a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].initzoom);this._touch&&20>d&&(a.zoom[b.usermap].currentzoom=l(1.5*a.zoom[b.usermap].currentzoom,a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx))});a.zoomcontrol[b.usermap].appendChild(a.zoomin[b.usermap]);
a.zoomout[b.usermap]=document.createElement("div");a.zoomout[b.usermap].style.width=a.touchdevices?"24px":"16px";a.zoomout[b.usermap].style.height=a.touchdevices?"24px":"16px";a.zoomout[b.usermap].style.position="absolute";a.zoomout[b.usermap].style.top=a.touchdevices?"63px":"43px";a.zoomout[b.usermap].style.left="5px";a.zoomout[b.usermap].style.backgroundColor=a.usermap[b.usermap].map.zoom_setting.style.backgroundColor;a.zoomout[b.usermap].style.borderWidth="1px";a.zoomout[b.usermap].style.borderColor=
a.usermap[b.usermap].map.zoom_setting.style.borderColor;a.zoomout[b.usermap].style.borderStyle="solid";a.zoomout[b.usermap].style.borderRadius="2px";a.zoomout[b.usermap].unselectable="on";a.zoomout[b.usermap].style.visibility="undefined"!=typeof a.usermap[b.usermap].map.zoom_setting.zoomControl?a.usermap[b.usermap].map.zoom_setting.zoomControl?"visible":"hidden":"visible";a.zoomout[b.usermap].style.cursor="pointer";a.zoomout[b.usermap].title="zoom out";h=r("svg");h.setAttribute("xmlns","http://www.w3.org/2000/svg");
h.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");h.setAttribute("version","1.1");a.touchdevices?(h.setAttribute("width","24px"),h.setAttribute("height","24px")):(h.setAttribute("width","16px"),h.setAttribute("height","16px"));h.style.overflow="hidden";e=r("polyline");a.touchdevices?e.setAttribute("points","4,12 20,12"):e.setAttribute("points","3,8 13,8");e.style.fill="none";e.style.stroke=a.usermap[b.usermap].map.zoom_setting.style.symbolColor;e.style.strokeWidth=2;h.appendChild(e);a.zoomout[b.usermap].appendChild(h);
a.zoomout[b.usermap].onmouseup=function(a){};a.zoomout[b.usermap].onmousedown=function(a){};a.zoomout[b.usermap].onmousemove=function(a){};a.zoomout[b.usermap].onmousewheel=function(a){};a.zoomout[b.usermap].addEventListener&&a.zoomout[b.usermap].addEventListener("DOMMouseScroll",function(a){},!1);a.touchdevices||(a.zoomout[b.usermap].onclick=function(d){d.stopPropagation&&d.stopPropagation();a.zoom[b.usermap].prevzoom=a.zoom[b.usermap].currentzoom;1<I(a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].initzoom)&&
(a.zoom[b.usermap].currentzoom=l(a.zoom[b.usermap].currentzoom/1.5,a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx))});a.touchdevices&&(a.zoomout[b.usermap].ontouchstart=function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();this._touch=1==a.touches.length?!0:!1});a.touchdevices&&(a.zoomout[b.usermap].ontouchend=function(d){this._touch&&(a.zoom[b.usermap].prevzoom=a.zoom[b.usermap].currentzoom,1<I(a.zoom[b.usermap].currentzoom,
a.zoom[b.usermap].initzoom)&&(a.zoom[b.usermap].currentzoom=l(a.zoom[b.usermap].currentzoom/1.5,a.precision),A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx)))});a.zoomcontrol[b.usermap].appendChild(a.zoomout[b.usermap]);a.div[b.usermap].appendChild(a.zoomcontrol[b.usermap]);a.local&&(h=document.createElement("script"),h.type="application/javascript",h.src=b.base+"imap5map_"+a.usermap[b.usermap].map.id+".js?"+Math.random(1E5),h.onerror=function(){},h.onload=
function(){xa(b)},document.body.appendChild(h))},ya=function(b){var c=document.createElement("div");a.div[b.usermap].appendChild(c);c.innerHTML="<a href='http://www.imapbuilder.com/html5-mapping/' rel='nofollow'>Interactive HTML5 map by iMapBuilder</a>";c.style.position="absolute";c.style.bottom="-1px";c.style.right="1px";c.style.font="11px Verdana";c.style.backgroundColor="#ffffff";c.style.cursor="none";c.style.visibility="hidden"},za=function(b){var c=r("g");c.style.opacity=0.2;a.svg[b.usermap].appendChild(c);
var h=r("text");h.appendChild(document.createTextNode("iMapBuilder HTML5"));h.style.cursor="default";h.style.fill="#000000";h.style.fontFamily="Arial";h.style.fontWeight="bold";h.style.pointerEvents="none";c.appendChild(h);h.setAttribute("x",-4096);h.setAttribute("y",-4096);h.setAttribute("text-anchor","middle");c=parseInt(a.div[b.usermap].clientWidth/8);for(h.style.fontSize=c+"px";h.getBBox().width>a.div[b.usermap].clientWidth;)c-=2,h.style.fontSize=c+"px";for(;h.getBBox().height>a.div[b.usermap].clientHeight;)c-=
2,h.style.fontSize=c+"px";h.style.fontSize=c-2+"px";h.setAttribute("x",a.div[b.usermap].clientWidth/2);h.setAttribute("y",a.div[b.usermap].clientHeight/2+parseInt(h.style.fontSize)/2);var e=document.createElement("div");a.div[b.usermap].appendChild(e);e.appendChild(document.createTextNode("Interactive HTML5 map by iMapBuilder"));e.style.position="absolute";e.style.bottom=0-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";e.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";
e.style.font="11px Verdana";e.style.backgroundColor="#ffffff";e.style.padding="3px";e.style.opacity=0.5;e.style.cursor="pointer";e.onclick=function(){location.href="http://www.imapbuilder.com/html5-mapping/"};a.touchdevices&&(e.ontouchstart=function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();this._touch=1==a.touches.length?!0:!1});a.touchdevices&&(e.ontouchend=function(a){this._touch&&(location.href="http://www.imapbuilder.com/html5-mapping/")});e.onmouseover=function(){e.style.opacity=
1};e.onmouseout=function(){e.style.opacity=0.5}};a.zoomTo=function(a,c,h,e){U(a,c,h,e)};var U=function(a,c,h,e){h=x(h);h=Math.log(Math.tan(Math.PI/4+Math.PI*h/360))*(180/Math.PI);A(a,c,h,e)};a.zoomToXY=function(a,c,h,e){A(a,c,h,e)};var A=function(b,c,h,e){var f=a.usermap[b.usermap].map.id,d=a.div[b.usermap].clientWidth,k=a.div[b.usermap].clientHeight;l(a.zoom[b.usermap].currentzoom,a.precision);a.zoom[b.usermap].currentzoom=l(c,a.precision);a.zoom[b.usermap].currentx=l(e,a.precision);a.zoom[b.usermap].currenty=
l(h,a.precision);a.g[b.usermap].setAttribute("transform","translate("+l(d/2+-e*c,a.precision)+","+l(k/2+h*c,a.precision)+") scale("+l(c/(a.map[f].precision/a.factor[b.usermap]),a.precision)+",-"+l(c/(a.map[f].precision/a.factor[b.usermap]),a.precision)+")");a.g[b.usermap].setAttribute("stroke-width",l(a.usermap[b.usermap].map.geometry_default.stroke_width/c*(a.map[f].precision/a.factor[b.usermap]),a.precision));window.console&&(d={event:"poschange",object:"map"},d.zoom=l(c,a.precision),d.x=l(e,a.precision),
d.y=l(h,a.precision),window.console&&console.log(JSON.stringify(d)));for(var m in a.marker[b.usermap])a.marker[b.usermap].hasOwnProperty(m)&&a.marker[b.usermap][m].setAttribute("transform","translate("+l(a.marker[b.usermap][m]._lng,a.precision)+","+l(a.marker[b.usermap][m]._lat,a.precision)+") scale("+l(a.map[f].precision/a.factor[b.usermap]/c,a.precision)+")");for(m in a.maplabel[b.usermap])a.maplabel[b.usermap].hasOwnProperty(m)&&a.maplabel[b.usermap][m].setAttribute("transform","translate("+l(a.maplabel[b.usermap][m]._lng,
a.precision)+","+l(a.maplabel[b.usermap][m]._lat,a.precision)+") scale("+l(a.map[f].precision/a.factor[b.usermap]/c,a.precision)+")");if(l(a.zoom[b.usermap].prevzoom,a.precision)!=c){for(m in a.mapabbr[b.usermap])if(a.mapabbr[b.usermap].hasOwnProperty(m)){a.mapabbr[b.usermap][m].setAttribute("transform","translate("+l(a.mapabbr[b.usermap][m]._lng,a.precision)+","+l(a.mapabbr[b.usermap][m]._lat,a.precision)+") scale("+l(a.map[f].precision/a.factor[b.usermap]/c,a.precision)+")");h=l(a.map[f].precision/
a.factor[b.usermap]/c,a.precision);var g=l(a.mapabbr[b.usermap][m]._lng/h,a.precision);h=l(a.mapabbr[b.usermap][m]._lat/h,a.precision);e=a.mapabbr[b.usermap][m].getBBox();a.mapabbr[b.usermap][m]._bbox={};a.mapabbr[b.usermap][m]._bbox.x=parseFloat(g+e.x);a.mapabbr[b.usermap][m]._bbox.y=parseFloat(h+e.y);a.mapabbr[b.usermap][m]._bbox.width=e.width;a.mapabbr[b.usermap][m]._bbox.height=e.height;a.mapabbr[b.usermap][m].hide()}a.geoareasize[b.usermap].sort(function(a,b){return b.area-a.area});for(g=0;g<
a.geoareasize[b.usermap].length;g++)if(a.geoareasize[b.usermap].hasOwnProperty(g)&&(m=a.geoareasize[b.usermap][g].id,a.mapabbr[b.usermap].hasOwnProperty(m))){h=a.mapabbr[b.usermap][m]._bbox;a.mapabbr[b.usermap][m].show();for(var t in a.mapabbr[b.usermap])if(t!=m&&a.mapabbr[b.usermap].hasOwnProperty(t)&&"visible"==a.mapabbr[b.usermap][t].style.visibility&&(e=a.mapabbr[b.usermap][t]._bbox,ua({x:h.x,y:h.y},{x:parseFloat(h.x+h.width),y:parseFloat(h.y+h.height)},{x:e.x,y:e.y},{x:parseFloat(e.x+e.width),
y:parseFloat(e.y+e.height)}))){a.mapabbr[b.usermap][m].hide();break}}}else for(m in a.mapabbr[b.usermap])a.mapabbr[b.usermap].hasOwnProperty(m)&&a.mapabbr[b.usermap][m].setAttribute("transform","translate("+l(a.mapabbr[b.usermap][m]._lng,a.precision)+","+l(a.mapabbr[b.usermap][m]._lat,a.precision)+") scale("+l(a.map[f].precision/a.factor[b.usermap]/c,a.precision)+")");for(m in a.mappoly[b.usermap])if(a.mappoly[b.usermap].hasOwnProperty(m)){a.mappoly[b.usermap][m].getElementsByTagName("polygon")[0].setAttribute("stroke-width",
l(a.mappoly[b.usermap][m]._options.style.strokeWidth/c*(a.map[f].precision/a.factor[b.usermap]),a.precision));if("undefined"!==typeof a.mappoly[b.usermap][m]._options.style.strokeDasharray&&"none"!==a.mappoly[b.usermap][m]._options.style.strokeDasharray){t=a.mappoly[b.usermap][m]._options.style.strokeDasharray.split(",");h="";for(g=0;g<t.length;g++)""!=h&&(h+=","),h+=l(t[g]/a.zoom[b.usermap].currentzoom*(a.map[f].precision/a.factor[b.usermap]),a.precision);a.mappoly[b.usermap][m].getElementsByTagName("polygon")[0].setAttribute("stroke-dasharray",
h)}for(g in a.mappoly[b.usermap][m]._mainvertices)a.mappoly[b.usermap][m]._mainvertices.hasOwnProperty(g)&&a.mappoly[b.usermap][m]._mainvertices[g].rescale();for(g in a.mappoly[b.usermap][m]._subvertices)a.mappoly[b.usermap][m]._subvertices.hasOwnProperty(g)&&a.mappoly[b.usermap][m]._subvertices[g].rescale();a.mappoly[b.usermap][m].toggleCategory()}"mappoly"==a.mode[b.usermap]&&"undefined"!=typeof a.poly[b.usermap][1]&&null!=a.poly[b.usermap][1]&&(1<a.poly[b.usermap][1].count()?a.poly[b.usermap][1].getElementsByTagName("polygon")[0].setAttribute("stroke-width",
l(a.poly[b.usermap][1]._options.style.strokeWidth/c*(a.map[f].precision/a.factor[b.usermap]),a.precision)):a.poly[b.usermap][1].getElementsByTagName("polyline")[0].setAttribute("stroke-width",l(a.poly[b.usermap][1]._options.style.strokeWidth/c*(a.map[f].precision/a.factor[b.usermap]),a.precision)));for(m in a.maprect[b.usermap])if(a.maprect[b.usermap].hasOwnProperty(m)){a.maprect[b.usermap][m].getElementsByTagName("polygon")[0].setAttribute("stroke-width",l(a.maprect[b.usermap][m]._options.style.strokeWidth/
c*(a.map[f].precision/a.factor[b.usermap]),a.precision));if("undefined"!==typeof a.maprect[b.usermap][m]._options.style.strokeDasharray&&"none"!==a.maprect[b.usermap][m]._options.style.strokeDasharray){t=a.maprect[b.usermap][m]._options.style.strokeDasharray.split(",");h="";for(g=0;g<t.length;g++)""!=h&&(h+=","),h+=l(t[g]/a.zoom[b.usermap].currentzoom*(a.map[f].precision/a.factor[b.usermap]),a.precision);a.maprect[b.usermap][m].getElementsByTagName("polygon")[0].setAttribute("stroke-dasharray",h)}for(g in a.maprect[b.usermap][m]._mainvertices)a.maprect[b.usermap][m]._mainvertices.hasOwnProperty(g)&&
a.maprect[b.usermap][m]._mainvertices[g].rescale();a.maprect[b.usermap][m].toggleCategory()}"maprect"==a.mode[b.usermap]&&"undefined"!=typeof a.rect[b.usermap][1]&&null!=a.rect[b.usermap][1]&&a.rect[b.usermap][1].getElementsByTagName("polygon")[0].setAttribute("stroke-width",l(a.rect[b.usermap][1]._options.style.strokeWidth/c*(a.map[f].precision/a.factor[b.usermap]),a.precision));for(m in a.mappath[b.usermap])if(a.mappath[b.usermap].hasOwnProperty(m)){a.mappath[b.usermap][m].getElementsByTagName("polyline")[0].setAttribute("stroke-width",
l(a.mappath[b.usermap][m]._options.style.strokeWidth/c*(a.map[f].precision/a.factor[b.usermap]),a.precision));if("undefined"!==typeof a.mappath[b.usermap][m]._options.style.strokeDasharray&&"none"!==a.mappath[b.usermap][m]._options.style.strokeDasharray){t=a.mappath[b.usermap][m]._options.style.strokeDasharray.split(",");h="";for(g=0;g<t.length;g++)""!=h&&(h+=","),h+=l(t[g]/a.zoom[b.usermap].currentzoom*(a.map[f].precision/a.factor[b.usermap]),a.precision);a.mappath[b.usermap][m].getElementsByTagName("polyline")[0].setAttribute("stroke-dasharray",
h)}for(g in a.mappath[b.usermap][m]._mainvertices)a.mappath[b.usermap][m]._mainvertices.hasOwnProperty(g)&&a.mappath[b.usermap][m]._mainvertices[g].rescale();for(g in a.mappath[b.usermap][m]._subvertices)a.mappath[b.usermap][m]._subvertices.hasOwnProperty(g)&&a.mappath[b.usermap][m]._subvertices[g].rescale();a.mappath[b.usermap][m].toggleCategory()}"mappath"==a.mode[b.usermap]&&"undefined"!=typeof a.path[b.usermap][1]&&null!=a.path[b.usermap][1]&&a.path[b.usermap][1].getElementsByTagName("polyline")[0].setAttribute("stroke-width",
l(a.path[b.usermap][1]._options.style.strokeWidth/c*(a.map[f].precision/a.factor[b.usermap]),a.precision));for(m in a.mapcurve[b.usermap])if(a.mapcurve[b.usermap].hasOwnProperty(m)){a.mapcurve[b.usermap][m].getElementsByTagName("path")[0].setAttribute("stroke-width",l(a.mapcurve[b.usermap][m]._options.style.strokeWidth/c*(a.map[f].precision/a.factor[b.usermap]),a.precision));if("undefined"!==typeof a.mapcurve[b.usermap][m]._options.style.strokeDasharray&&"none"!==a.mapcurve[b.usermap][m]._options.style.strokeDasharray){t=
a.mapcurve[b.usermap][m]._options.style.strokeDasharray.split(",");h="";for(g=0;g<t.length;g++)""!=h&&(h+=","),h+=l(t[g]/a.zoom[b.usermap].currentzoom*(a.map[f].precision/a.factor[b.usermap]),a.precision);a.mapcurve[b.usermap][m].getElementsByTagName("path")[0].setAttribute("stroke-dasharray",h)}for(g in a.mapcurve[b.usermap][m]._mainvertices)a.mapcurve[b.usermap][m]._mainvertices.hasOwnProperty(g)&&a.mapcurve[b.usermap][m]._mainvertices[g].rescale();a.mapcurve[b.usermap][m].toggleCategory()}"mapcurve"==
a.mode[b.usermap]&&"undefined"!=typeof a.curve[b.usermap][1]&&null!=a.curve[b.usermap][1]&&a.curve[b.usermap][1].getElementsByTagName("path")[0].setAttribute("stroke-width",l(a.curve[b.usermap][1]._options.style.strokeWidth/c*(a.map[f].precision/a.factor[b.usermap]),a.precision));for(m in a.mapbubble[b.usermap])a.mapbubble[b.usermap].hasOwnProperty(m)&&null!==a.mapbubble[b.usermap][m]&&a.mapbubble[b.usermap][m].rescale();for(m in a.piechart[b.usermap])a.piechart[b.usermap].hasOwnProperty(m)&&null!==
a.piechart[b.usermap][m]&&a.piechart[b.usermap][m].rescale();a.center[b.usermap].setAttribute("transform","scale("+l(a.map[f].precision/a.factor[b.usermap]/c,a.precision)+")");a.zoom[b.usermap].prevzoom=c};a.getLatLng=function(b){var c=a.zoom[b.usermap].currentzoom,h=360*(Math.atan(Math.pow(Math.E,a.zoom[b.usermap].currenty*Math.PI/180))-Math.PI/4)/Math.PI;b=a.zoom[b.usermap].currentx;var e={event:"getlatlng",object:"map"};e.lat=l(h,a.precision);e.lng=l(b,a.precision);e.zoom=l(c,a.precision);window.console&&
console.log(JSON.stringify(e))};a.setZoom=function(b,c){var h=a.usermap[b.usermap].map.id;a.g[b.usermap].setAttribute("transform","translate("+(a.div[b.usermap].clientWidth/2+-a.usermap[b.usermap].map.lng*c)+","+(a.div[b.usermap].clientHeight/2+a.usermap[b.usermap].map.lat*c)+") scale("+c/(a.map[h].precision/a.factor[b.usermap])+",-"+c/(a.map[h].precision/a.factor[b.usermap])+")");a.g[b.usermap].setAttribute("stroke-width",a.usermap[b.usermap].map.geometry_default.stroke_width/c*(a.map[h].precision/
a.factor[b.usermap]))};var xa=function(b){var c=a.usermap[b.usermap].map.id,h=a.usermap[b.usermap].map.zoom,e=0;a.svg[b.usermap]=r("svg");a.svg[b.usermap].setAttribute("xmlns","http://www.w3.org/2000/svg");a.svg[b.usermap].setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");a.svg[b.usermap].setAttribute("width",a.div[b.usermap].clientWidth+"px");a.svg[b.usermap].setAttribute("height",a.div[b.usermap].clientHeight+"px");a.svg[b.usermap].style.overflow="hidden";a.foreground[b.usermap].appendChild(a.svg[b.usermap]);
a.svgcoord[b.usermap]=a.svg[b.usermap].createSVGPoint();a.grouphighlight[b.usermap].enable="undefined"==typeof a.usermap[b.usermap].map.grouphighlight?!1:a.usermap[b.usermap].map.grouphighlight.enable;a.fadeout[b.usermap].enable="undefined"==typeof a.usermap[b.usermap].map.fadeout?!0:a.usermap[b.usermap].map.fadeout.enable;a.heatmap[b.usermap].enable="undefined"==typeof a.usermap[b.usermap].map.heatmap?!1:a.usermap[b.usermap].map.heatmap.enable;if(a.heatmap[b.usermap].enable)if("continuous"==a.usermap[b.usermap].map.heatmap.heattype){var f=
{},f=ma(b);a.heatmap[b.usermap].hmin=f.hmin;a.heatmap[b.usermap].hmax=f.hmax}else{var f=a.usermap[b.usermap].map.heatmap.discrete.rangeset.split(",").length,d=a.usermap[b.usermap].map.heatmap.discrete.colorset.split(",").length;0<f&&0<d&&d==f+1||(a.heatmap[b.usermap].enable=!1)}a.g[b.usermap]=r("g");a.g[b.usermap].setAttribute("stroke",a.usermap[b.usermap].map.geometry_default.stroke);a.g[b.usermap].setAttribute("stroke-width",a.usermap[b.usermap].map.geometry_default.stroke_width/h*(a.map[c].precision/
a.factor[b.usermap]));a.g[b.usermap].setAttribute("stroke-linejoin",a.usermap[b.usermap].map.geometry_default.stroke_linejoin);a.svg[b.usermap].appendChild(a.g[b.usermap]);var h=!0,k;for(k in a.map[c].geometry)if(a.map[c].geometry.hasOwnProperty(k)){var f=0,m=[],g=0,t=0,d=a.map[c].geometry[k].id;a.geometry[b.usermap][d]=r("g");a.g[b.usermap].appendChild(a.geometry[b.usermap][d]);a.geometry[b.usermap][d].setAttribute("id",a.map[c].geometry[k].id);a.geometry[b.usermap][d].fade={};a.geometry[b.usermap][d].fade.curColor=
{};a.geometry[b.usermap][d].fade.diffColor={};a.geometry[b.usermap][d].group={};a.geometry[b.usermap][d].group.id="undefined"==typeof a.usermap[b.usermap].map.geometry[d].group?0:a.usermap[b.usermap].map.geometry[d].group;a.heatmap[b.usermap].enable&&(a.geometry[b.usermap][d].heatcolor="continuous"==a.usermap[b.usermap].map.heatmap.heattype?aa(a.usermap[b.usermap].map.heatmap.continuous.startcolor,a.usermap[b.usermap].map.heatmap.continuous.endcolor,a.heatmap[b.usermap].hmax==a.heatmap[b.usermap].hmin?
0:100*((a.usermap[b.usermap].map.geometry[d].heatvalue+Math.abs(a.heatmap[b.usermap].hmin))/(a.heatmap[b.usermap].hmax-a.heatmap[b.usermap].hmin))):ba(a.usermap[b.usermap].map.geometry[d].heatvalue,a.usermap[b.usermap].map.heatmap.discrete.rangeset.split(","),a.usermap[b.usermap].map.heatmap.discrete.colorset.split(",")));"undefined"==typeof a.groupHL[b.usermap][a.geometry[b.usermap][d].group.id]&&(a.groupHL[b.usermap][a.geometry[b.usermap][d].group.id]=[]);a.groupHL[b.usermap][a.geometry[b.usermap][d].group.id].push(d);
R({usermap:b.usermap,geometry:d});a.geometry[b.usermap][d].fadeTo=function(a,b){var d=this;this.fade.startcolor=this.getAttribute("fill");this.fade.endcolor=a;this.fade.curColor.r=F(this.fade.startcolor);this.fade.curColor.g=G(this.fade.startcolor);this.fade.curColor.b=H(this.fade.startcolor);this.fade.diffColor.r=F(this.fade.endcolor)-F(this.fade.startcolor);this.fade.diffColor.g=G(this.fade.endcolor)-G(this.fade.startcolor);this.fade.diffColor.b=H(this.fade.endcolor)-H(this.fade.startcolor);this.fade.totalCount=
1E3*b/20;this.fade.count=0;0<this.fade.totalCount?this.fade.interval=setInterval(function(){d.fade.count<d.fade.totalCount?(d.fade.curColor.r+=d.fade.diffColor.r/d.fade.totalCount,d.fade.curColor.g+=d.fade.diffColor.g/d.fade.totalCount,d.fade.curColor.b+=d.fade.diffColor.b/d.fade.totalCount,d.setAttribute("fill","#"+N(d.fade.curColor.r,2)+N(d.fade.curColor.g,2)+N(d.fade.curColor.b,2)),d.fade.count++):(d.setAttribute("fill",d.fade.endcolor),clearInterval(d.fade.interval))},20):this.setAttribute("fill",
a)};a.touchdevices||(a.geometry[b.usermap][d].onmouseover=function(d){"marker"==a.mode[b.usermap]&&(this.style.cursor="pointer");"maplabel"==a.mode[b.usermap]&&(this.style.cursor="pointer");"mappath"==a.mode[b.usermap]&&(this.style.cursor="pointer");"mappoly"==a.mode[b.usermap]&&(this.style.cursor="pointer");"maprect"==a.mode[b.usermap]&&(this.style.cursor="pointer");"mapcurve"==a.mode[b.usermap]&&(this.style.cursor="pointer");if(0!=this.group.id&&a.grouphighlight[b.usermap].enable)for(var k in a.groupHL[b.usermap][this.group.id])a.groupHL[b.usermap][this.group.id].hasOwnProperty(k)&&
clearInterval(a.geometry[b.usermap][a.groupHL[b.usermap][this.group.id][k]].fade.interval);else clearInterval(this.fade.interval);if(0!=this.group.id&&a.grouphighlight[b.usermap].enable)for(k in a.groupHL[b.usermap][this.group.id])a.groupHL[b.usermap][this.group.id].hasOwnProperty(k)&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][this.group.id][k]]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][this.group.id][k]].fill_mouseover&&a.geometry[b.usermap][a.groupHL[b.usermap][this.group.id][k]].setAttribute("fill",
O(b,a.groupHL[b.usermap][this.group.id][k]));else"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id].fill_mouseover&&this.setAttribute("fill",O(b,this.id));"edit"==a.mode[b.usermap]||"onmouseover"!=a.usermap[b.usermap].infobox.show||"undefined"==typeof a.usermap[b.usermap].map.geometry[this.id]||"undefined"==typeof a.usermap[b.usermap].map.geometry[this.id].infobox||document.getElementById("imap5_"+b.usermap+"_infobox_geometry_"+
this.id)||(k={},k.clientX=d.clientX,k.clientY=d.clientY,k.obj="geometry",k.infobox=a.usermap[b.usermap].map.geometry[this.id].infobox,this.infobox=new z(b,this.id,k))},a.geometry[b.usermap][d].onmouseout=function(d){"marker"==a.mode[b.usermap]&&(this.style.cursor="auto");if(0!=this.group.id&&a.grouphighlight[b.usermap].enable)for(var k in a.groupHL[b.usermap][this.group.id])a.groupHL[b.usermap][this.group.id].hasOwnProperty(k)&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][this.group.id][k]]&&
"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][this.group.id][k]].fill_mouseover&&(a.fadeout[b.usermap].enable?a.geometry[b.usermap][a.groupHL[b.usermap][this.group.id][k]].fadeTo(D(b,a.groupHL[b.usermap][this.group.id][k]),0.2):a.geometry[b.usermap][a.groupHL[b.usermap][this.group.id][k]].fadeTo(D(b,a.groupHL[b.usermap][this.group.id][k]),0));else a.fadeout[b.usermap].enable?this.fadeTo(D(b,this.id),0.2):this.fadeTo(D(b,this.id),0);"onmouseover"==a.usermap[b.usermap].infobox.show&&
"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id].infobox&&(null==d.relatedTarget||d.relatedTarget.id!="imap5_"+b.usermap+"_infobox_geometry_"+this.id)&&document.getElementById("imap5_"+b.usermap+"_infobox_geometry_"+this.id)&&this.infobox.remove()});a.touchdevices||(a.geometry[b.usermap][d].onclick=function(d){a.div[b.usermap]._mapdragged||a.div[b.usermap]._transformed||("edit"==a.mode[b.usermap]?(d={event:"click",object:"geometry"},
d.id=this.id,window.console&&console.log(JSON.stringify(d))):"normal"==a.mode[b.usermap]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id].link&&("undefined"==typeof a.usermap[b.usermap].map.geometry[this.id].link_target?location.href=a.usermap[b.usermap].map.geometry[this.id].link:window.open(a.usermap[b.usermap].map.geometry[this.id].link,a.usermap[b.usermap].map.geometry[this.id].link_target)))});a.touchdevices||(a.geometry[b.usermap][d].onmousemove=
function(d){d.preventDefault&&d.preventDefault();"normal"==a.mode[b.usermap]&&(a.div[b.usermap]._mousedown?document.getElementById("imap5_"+b.usermap+"_infobox_geometry_"+this.id)&&this.infobox.hide():document.getElementById("imap5_"+b.usermap+"_infobox_geometry_"+this.id)&&(this.infobox.reposition(d.clientX,d.clientY),this.infobox.show()))});a.touchdevices&&(a.geometry[b.usermap][d].ontouchstart=function(a){1==a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=
a.touches[0].clientY)});a.touchdevices&&(a.geometry[b.usermap][d].ontouchmove=function(a){1==a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1});a.touchdevices&&(a.geometry[b.usermap][d].ontouchend=function(d){if(this._touch&&!this._move&&!a.div[b.usermap]._mapdragged){if("edit"==a.mode[b.usermap]){var k={event:"click",object:"geometry"};k.id=this.id;window.console&&console.log(JSON.stringify(k));
return}"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id].link&&("undefined"==typeof a.usermap[b.usermap].map.geometry[this.id].link_target?location.href=a.usermap[b.usermap].map.geometry[this.id].link:window.open(a.usermap[b.usermap].map.geometry[this.id].link,a.usermap[b.usermap].map.geometry[this.id].link_target));if(0<a.selected[b.usermap].length){if(this.id==a.selected[b.usermap][0]){if(0!=this.group.id&&a.grouphighlight[b.usermap].enable)for(k in a.groupHL[b.usermap][this.group.id])a.groupHL[b.usermap][this.group.id].hasOwnProperty(k)&&
"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][this.group.id][k]]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][this.group.id][k]].fill_mouseover&&(a.fadeout[b.usermap].enable?a.geometry[b.usermap][a.groupHL[b.usermap][this.group.id][k]].fadeTo(D(b,a.groupHL[b.usermap][this.group.id][k]),0.2):a.geometry[b.usermap][a.groupHL[b.usermap][this.group.id][k]].fadeTo(D(b,a.groupHL[b.usermap][this.group.id][k]),0));else a.fadeout[b.usermap].enable?
this.fadeTo(D(b,this.id),0.2):this.fadeTo(D(b,this.id),0);a.selected[b.usermap].pop();0<a.infobox[b.usermap].length&&(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),a.infobox[b.usermap].pop());return}d=a.geometry[b.usermap][a.selected[b.usermap][0]].group.id;if(0!=d&&a.grouphighlight[b.usermap].enable)for(k in a.groupHL[b.usermap][d])a.groupHL[b.usermap][d].hasOwnProperty(k)&&
"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][d][k]]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][d][k]].fill_mouseover&&(a.fadeout[b.usermap].enable?a.geometry[b.usermap][a.groupHL[b.usermap][d][k]].fadeTo(D(b,a.groupHL[b.usermap][d][k]),0.2):a.geometry[b.usermap][a.groupHL[b.usermap][d][k]].fadeTo(D(b,a.groupHL[b.usermap][d][k]),0));else a.fadeout[b.usermap].enable?a.geometry[b.usermap][a.selected[b.usermap][0]].fadeTo(D(b,a.selected[b.usermap][0]),
0.2):a.geometry[b.usermap][a.selected[b.usermap][0]].fadeTo(D(b,a.selected[b.usermap][0]),0);a.selected[b.usermap].pop()}if("undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id]&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[this.id].fill_mouseover)if(0!=this.group.id&&a.grouphighlight[b.usermap].enable)for(k in a.groupHL[b.usermap][this.group.id])a.groupHL[b.usermap][this.group.id].hasOwnProperty(k)&&"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][this.group.id][k]]&&
"undefined"!=typeof a.usermap[b.usermap].map.geometry[a.groupHL[b.usermap][this.group.id][k]].fill_mouseover&&(a.fadeout[b.usermap].enable?a.geometry[b.usermap][a.groupHL[b.usermap][this.group.id][k]].fadeTo(O(b,a.groupHL[b.usermap][this.group.id][k]),0.2):a.geometry[b.usermap][a.groupHL[b.usermap][this.group.id][k]].fadeTo(O(b,a.groupHL[b.usermap][this.group.id][k]),0));else a.fadeout[b.usermap].enable?this.fadeTo(O(b,this.id),0.2):this.fadeTo(O(b,this.id),0);if("edit"==a.mode[b.usermap])return;
a.selected[b.usermap].push(this.id);0<a.infobox[b.usermap].length&&(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),a.infobox[b.usermap].pop());"undefined"==typeof a.usermap[b.usermap].map.geometry[this.id]||"undefined"==typeof a.usermap[b.usermap].map.geometry[this.id].infobox||document.getElementById("imap5_"+
b.usermap+"_infobox_geometry_"+this.id)||(k={},k.clientX=this._posX,k.clientY=this._posY,k.obj="geometry",k.infobox=a.usermap[b.usermap].map.geometry[this.id].infobox,this.infobox=new z(b,this.id,k))}this._move=this._touch=!1});"undefined"==typeof a.usermap[b.usermap].map.geometry[a.map[c].geometry[k].id]||"undefined"==typeof a.usermap[b.usermap].map.geometry[a.map[c].geometry[k].id].title||"undefined"!=typeof a.usermap[b.usermap].map.geometry_default.disableTooltip&&a.usermap[b.usermap].map.geometry_default.disableTooltip||
(g=r("title"),g.appendChild(document.createTextNode(a.usermap[b.usermap].map.geometry[a.map[c].geometry[k].id].title)),a.geometry[b.usermap][d].appendChild(g));for(var p in a.map[c].geometry[k].polygons){var q,s,n,v=[];if(a.map[c].geometry[k].polygons.hasOwnProperty(p)){var x=r("path");a.geometry[b.usermap][d].appendChild(x);var E="",y;for(y in a.map[c].geometry[k].polygons[p]){if(a.map[c].geometry[k].polygons[p].hasOwnProperty(y)){var E=E+"M",u=0,w=0,C=!0;n=0;g=-90;t=-180;q=90;s=180;var v=[],B;for(B in a.map[c].geometry[k].polygons[p][y])a.map[c].geometry[k].polygons[p][y].hasOwnProperty(B)&&
(C||(E+=" L"),h&&(a.factor[b.usermap]=wa(a.map[c].geometry[k].polygons[p][y][B][0],a.map[c].geometry[k].polygons[p][y][B][1]),h=!1),u+=a.map[c].geometry[k].polygons[p][y][B][0]/a.factor[b.usermap],e++,null!=a.map[c].geometry[k].polygons[p][y][B][1]&&(w+=a.map[c].geometry[k].polygons[p][y][B][1]/a.factor[b.usermap],e--),lat2=Math.log(Math.tan(Math.PI/4+Math.PI*(w/(a.map[c].precision/a.factor[b.usermap]))/360))*(180/Math.PI)*(a.map[c].precision/a.factor[b.usermap]),E+=l(u,a.precision)+" "+l(lat2,a.precision),
C=!1,n+=1,g=w*a.factor[b.usermap]/a.map[c].precision>g?w*a.factor[b.usermap]/a.map[c].precision:g,t=u*a.factor[b.usermap]/a.map[c].precision>t?u*a.factor[b.usermap]/a.map[c].precision:t,q=w*a.factor[b.usermap]/a.map[c].precision<q?w*a.factor[b.usermap]/a.map[c].precision:q,s=u*a.factor[b.usermap]/a.map[c].precision<s?u*a.factor[b.usermap]/a.map[c].precision:s,v[n-1]={},v[n-1].lat=w*a.factor[b.usermap]/a.map[c].precision,v[n-1].lng=u*a.factor[b.usermap]/a.map[c].precision);(g-q)*(t-s)>=f&&(f=(g-q)*
(t-s),m.length=0,m=v.slice(),v.length=0);E+=" Z "}x.setAttribute("d",E)}}}g=m.length;m[g]={};m[g].lat=m[0].lat;m[g].lng=m[0].lng;m=va(m);g=m.lat;t=m.lng;a.geometry[b.usermap][d].centroid={};a.geometry[b.usermap][d].centroid.lat=g;a.geometry[b.usermap][d].centroid.lng=t;a.geoareasize[b.usermap].push({id:d,area:f})}p=r("g");a.g[b.usermap].appendChild(p);p.setAttribute("id","imap5_"+b.usermap+"_centerref");y=r("g");B=r("circle");y.appendChild(B);p.appendChild(y);B.setAttribute("cx",0);B.setAttribute("cy",
0);B.setAttribute("r",0);B.setAttribute("stroke","#006600");B.setAttribute("stroke-width",0);B.setAttribute("fill","#ff0000");y.setAttribute("transform","scale(1,-1)");a.center[b.usermap]=p;a.center[b.usermap].setAttribute("transform","scale("+l(a.map[c].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")");if("undefined"!=typeof a.usermap[b.usermap].map.geometry_default.geometryAbbreviation&&"undefined"!=typeof a.usermap[b.usermap].map.geometry_default.geometryAbbreviation.enable&&
a.usermap[b.usermap].map.geometry_default.geometryAbbreviation.enable)for(k in ca.label.style=a.usermap[b.usermap].map.geometry_default.geometryAbbreviation.style,a.geometry[b.usermap])!a.geometry[b.usermap].hasOwnProperty(k)||"undefined"!=typeof a.usermap[b.usermap].map.geometry[k].hideAbbreviation&&a.usermap[b.usermap].map.geometry[k].hideAbbreviation||(p={},p.name=ca.name,p.lat=a.geometry[b.usermap][k].centroid.lat,p.lng=a.geometry[b.usermap][k].centroid.lng,p.label={},p.label.text="undefined"==
typeof a.usermap[b.usermap].map.geometry[k].title?"":a.usermap[b.usermap].map.geometry[k].title,p.label.style={},p.label.style=Object(ca.label.style),a.mapabbr[b.usermap][k]=new Aa(b,k,p));if("undefined"!=typeof a.usermap[b.usermap].map.bubblemap&&"undefined"!=typeof a.usermap[b.usermap].map.bubblemap.enable&&a.usermap[b.usermap].map.bubblemap.enable){p=0;for(k in a.geometry[b.usermap])a.mapbubblesize[b.usermap].push({id:a.geometry[b.usermap][k].id,bubblesize:Math.abs(a.usermap[b.usermap].map.geometry[k].bubblevalue)}),
Math.abs(a.usermap[b.usermap].map.geometry[k].bubblevalue)>=p&&(p=Math.abs(a.usermap[b.usermap].map.geometry[k].bubblevalue));a.mapbubblesize[b.usermap].sort(function(a,b){return b.bubblesize-a.bubblesize});a.usermap[b.usermap].map.bubblemap.maxbubble=p;for(p=0;p<a.mapbubblesize[b.usermap].length;p++)a.mapbubblesize[b.usermap].hasOwnProperty(p)&&(k=a.mapbubblesize[b.usermap][p].id,a.geometry[b.usermap].hasOwnProperty(k)&&(y={},y.lat=a.geometry[b.usermap][k].centroid.lat,y.lng=a.geometry[b.usermap][k].centroid.lng,
y.bubblevalue=a.usermap[b.usermap].map.geometry[k].bubblevalue,a.mapbubble[b.usermap][k]=new ha(b,k,y)))}if("undefined"!=typeof a.usermap[b.usermap].map.piechart&&"undefined"!=typeof a.usermap[b.usermap].map.piechart.enable&&a.usermap[b.usermap].map.piechart.enable)for(k in a.geometry[b.usermap])a.geometry[b.usermap].hasOwnProperty(k)&&(p={},p.lat=a.geometry[b.usermap][k].centroid.lat,p.lng=a.geometry[b.usermap][k].centroid.lng,p.pievalue=a.usermap[b.usermap].map.geometry[k].pievalue,a.piechart[b.usermap][k]=
new ia(b,k,p));for(k in a.usermap[b.usermap].map.mappoly)a.usermap[b.usermap].map.mappoly.hasOwnProperty(k)&&(a.mappoly[b.usermap][k]=new X(b,k,a.usermap[b.usermap].map.mappoly[k]));for(k in a.usermap[b.usermap].map.maprect)a.usermap[b.usermap].map.maprect.hasOwnProperty(k)&&(a.maprect[b.usermap][k]=new Y(b,k,a.usermap[b.usermap].map.maprect[k]));for(k in a.usermap[b.usermap].map.mappath)a.usermap[b.usermap].map.mappath.hasOwnProperty(k)&&(a.mappath[b.usermap][k]=new W(b,k,a.usermap[b.usermap].map.mappath[k]));
for(k in a.usermap[b.usermap].map.mapcurve)a.usermap[b.usermap].map.mapcurve.hasOwnProperty(k)&&(a.mapcurve[b.usermap][k]=new Z(b,k,a.usermap[b.usermap].map.mapcurve[k]));for(k in a.usermap[b.usermap].map.maplabel)a.usermap[b.usermap].map.maplabel.hasOwnProperty(k)&&(a.maplabel[b.usermap][k]=new ka(b,k,a.usermap[b.usermap].map.maplabel[k]));for(k in a.usermap[b.usermap].map.marker)a.usermap[b.usermap].map.marker.hasOwnProperty(k)&&(a.marker[b.usermap][k]=new ja(b,k,a.usermap[b.usermap].map.marker[k]));
for(k in a.usermap[b.usermap].map.maplegend)a.usermap[b.usermap].map.maplegend.hasOwnProperty(k)&&(a.maplegend[b.usermap][k]=new la(b,k,a.usermap[b.usermap].map.maplegend[k]));"undefined"!=typeof a.usermap[b.usermap].map.categorylegend&&"undefined"!=typeof a.usermap[b.usermap].map.categorylegend.enable&&a.usermap[b.usermap].map.categorylegend.enable&&(a.categorylegend[b.usermap]=new fa(b,a.usermap[b.usermap].map.categorylegend),P(b));"undefined"!=typeof a.usermap[b.usermap].map.maptitle&&(a.maptitle[b.usermap]=
new ga(b,a.usermap[b.usermap].map.maptitle));e+a.map[c].precision!=a.map[c].point&&za(b);ya(b);da(b);a.zoom[b.usermap].loadeditingsetting?A(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currenty,a.zoom[b.usermap].currentx):U(b,a.zoom[b.usermap].currentzoom,a.zoom[b.usermap].currentlat,a.zoom[b.usermap].currentlng)},v=function(a,c){var h=c.getScreenCTM();return a.matrixTransform(h.inverse())},q=function(a){return Math.log(Math.tan(Math.PI/4+Math.PI*a/360))*(180/Math.PI)},L=function(b){return 360*
(Math.atan(Math.pow(Math.E,b.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI},oa={name:"Path 1",points:"",style:{stroke:"#000000",strokeWidth:"2",strokeOpacity:"1"}},ca={name:"Label 1",label:{text:"",style:{fontSize:"12px",fontColor:"#000000",fontFamily:"Arial",fontStyle:"italic",fontWeight:"bold"}}},pa={name:"Polygon 1",points:"",fill:"#000000",fillOpacity:0.5,style:{stroke:"#000000",strokeWidth:"2",strokeOpacity:"1"}},qa={name:"Rectangle 1",points:"",fill:"#000000",fillOpacity:0.5,style:{stroke:"#000000",
strokeWidth:"2",strokeOpacity:"1"}},ra={name:"Curve 1",points:"",style:{stroke:"#000000",strokeWidth:"2",strokeOpacity:"1"}},ja=function(b,c,h){var e=a.usermap[b.usermap].map.id,f=r("g");a.g[b.usermap].appendChild(f);f._options=h;f._id=c;f.setAttribute("id","imap5_"+b.usermap+"_marker_"+c);f._lat=h.lat;f._lng=h.lng;f._dx=f._lng*(a.map[e].precision/a.factor[b.usermap]);f._dy=q(f._lat)*(a.map[e].precision/a.factor[b.usermap]);f._show=!0;f.setPosition=function(d){this._lat=a.usermap[b.usermap].map.marker[this._id].lat=
d.lat;this._lng=a.usermap[b.usermap].map.marker[this._id].lng=d.lng;this._dy=q(this._lat)*(a.map[e].precision/a.factor[b.usermap]);this._dx=this._lng*(a.map[e].precision/a.factor[b.usermap]);f.setAttribute("transform","translate("+l(this._dx,a.precision)+","+l(this._dy,a.precision)+") scale("+l(a.map[e].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")")};f.getPosition=function(){var a={};a.lat=this._lat;a.lng=this._lng;return a};f.setIcon=function(a){this._options.icon=
a;this.drawMarker()};f.setOptions=function(a){this._options=a};f.setLabel=function(a){this._options.label=a;this.drawMarker()};f.hide=function(){this.style.visibility="hidden";this._show=!1};f.show=function(){this.style.visibility="visible";this._show=!0};f.toggleCategory=function(){"normal"==a.mode[b.usermap]?"undefined"!=typeof a.usermap[b.usermap].map.categorylegend&&a.usermap[b.usermap].map.categorylegend.enable?0!=this._options.categoryid&&("undefined"!=typeof a.categorylegend[b.usermap]?-1!=
a.categorylegend[b.usermap].visiblelist.indexOf(this._options.categoryid)?this.show():this.hide():this.show()):this.show():this.show()};f.drawMarker=function(){var d=this.getElementsByTagName("g")[0];"undefined"!=typeof d&&this.removeChild(d);d=this.getElementsByTagName("text")[0];"undefined"!=typeof d&&this.removeChild(d);var d=r("g"),k=r("image");d.appendChild(k);this.appendChild(d);"local"==this._options.icon.type?k.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a.base[b.usermap]+this._options.icon.path):
k.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this._options.icon.path);k.setAttribute("x",this._options.icon.anchorx);k.setAttribute("y",this._options.icon.anchory);k.setAttribute("width",this._options.icon.width);k.setAttribute("height",this._options.icon.height);d.setAttribute("transform","scale(1,-1)");if(""!=this._options.label.text){k=r("text");this.appendChild(k);var c=document.createTextNode(this._options.label.text);k.appendChild(c);k.setAttribute("style","stroke-width:0;pointer-events:none");
k.style.strokeOpacity=0;k.style.fontFamily=this._options.label.style.fontFamily;k.style.fill=this._options.label.style.fontColor;k.style.fontSize=this._options.label.style.fontSize;k.style.fontStyle="undefined"!==typeof this._options.label.style.fontStyle?this._options.label.style.fontStyle:"normal";k.style.fontWeight="undefined"!==typeof this._options.label.style.fontWeight?this._options.label.style.fontWeight:"normal";var c="middle",g=0,f=0;switch(this._options.label.position){case "right":c="start";
g=d.getBBox().width/2+parseInt(this._options.label.offsetX);f=parseInt(k.style.fontSize)/2-(k.getBBox().height+k.getBBox().y)/2+parseInt(this._options.label.offsetY);break;case "top":c="middle";g=0+parseInt(this._options.label.offsetX);f=-d.getBBox().height/2-(k.getBBox().height+k.getBBox().y)/2+parseInt(this._options.label.offsetY);break;case "left":c="end";g=d.getBBox().x+parseInt(this._options.label.offsetX);f=parseInt(k.style.fontSize)/2-(k.getBBox().height+k.getBBox().y)/2+parseInt(this._options.label.offsetY);
break;case "bottom":c="middle";g=0+parseInt(this._options.label.offsetX);f=d.getBBox().height/2+parseInt(k.style.fontSize)-(k.getBBox().height+k.getBBox().y)/2+parseInt(this._options.label.offsetY);break;case "center":c="middle",g=0+parseInt(this._options.label.offsetX),f=parseInt(k.style.fontSize)/2-(k.getBBox().height+k.getBBox().y)/2+parseInt(this._options.label.offsetY)}k.setAttribute("x",g);k.setAttribute("y",f);k.setAttribute("transform","scale(1,-1)");k.setAttribute("text-anchor",c)}d=Math.log(Math.tan(Math.PI/
4+Math.PI*this._options.lat/360))*(180/Math.PI);k=this._options.lng;this._lat=d*(a.map[e].precision/a.factor[b.usermap]);this._lng=k*(a.map[e].precision/a.factor[b.usermap]);this.setAttribute("transform","translate("+l(k*(a.map[e].precision/a.factor[b.usermap]),a.precision)+","+l(d*(a.map[e].precision/a.factor[b.usermap]),a.precision)+") scale("+l(a.map[e].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")")};f.onmouseover=function(d){if("marker"==a.mode[b.usermap]||"edit"==
a.mode[b.usermap])this.style.cursor="pointer";"edit"==a.mode[b.usermap]&&null==a.selectedOverlay[b.usermap]&&s(b,d,"<strong>[Click]</strong> to select or <strong>[Drag]</strong> to change position");if(!a.touchdevices&&"normal"==a.mode[b.usermap]&&("undefined"!=typeof a.usermap[b.usermap].map.marker[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id].link&&(this.style.cursor="pointer"),"onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id]&&
"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id].infobox&&!document.getElementById("imap5_"+b.usermap+"_infobox_marker_"+this._id))){var k={};k.clientX=d.clientX;k.clientY=d.clientY;k.obj="marker";k.infobox=a.usermap[b.usermap].map.marker[this._id].infobox;this.infobox=new z(b,this._id,k)}};f.onmouseout=function(d){if("marker"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="auto";"edit"==a.mode[b.usermap]&&C(b);"normal"==a.mode[b.usermap]&&(this.style.cursor="auto","onmouseover"==
a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id].infobox&&(null==d.relatedTarget||d.relatedTarget.id!="imap5_"+b.usermap+"_infobox_marker_"+this._id)&&document.getElementById("imap5_"+b.usermap+"_infobox_marker_"+this._id)&&this.infobox.remove())};f.onmousedown=function(d){d.preventDefault&&d.preventDefault();"edit"==a.mode[b.usermap]&&(d.stopPropagation&&d.stopPropagation(),this._mousedown=
!0,this._mapdragged=!1,this._x=d.clientX,this._y=d.clientY,a.selectedOverlay[b.usermap]=this)};f.onmousemove=function(d){d.preventDefault&&d.preventDefault();if("edit"==a.mode[b.usermap])if(a.selectedOverlay[b.usermap]==this){if(d.stopPropagation&&d.stopPropagation(),this._mousedown&&(2<Math.abs(d.clientX-this._x)||2<Math.abs(d.clientY-this._y))){this._mapdragged=!0;this._x=d.clientX;this._y=d.clientY;var k=a.svgcoord[b.usermap];k.x=d.clientX;k.y=d.clientY;k=v(k,a.g[b.usermap]);k.x/=a.map[e].precision/
a.factor[b.usermap];k.y/=a.map[e].precision/a.factor[b.usermap];var c=k.x,g=360*(Math.atan(Math.pow(Math.E,k.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;M(g,c)||(this._lat=k.y*(a.map[e].precision/a.factor[b.usermap]),this._lng=k.x*(a.map[e].precision/a.factor[b.usermap]),this.setAttribute("transform","translate("+l(this._lng,a.precision)+","+l(this._lat,a.precision)+") scale("+l(a.map[e].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")"))}}else if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmousemove(d);
"normal"==a.mode[b.usermap]&&(a.div[b.usermap]._mousedown?document.getElementById("imap5_"+b.usermap+"_infobox_marker_"+this._id)&&this.infobox.hide():document.getElementById("imap5_"+b.usermap+"_infobox_marker_"+this._id)&&(this.infobox.reposition(d.clientX,d.clientY),this.infobox.show()))};f.onmouseup=function(d){d.preventDefault&&d.preventDefault();if("edit"==a.mode[b.usermap])if(a.selectedOverlay[b.usermap]==this)d.stopPropagation&&d.stopPropagation(),a.selectedOverlay[b.usermap]=null,d={event:"poschange",
object:"marker"},d.id=Number(this._id),d.lat=l(360*(Math.atan(Math.pow(Math.E,this._lat/(a.map[e].precision/a.factor[b.usermap])*Math.PI/180))-Math.PI/4)/Math.PI,a.precision),d.lng=l(this._lng/(a.map[e].precision/a.factor[b.usermap]),a.precision),window.console&&console.log(JSON.stringify(d)),this._mousedown=!1;else if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmouseup(d)};f.onclick=function(d){this._mapdragged||this._transformed||a.div[b.usermap]._mapdragged||("edit"==a.mode[b.usermap]?
(d={event:"click",object:"marker"},d.id=Number(this._id),window.console&&console.log(JSON.stringify(d))):"normal"==a.mode[b.usermap]&&"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id].link&&("undefined"==typeof a.usermap[b.usermap].map.marker[this._id].link_target?location.href=a.usermap[b.usermap].map.marker[this._id].link:window.open(a.usermap[b.usermap].map.marker[this._id].link,a.usermap[b.usermap].map.marker[this._id].link_target)))};
a.touchdevices&&(f.ontouchstart=function(a){1==a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=a.touches[0].clientY)},f.ontouchmove=function(a){1==a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1},f.ontouchend=function(d){if(this._touch&&!this._move&&!a.div[b.usermap]._mapdragged){if("edit"==a.mode[b.usermap]){d={event:"click",object:"marker"};d.id=this._id;
window.console&&console.log(JSON.stringify(d));return}"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.marker[this._id].link&&("undefined"==typeof a.usermap[b.usermap].map.marker[this._id].link_target?location.href=a.usermap[b.usermap].map.marker[this._id].link:window.open(a.usermap[b.usermap].map.marker[this._id].link,a.usermap[b.usermap].map.marker[this._id].link_target));if("edit"==a.mode[b.usermap])return;0<a.infobox[b.usermap].length&&
(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),a.infobox[b.usermap].pop());"undefined"==typeof a.usermap[b.usermap].map.marker[this._id]||"undefined"==typeof a.usermap[b.usermap].map.marker[this._id].infobox||document.getElementById("imap5_"+b.usermap+"_infobox_marker_"+this._id)||
(d={},d.clientX=this._posX,d.clientY=this._posY,d.obj="marker",d.infobox=a.usermap[b.usermap].map.marker[this._id].infobox,this.infobox=new z(b,this._id,d))}this._move=this._touch=!1});f.remove=function(){a.g[b.usermap].removeChild(this);a.marker[b.usermap][this._id]=null};f.drawMarker();return f},ka=function(b,c,h){var e=a.usermap[b.usermap].map.id,f=r("g");a.g[b.usermap].appendChild(f);f._options=h;f._id=c;f.setAttribute("id","imap5_"+b.usermap+"_maplabel_"+c);f._lat=h.lat;f._lng=h.lng;f._dx=f._lng*
(a.map[e].precision/a.factor[b.usermap]);f._dy=q(f._lat)*(a.map[e].precision/a.factor[b.usermap]);f._show=!0;f.setPosition=function(d){this._lat=a.usermap[b.usermap].map.maplabel[this._id].lat=d.lat;this._lng=a.usermap[b.usermap].map.maplabel[this._id].lng=d.lng;this._dy=q(this._lat)*(a.map[e].precision/a.factor[b.usermap]);this._dx=this._lng*(a.map[e].precision/a.factor[b.usermap]);f.setAttribute("transform","translate("+l(this._dx,a.precision)+","+l(this._dy,a.precision)+") scale("+l(a.map[e].precision/
a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")")};f.getPosition=function(){var a={};a.lat=this._lat;a.lng=this._lng;return a};f.setOptions=function(a){this._options=a};f.setLabel=function(a){this._options.label=a;this.drawMapLabel()};f.hide=function(){this.style.visibility="hidden";this._show=!1};f.show=function(){this.style.visibility="visible";this._show=!0};f.toggleCategory=function(){"normal"==a.mode[b.usermap]?"undefined"!=typeof a.usermap[b.usermap].map.categorylegend&&a.usermap[b.usermap].map.categorylegend.enable?
0!=this._options.categoryid&&("undefined"!=typeof a.categorylegend[b.usermap]?-1!=a.categorylegend[b.usermap].visiblelist.indexOf(this._options.categoryid)?this.show():this.hide():this.show()):this.show():this.show()};f.drawMapLabel=function(){var d=this.getElementsByTagName("text")[0];"undefined"!=typeof d&&this.removeChild(d);if(""!=this._options.label.text){d=r("text");this.appendChild(d);var k=document.createTextNode(this._options.label.text);d.appendChild(k);d.setAttribute("style","stroke-width:0");
d.style.strokeOpacity=0;d.style.fontFamily=this._options.label.style.fontFamily;d.style.fill=this._options.label.style.fontColor;d.style.fontSize=this._options.label.style.fontSize;d.style.fontStyle=this._options.label.style.fontStyle;d.style.fontWeight=this._options.label.style.fontWeight;"normal"==a.mode[b.usermap]&&(d.style.pointerEvents="none");k=0+parseInt(d.style.fontSize)/2-(d.getBBox().height+d.getBBox().y)/2;d.setAttribute("x",0);d.setAttribute("y",k);d.setAttribute("transform","scale(1,-1)");
d.setAttribute("text-anchor","middle")}d=Math.log(Math.tan(Math.PI/4+Math.PI*this._options.lat/360))*(180/Math.PI);k=this._options.lng;this._lat=d*(a.map[e].precision/a.factor[b.usermap]);this._lng=k*(a.map[e].precision/a.factor[b.usermap]);this.setAttribute("transform","translate("+l(k*(a.map[e].precision/a.factor[b.usermap]),a.precision)+","+l(d*(a.map[e].precision/a.factor[b.usermap]),a.precision)+") scale("+l(a.map[e].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")")};
f.onmouseover=function(d){if("maplabel"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="pointer";"edit"==a.mode[b.usermap]&&null==a.selectedOverlay[b.usermap]&&s(b,d,"<strong>[Click]</strong> to select or <strong>[Drag]</strong> to change position")};f.onmouseout=function(d){if("maplabel"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="auto";"edit"==a.mode[b.usermap]&&C(b);"normal"==a.mode[b.usermap]&&(this.style.cursor="auto")};f.onmousedown=function(d){d.preventDefault&&
d.preventDefault();"edit"==a.mode[b.usermap]&&(d.stopPropagation&&d.stopPropagation(),this._mousedown=!0,this._mapdragged=!1,this._x=d.clientX,this._y=d.clientY,a.selectedOverlay[b.usermap]=this)};f.onmousemove=function(d){d.preventDefault&&d.preventDefault();if("edit"==a.mode[b.usermap])if(a.selectedOverlay[b.usermap]==this){if(d.stopPropagation&&d.stopPropagation(),this._mousedown&&(2<Math.abs(d.clientX-this._x)||2<Math.abs(d.clientY-this._y))){this._mapdragged=!0;this._x=d.clientX;this._y=d.clientY;
var k=a.svgcoord[b.usermap];k.x=d.clientX;k.y=d.clientY;k=v(k,a.g[b.usermap]);k.x/=a.map[e].precision/a.factor[b.usermap];k.y/=a.map[e].precision/a.factor[b.usermap];d=k.x;var c=360*(Math.atan(Math.pow(Math.E,k.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;M(c,d)||(this._lat=k.y*(a.map[e].precision/a.factor[b.usermap]),this._lng=k.x*(a.map[e].precision/a.factor[b.usermap]),this.setAttribute("transform","translate("+l(this._lng,a.precision)+","+l(this._lat,a.precision)+") scale("+l(a.map[e].precision/
a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")"))}}else if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmousemove(d)};f.onmouseup=function(d){d.preventDefault&&d.preventDefault();if("edit"==a.mode[b.usermap])if(a.selectedOverlay[b.usermap]==this)d.stopPropagation&&d.stopPropagation(),a.selectedOverlay[b.usermap]=null,d={event:"poschange",object:"maplabel"},d.id=Number(this._id),d.lat=l(360*(Math.atan(Math.pow(Math.E,this._lat/(a.map[e].precision/a.factor[b.usermap])*
Math.PI/180))-Math.PI/4)/Math.PI,a.precision),d.lng=l(this._lng/(a.map[e].precision/a.factor[b.usermap]),a.precision),window.console&&console.log(JSON.stringify(d)),this._mousedown=!1;else if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmouseup(d)};f.onclick=function(d){this._mapdragged||this._transformed||"edit"!=a.mode[b.usermap]||(d={event:"click",object:"maplabel"},d.id=Number(this._id),window.console&&console.log(JSON.stringify(d)))};a.touchdevices&&(f.ontouchstart=function(a){1==
a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=a.touches[0].clientY)},f.ontouchmove=function(a){1==a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1},f.ontouchend=function(d){!this._touch||this._move||a.div[b.usermap]._mapdragged||"edit"!=a.mode[b.usermap]?this._move=this._touch=!1:(d={event:"click",object:"maplabel"},d.id=this._id,window.console&&console.log(JSON.stringify(d)))});
f.remove=function(){a.g[b.usermap].removeChild(this);a.maplabel[b.usermap][this._id]=null};f.drawMapLabel();return f},W=function(b,c,h){var e=a.usermap[b.usermap].map.id,f=r("g");a.g[b.usermap].appendChild(f);f._options=h;f._id=c;f.setAttribute("id","imap5_"+b.usermap+"_mappath_"+c);f._show=!0;f._points=h.points;f._movingpoints="";f._mainvertices=[];f._subvertices=[];f.updateVertices=function(b,k,c){var g=this._points.split(" ");g[b-1]=l(k,a.precision)+","+l(c,a.precision);b="";for(k=0;k<g.length;k++)""!=
b&&(b+=" "),b=b+g[k].split(",")[0]+","+g[k].split(",")[1];this._points=this._options.points=b;this.drawMapPath()};f.addVertices=function(b,k,c){for(var g=this._points.split(" "),e="",f=0;f<g.length;f++)""!=e&&(e+=" "),f==b&&(e=e+l(k,a.precision)+","+l(c,a.precision)+" "),e=e+g[f].split(",")[0]+","+g[f].split(",")[1];this._points=this._options.points=e;this.drawMapPath();this.postPosChange()};f.removeVertices=function(a){var b=this._points.split(" ");if(2<b.length){for(var e="",g=0;g<b.length;g++)g!=
a-1&&(""!=e&&(e+=" "),e=e+b[g].split(",")[0]+","+b[g].split(",")[1]);this._points=this._options.points=e;this.drawMapPath();this.postPosChange()}};f.postPosChange=function(){this.createVertices();var a={event:"poschange",object:"mappath"};a.id=Number(this._id);a.points=this._points;window.console&&console.log(JSON.stringify(a))};f.setPosition=function(d){this._points=a.usermap[b.usermap].map.mappath[this._id].points=d.points;this.drawMapPath()};f.getPosition=function(){var a={};a.points=this._points;
return a};f.setOptions=function(a){this._options=a};f.addPoint=function(a,b){var e=this._options.points;this._options.points=this._points=e+" "+a+","+b;this.drawMapPath()};f.hide=function(){this.style.visibility="hidden";this._show=!1};f.show=function(){this.style.visibility="visible";this._show=!0};f.toggleCategory=function(){"normal"==a.mode[b.usermap]?"undefined"!=typeof a.usermap[b.usermap].map.categorylegend&&a.usermap[b.usermap].map.categorylegend.enable?0!=this._options.categoryid&&("undefined"!=
typeof a.categorylegend[b.usermap]?-1!=a.categorylegend[b.usermap].visiblelist.indexOf(this._options.categoryid)?this.show():this.hide():this.show()):this.show():this.show()};f.drawMapPath=function(){var d=this.getElementsByTagName("polyline")[0];"undefined"!=typeof d&&this.removeChild(d);d=r("polyline");this.appendChild(d);d.setAttribute("fill","none");d.setAttribute("stroke",this._options.style.stroke);d.setAttribute("stroke-width",l(this._options.style.strokeWidth/a.zoom[b.usermap].currentzoom*
(a.map[e].precision/a.factor[b.usermap]),a.precision));if("undefined"!=typeof this._options.style.strokeDasharray&&"none"!==this._options.style.strokeDasharray){for(var k=this._options.style.strokeDasharray.split(","),c="",g=0;g<k.length;g++)""!=c&&(c+=","),c+=l(k[g]/a.zoom[b.usermap].currentzoom*(a.map[e].precision/a.factor[b.usermap]),a.precision);d.setAttribute("stroke-dasharray",c)}for(var k=this._options.points.split(" "),c="",f,h,g=0;g<k.length;g++)""!=c&&(c+=" "),f=k[g].split(","),h=q(f[0])*
(a.map[e].precision/a.factor[b.usermap]),f=f[1]*(a.map[e].precision/a.factor[b.usermap]),c=c+l(f,a.precision)+","+l(h,a.precision);""!=this._movingpoints&&(f=this._movingpoints.split(","),h=q(f[0])*(a.map[e].precision/a.factor[b.usermap]),f=f[1]*(a.map[e].precision/a.factor[b.usermap]),""!=c&&(c+=" "),c=c+l(f,a.precision)+","+l(h,a.precision));d.setAttribute("points",c);d.setAttribute("stroke-opacity",this._options.style.strokeOpacity);d.setAttribute("stroke-linejoin","round")};f.onmouseover=function(d){if("mappath"==
a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="pointer";"edit"==a.mode[b.usermap]&&s(b,d,"Click to select");if(!a.touchdevices&&"normal"==a.mode[b.usermap]&&("undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id].link&&(this.style.cursor="pointer"),"onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id].infobox&&
!document.getElementById("imap5_"+b.usermap+"_infobox_mappath_"+this._id))){var k={};k.clientX=d.clientX;k.clientY=d.clientY;k.obj="mappath";k.infobox=a.usermap[b.usermap].map.mappath[this._id].infobox;this.infobox=new z(b,this._id,k)}};f.onmouseout=function(d){if("mappath"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="auto";"edit"==a.mode[b.usermap]&&C(b);"normal"==a.mode[b.usermap]&&(this.style.cursor="auto","onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id]&&
"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id].infobox&&(null==d.relatedTarget||d.relatedTarget.id!="imap5_"+b.usermap+"_infobox_mappath_"+this._id)&&document.getElementById("imap5_"+b.usermap+"_infobox_mappath_"+this._id)&&this.infobox.remove())};f.onmousemove=function(d){d.preventDefault&&d.preventDefault();"normal"==a.mode[b.usermap]&&(a.div[b.usermap]._mousedown?document.getElementById("imap5_"+b.usermap+"_infobox_mappath_"+this._id)&&this.infobox.hide():document.getElementById("imap5_"+
b.usermap+"_infobox_mappath_"+this._id)&&(this.infobox.reposition(d.clientX,d.clientY),this.infobox.show()))};f.createVertices=function(){null!=a.selectedVerticesObj[b.usermap]&&a.selectedVerticesObj[b.usermap]!=this&&a.selectedVerticesObj[b.usermap].deleteVertices();a.selectedVerticesObj[b.usermap]=this;for(var d in this._mainvertices)this._mainvertices.hasOwnProperty(d)&&this._mainvertices[d].remove();this._mainvertices.length=0;for(var k in this._subvertices)this._subvertices.hasOwnProperty(k)&&
this._subvertices[k].remove();this._subvertices.length=0;var c=this._points.split(" "),g={};for(d=0;d<c.length;d++)k=c[d].split(","),g.lat=k[0],g.lng=k[1],g.type=0,g.removable=!0,this._mainvertices[d+1]=new K(b,d+1,this,g),g={};var e,g={};for(k=0;k<c.length-1;k++)d=c[k].split(","),e=c[k+1].split(","),g.lat=l(L((q(d[0])+q(e[0]))/2),a.precision),g.lng=l((parseFloat(d[1])+parseFloat(e[1]))/2,a.precision),g.type=1,g.removable=!1,this._subvertices[k+1]=new K(b,k+1,this,g),g={}};f.deleteVertices=function(){for(var a in this._mainvertices)this._mainvertices.hasOwnProperty(a)&&
this._mainvertices[a].remove();this._mainvertices.length=0;for(var b in this._subvertices)this._subvertices.hasOwnProperty(b)&&this._subvertices[b].remove();this._subvertices.length=0};f.hideSubVertices=function(){for(var a in this._subvertices)this._subvertices.hasOwnProperty(a)&&this._subvertices[a].hide()};f.showSubVertices=function(){for(var a in this._subvertices)this._subvertices.hasOwnProperty(a)&&this._subvertices[a].show()};f.onclick=function(d){this._mapdragged||this._transformed||a.div[b.usermap]._mapdragged||
("edit"==a.mode[b.usermap]?(this.createVertices(),d={event:"click",object:"mappath"},d.id=Number(this._id),window.console&&console.log(JSON.stringify(d))):"normal"==a.mode[b.usermap]&&"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id].link&&("undefined"==typeof a.usermap[b.usermap].map.mappath[this._id].link_target?location.href=a.usermap[b.usermap].map.mappath[this._id].link:window.open(a.usermap[b.usermap].map.mappath[this._id].link,
a.usermap[b.usermap].map.mappath[this._id].link_target)))};a.touchdevices&&(f.ontouchstart=function(a){1==a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=a.touches[0].clientY)},f.ontouchmove=function(a){1==a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1},f.ontouchend=function(d){if(this._touch&&!this._move&&!a.div[b.usermap]._mapdragged){if("edit"==
a.mode[b.usermap]){d={event:"click",object:"mappath"};d.id=this._id;window.console&&console.log(JSON.stringify(d));return}"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mappath[this._id].link&&("undefined"==typeof a.usermap[b.usermap].map.mappath[this._id].link_target?location.href=a.usermap[b.usermap].map.mappath[this._id].link:window.open(a.usermap[b.usermap].map.mappath[this._id].link,a.usermap[b.usermap].map.mappath[this._id].link_target));
if("edit"==a.mode[b.usermap])return;0<a.infobox[b.usermap].length&&(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),a.infobox[b.usermap].pop());"undefined"==typeof a.usermap[b.usermap].map.mappath[this._id]||"undefined"==typeof a.usermap[b.usermap].map.mappath[this._id].infobox||document.getElementById("imap5_"+
b.usermap+"_infobox_mappath_"+this._id)||(d={},d.clientX=this._posX,d.clientY=this._posY,d.obj="mappath",d.infobox=a.usermap[b.usermap].map.mappath[this._id].infobox,this.infobox=new z(b,this._id,d))}this._move=this._touch=!1});f.remove=function(){for(var d in this._mainvertices)this._mainvertices.hasOwnProperty(d)&&this._mainvertices[d].remove();for(d in this._subvertices)this._subvertices.hasOwnProperty(d)&&this._subvertices[d].remove();a.g[b.usermap].removeChild(this);a.mappath[b.usermap][this._id]=
null};f.drawMapPath();return f},X=function(b,c,h){var e=a.usermap[b.usermap].map.id,f=r("g");a.g[b.usermap].appendChild(f);f._options=h;f._id=c;f.setAttribute("id","imap5_"+b.usermap+"_mappoly_"+c);f._points=h.points;f._movingpoints="";f._mainvertices=[];f._subvertices=[];f.ishighlight=!1;f._show=!0;f.updateVertices=function(b,k,c){var g=this._points.split(" ");g[b-1]=l(k,a.precision)+","+l(c,a.precision);b="";for(k=0;k<g.length;k++)""!=b&&(b+=" "),b=b+g[k].split(",")[0]+","+g[k].split(",")[1];this._points=
this._options.points=b;this.drawMapPoly()};f.addVertices=function(b,k,c){for(var g=this._points.split(" "),e="",f=0;f<g.length;f++)""!=e&&(e+=" "),f==b&&(e=e+l(k,a.precision)+","+l(c,a.precision)+" "),e=e+g[f].split(",")[0]+","+g[f].split(",")[1];b==g.length&&(""!=e&&(e+=" "),e=e+l(k,a.precision)+","+l(c,a.precision));this._points=this._options.points=e;this.drawMapPoly();this.postPosChange()};f.removeVertices=function(a){var b=this._points.split(" ");if(3<b.length){for(var c="",g=0;g<b.length;g++)g!=
a-1&&(""!=c&&(c+=" "),c=c+b[g].split(",")[0]+","+b[g].split(",")[1]);this._points=this._options.points=c;this.drawMapPoly();this.postPosChange()}};f.postPosChange=function(){this.createVertices();var a={event:"poschange",object:"mappoly"};a.id=Number(this._id);a.points=this._points;window.console&&console.log(JSON.stringify(a))};f.setPosition=function(d){this._points=a.usermap[b.usermap].map.mappoly[this._id].points=d.points;this.drawMapPoly()};f.getPosition=function(){var a={};a.points=this._points;
return a};f.setOptions=function(a){this._options=a;this._points=a.points};f.addPoint=function(a,b){var c=this._options.points;this._options.points=this._points=c+" "+a+","+b;this.drawMapPoly()};f.hide=function(){this.style.visibility="hidden";this._show=!1};f.show=function(){this.style.visibility="visible";this._show=!0};f.toggleCategory=function(){"normal"==a.mode[b.usermap]?"undefined"!=typeof a.usermap[b.usermap].map.categorylegend&&a.usermap[b.usermap].map.categorylegend.enable?0!=this._options.categoryid&&
("undefined"!=typeof a.categorylegend[b.usermap]?-1!=a.categorylegend[b.usermap].visiblelist.indexOf(this._options.categoryid)?this.show():this.hide():this.show()):this.show():this.show()};f.count=function(){return this._options.points.split(" ").length};f.drawMapPoly=function(){var d=this.getElementsByTagName("polygon")[0];"undefined"!=typeof d&&this.removeChild(d);d=this.getElementsByTagName("polyline")[0];"undefined"!=typeof d&&this.removeChild(d);d=1>=this.count()?r("polyline"):r("polygon");this.appendChild(d);
d.setAttribute("fill",this._options.fill);d.setAttribute("fill-opacity",this._options.fillOpacity);d.setAttribute("stroke",this._options.style.stroke);d.setAttribute("stroke-width",l(this._options.style.strokeWidth/a.zoom[b.usermap].currentzoom*(a.map[e].precision/a.factor[b.usermap]),a.precision));if("undefined"!=typeof this._options.style.strokeDasharray&&"none"!==this._options.style.strokeDasharray){for(var k=this._options.style.strokeDasharray.split(","),c="",g=0;g<k.length;g++)""!=c&&(c+=","),
c+=l(k[g]/a.zoom[b.usermap].currentzoom*(a.map[e].precision/a.factor[b.usermap]),a.precision);d.setAttribute("stroke-dasharray",c)}for(var k=this._options.points.split(" "),c="",f,h,g=0;g<k.length;g++)""!=c&&(c+=" "),f=k[g].split(","),h=q(f[0])*(a.map[e].precision/a.factor[b.usermap]),f=f[1]*(a.map[e].precision/a.factor[b.usermap]),c=c+l(f,a.precision)+","+l(h,a.precision);""!=this._movingpoints&&(f=this._movingpoints.split(","),h=q(f[0])*(a.map[e].precision/a.factor[b.usermap]),f=f[1]*(a.map[e].precision/
a.factor[b.usermap]),""!=c&&(c+=" "),c=c+l(f,a.precision)+","+l(h,a.precision));d.setAttribute("points",c);d.setAttribute("stroke-opacity",this._options.style.strokeOpacity);d.setAttribute("stroke-linejoin","round")};a.touchdevices||(f.onmouseover=function(d){if("mappoly"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="pointer";"edit"==a.mode[b.usermap]&&null==a.selectedOverlay[b.usermap]&&(s(b,d,"<strong>[Click]</strong> to select and <strong>[Drag]</strong> to change position"),
this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fillHighlight),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillHighlightOpacity));if(!a.touchdevices&&"normal"==a.mode[b.usermap]&&("undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id].link&&(this.style.cursor="pointer"),this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fillHighlight),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",
this._options.fillHighlightOpacity),"onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id].infobox&&!document.getElementById("imap5_"+b.usermap+"_infobox_mappoly_"+this._id))){var k={};k.clientX=d.clientX;k.clientY=d.clientY;k.obj="mappoly";k.infobox=a.usermap[b.usermap].map.mappoly[this._id].infobox;this.infobox=new z(b,this._id,k)}});a.touchdevices||(f.onmouseout=function(d){if("mappoly"==
a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="auto";"edit"==a.mode[b.usermap]&&(C(b),this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fill),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillOpacity));"normal"==a.mode[b.usermap]&&(this.style.cursor="auto",this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fill),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillOpacity),
"onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id].infobox&&(null==d.relatedTarget||d.relatedTarget.id!="imap5_"+b.usermap+"_infobox_mappoly_"+this._id)&&document.getElementById("imap5_"+b.usermap+"_infobox_mappoly_"+this._id)&&this.infobox.remove())});f.onmousedown=function(d){d.preventDefault&&d.preventDefault();"edit"==a.mode[b.usermap]&&(d.stopPropagation&&d.stopPropagation(),
this._mousedown=!0,this._mapdragged=!1,this._x=d.clientX,this._y=d.clientY,a.selectedOverlay[b.usermap]=this)};f.onmouseup=function(d){d.preventDefault&&d.preventDefault();if("edit"==a.mode[b.usermap])if(a.selectedOverlay[b.usermap]==this)d.stopPropagation&&d.stopPropagation(),a.selectedOverlay[b.usermap]=null,this.createVertices(),d={event:"poschange",object:"mappoly"},d.id=Number(this._id),d.points=this._points,window.console&&console.log(JSON.stringify(d)),this._mousedown=!1;else if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmouseup(d)};
f.onmousemove=function(d){d.preventDefault&&d.preventDefault();if("edit"==a.mode[b.usermap])if(a.selectedOverlay[b.usermap]==this){if(this._mousedown&&(d.stopPropagation&&d.stopPropagation(),2<Math.abs(d.clientX-this._x)||2<Math.abs(d.clientY-this._y))){this._mapdragged=!0;var k=l((d.clientX-this._x)/a.zoom[b.usermap].currentzoom,a.precision),c=l((d.clientY-this._y)/a.zoom[b.usermap].currentzoom,a.precision),g=this._points.split(" "),e,f;for(f in g)g.hasOwnProperty(f)&&(e=g[f].split(","),g[f]=l(L(q(parseFloat(e[0]))-
c),a.precision)+","+l(parseFloat(e[1])+k,a.precision));k="";for(f=0;f<g.length;f++)""!=k&&(k+=" "),k=k+g[f].split(",")[0]+","+g[f].split(",")[1];this._points=this._options.points=k;this.deleteVertices();this.drawMapPoly();this.createVertices();this._x=d.clientX;this._y=d.clientY}}else if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmousemove(d);"normal"==a.mode[b.usermap]&&(a.div[b.usermap]._mousedown?document.getElementById("imap5_"+b.usermap+"_infobox_mappoly_"+this._id)&&this.infobox.hide():
document.getElementById("imap5_"+b.usermap+"_infobox_mappoly_"+this._id)&&(this.infobox.reposition(d.clientX,d.clientY),this.infobox.show()))};f.createVertices=function(){null!=a.selectedVerticesObj[b.usermap]&&a.selectedVerticesObj[b.usermap]!=this&&a.selectedVerticesObj[b.usermap].deleteVertices();a.selectedVerticesObj[b.usermap]=this;for(var d in this._mainvertices)this._mainvertices.hasOwnProperty(d)&&this._mainvertices[d].remove();this._mainvertices.length=0;for(var k in this._subvertices)this._subvertices.hasOwnProperty(d)&&
this._subvertices[k].remove();this._subvertices.length=0;var c=this._points.split(" "),e={};for(d=0;d<c.length;d++)k=c[d].split(","),e.lat=k[0],e.lng=k[1],e.type=0,e.removable=!0,this._mainvertices[d+1]=new K(b,d+1,this,e),e={};var f,e={};for(k=0;k<c.length-1;k++)d=c[k].split(","),f=c[k+1].split(","),e.lat=l(L((q(d[0])+q(f[0]))/2),a.precision),e.lng=l((parseFloat(d[1])+parseFloat(f[1]))/2,a.precision),e.type=1,e.removable=!1,this._subvertices[k+1]=new K(b,k+1,this,e),e={};k=c.length-1;d=c[k].split(",");
f=c[0].split(",");e.lat=l(L((q(d[0])+q(f[0]))/2),a.precision);e.lng=l((parseFloat(d[1])+parseFloat(f[1]))/2,a.precision);e.type=1;e.removable=!1;this._subvertices[k+1]=new K(b,k+1,this,e)};f.deleteVertices=function(){for(var a in this._mainvertices)this._mainvertices.hasOwnProperty(a)&&this._mainvertices[a].remove();this._mainvertices.length=0;for(var b in this._subvertices)this._subvertices.hasOwnProperty(b)&&this._subvertices[b].remove();this._subvertices.length=0};f.hideSubVertices=function(){for(var a in this._subvertices)this._subvertices.hasOwnProperty(a)&&
this._subvertices[a].hide()};f.showSubVertices=function(){for(var a in this._subvertices)this._subvertices.hasOwnProperty(a)&&this._subvertices[a].show()};f.onclick=function(d){this._mapdragged||this._transformed||a.div[b.usermap]._mapdragged||("edit"==a.mode[b.usermap]?(this.createVertices(),d={event:"click",object:"mappoly"},d.id=Number(this._id),window.console&&console.log(JSON.stringify(d))):"normal"==a.mode[b.usermap]&&"undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id]&&"undefined"!=
typeof a.usermap[b.usermap].map.mappoly[this._id].link&&("undefined"==typeof a.usermap[b.usermap].map.mappoly[this._id].link_target?location.href=a.usermap[b.usermap].map.mappoly[this._id].link:window.open(a.usermap[b.usermap].map.mappoly[this._id].link,a.usermap[b.usermap].map.mappoly[this._id].link_target)))};a.touchdevices&&(f.ontouchstart=function(a){1==a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=a.touches[0].clientY)},f.ontouchmove=function(a){1==
a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1},f.ontouchend=function(d){if(this._touch&&!this._move&&!a.div[b.usermap]._mapdragged){if("edit"==a.mode[b.usermap]){d={event:"click",object:"mappoly"};d.id=this._id;window.console&&console.log(JSON.stringify(d));return}"undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mappoly[this._id].link&&
("undefined"==typeof a.usermap[b.usermap].map.mappoly[this._id].link_target?location.href=a.usermap[b.usermap].map.mappoly[this._id].link:window.open(a.usermap[b.usermap].map.mappoly[this._id].link,a.usermap[b.usermap].map.mappoly[this._id].link_target));if("edit"==a.mode[b.usermap])return;this.ishighlight?(this.ishighlight=!1,this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fill),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillOpacity)):
(this.ishighlight=!0,this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fillHighlight),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillHighlightOpacity));0<a.infobox[b.usermap].length&&(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),
a.infobox[b.usermap].pop());"undefined"==typeof a.usermap[b.usermap].map.mappoly[this._id]||"undefined"==typeof a.usermap[b.usermap].map.mappoly[this._id].infobox||document.getElementById("imap5_"+b.usermap+"_infobox_mappoly_"+this._id)||(d={},d.clientX=this._posX,d.clientY=this._posY,d.obj="mappoly",d.infobox=a.usermap[b.usermap].map.mappoly[this._id].infobox,this.infobox=new z(b,this._id,d))}this._move=this._touch=!1});f.remove=function(){for(var d in this._mainvertices)this._mainvertices.hasOwnProperty(d)&&
this._mainvertices[d].remove();for(d in this._subvertices)this._subvertices.hasOwnProperty(d)&&this._subvertices[d].remove();a.g[b.usermap].removeChild(this);a.mappoly[b.usermap][this._id]=null};f.drawMapPoly();return f},Y=function(b,c,h){var e=a.usermap[b.usermap].map.id,f=r("g");a.g[b.usermap].appendChild(f);f._options=h;f._id=c;f.setAttribute("id","imap5_"+b.usermap+"_maprect_"+c);f._points=h.points;f._movingpoints="";f._mainvertices=[];f.ishighlight=!1;f._show=!0;f.setOptions=function(a){this._options=
a;this._points=a.points};f.hide=function(){this.style.visibility="hidden";this._show=!1};f.show=function(){this.style.visibility="visible";this._show=!0};f.toggleCategory=function(){"normal"==a.mode[b.usermap]?"undefined"!=typeof a.usermap[b.usermap].map.categorylegend&&a.usermap[b.usermap].map.categorylegend.enable?0!=this._options.categoryid&&("undefined"!=typeof a.categorylegend[b.usermap]?-1!=a.categorylegend[b.usermap].visiblelist.indexOf(this._options.categoryid)?this.show():this.hide():this.show()):
this.show():this.show()};f.createVertices=function(){null!=a.selectedVerticesObj[b.usermap]&&a.selectedVerticesObj[b.usermap]!=this&&a.selectedVerticesObj[b.usermap].deleteVertices();a.selectedVerticesObj[b.usermap]=this;for(var d in this._mainvertices)this._mainvertices.hasOwnProperty(d)&&this._mainvertices[d].remove();this._mainvertices.length=0;var k=this._points.split(" "),c,e={};for(d=0;d<k.length;d++)c=k[d].split(","),e.lat=c[0],e.lng=c[1],e.type=0,e.removable=!1,this._mainvertices[d+1]=new K(b,
d+1,this,e),e={}};f.deleteVertices=function(){for(var a in this._mainvertices)this._mainvertices.hasOwnProperty(a)&&this._mainvertices[a].remove();this._mainvertices.length=0};f.postPosChange=function(){this.createVertices();var a={event:"poschange",object:"maprect"};a.id=Number(this._id);a.points=this._points;window.console&&console.log(JSON.stringify(a))};f.updateVertices=function(b,k,c){var e=this._points.split(" ");e[b-1]=l(k,a.precision)+","+l(c,a.precision);e[b-1].split(",");var f=e[(b-1+2)%
4].split(",");e[(b-1+1)%4]=l(f[0],a.precision)+","+l(c,a.precision);e[(b-1+2)%4]=l(f[0],a.precision)+","+l(f[1],a.precision);e[(b-1+3)%4]=l(k,a.precision)+","+l(f[1],a.precision);for(var h="",h="",r=0;r<e.length;r++)""!=h&&(h+=" "),h=h+e[r].split(",")[0]+","+e[r].split(",")[1];this._points=this._options.points=h;e={};e.lat=f[0];e.lng=c;e.type=0;e.removable=!1;this._mainvertices[(b-1+1)%4+1].setOptions(e);this._mainvertices[(b-1+1)%4+1].drawVerticesObj();e={};e.lat=k;e.lng=f[1];e.type=0;e.removable=
!1;this._mainvertices[(b-1+3)%4+1].setOptions(e);this._mainvertices[(b-1+3)%4+1].drawVerticesObj();this.drawMapRect()};f.hideSubVertices=function(){};f.showSubVertices=function(){};f.drawMapRect=function(){var d=this.getElementsByTagName("polygon")[0];"undefined"!=typeof d&&this.removeChild(d);d=r("polygon");this.appendChild(d);d.setAttribute("fill",this._options.fill);d.setAttribute("fill-opacity",this._options.fillOpacity);d.setAttribute("stroke",this._options.style.stroke);d.setAttribute("stroke-width",
l(this._options.style.strokeWidth/a.zoom[b.usermap].currentzoom*(a.map[e].precision/a.factor[b.usermap]),a.precision));if("undefined"!=typeof this._options.style.strokeDasharray&&"none"!==this._options.style.strokeDasharray){for(var k=this._options.style.strokeDasharray.split(","),c="",g=0;g<k.length;g++)""!=c&&(c+=","),c+=l(k[g]/a.zoom[b.usermap].currentzoom*(a.map[e].precision/a.factor[b.usermap]),a.precision);d.setAttribute("stroke-dasharray",c)}var k=this._options.points.split(" "),c="",f,h;h=
g="";if(1==k.length)g=k[0].split(","),h=""==this._movingpoints?g:this._movingpoints.split(","),c=c+l(g[1]*(a.map[e].precision/a.factor[b.usermap]),a.precision)+",",c=c+l(q(g[0])*(a.map[e].precision/a.factor[b.usermap]),a.precision)+" ",c=c+l(h[1]*(a.map[e].precision/a.factor[b.usermap]),a.precision)+",",c=c+l(q(g[0])*(a.map[e].precision/a.factor[b.usermap]),a.precision)+" ",c=c+l(h[1]*(a.map[e].precision/a.factor[b.usermap]),a.precision)+",",c=c+l(q(h[0])*(a.map[e].precision/a.factor[b.usermap]),
a.precision)+" ",c=c+l(g[1]*(a.map[e].precision/a.factor[b.usermap]),a.precision)+",",c+=l(q(h[0])*(a.map[e].precision/a.factor[b.usermap]),a.precision);else for(g=0;g<k.length;g++)""!=c&&(c+=" "),f=k[g].split(","),h=q(f[0])*(a.map[e].precision/a.factor[b.usermap]),f=f[1]*(a.map[e].precision/a.factor[b.usermap]),c=c+l(f,a.precision)+","+l(h,a.precision);d.setAttribute("points",c);d.setAttribute("stroke-opacity",this._options.style.strokeOpacity);d.setAttribute("stroke-linejoin","round")};f.onclick=
function(d){this._mapdragged||this._transformed||a.div[b.usermap]._mapdragged||("edit"==a.mode[b.usermap]?(this.createVertices(),d={event:"click",object:"maprect"},d.id=Number(this._id),window.console&&console.log(JSON.stringify(d))):"normal"==a.mode[b.usermap]&&"undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id].link&&("undefined"==typeof a.usermap[b.usermap].map.maprect[this._id].link_target?location.href=a.usermap[b.usermap].map.maprect[this._id].link:
window.open(a.usermap[b.usermap].map.maprect[this._id].link,a.usermap[b.usermap].map.maprect[this._id].link_target)))};a.touchdevices||(f.onmouseover=function(d){if("maprect"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="pointer";"edit"==a.mode[b.usermap]&&null==a.selectedOverlay[b.usermap]&&(s(b,d,"<strong>[Click]</strong> to select and <strong>[Drag]</strong> to change position"),this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fillHighlight),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",
this._options.fillHighlightOpacity));if(!a.touchdevices&&"normal"==a.mode[b.usermap]&&("undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id].link&&(this.style.cursor="pointer"),this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fillHighlight),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillHighlightOpacity),"onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=
typeof a.usermap[b.usermap].map.maprect[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id].infobox&&!document.getElementById("imap5_"+b.usermap+"_infobox_maprect_"+this._id))){var c={};c.clientX=d.clientX;c.clientY=d.clientY;c.obj="maprect";c.infobox=a.usermap[b.usermap].map.maprect[this._id].infobox;this.infobox=new z(b,this._id,c)}});a.touchdevices||(f.onmouseout=function(d){if("maprect"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="auto";"edit"==a.mode[b.usermap]&&
(C(b),this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fill),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillOpacity));"normal"==a.mode[b.usermap]&&(this.style.cursor="auto",this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fill),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillOpacity),"onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id]&&
"undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id].infobox&&(null==d.relatedTarget||d.relatedTarget.id!="imap5_"+b.usermap+"_infobox_maprect_"+this._id)&&document.getElementById("imap5_"+b.usermap+"_infobox_maprect_"+this._id)&&this.infobox.remove())});f.onmousedown=function(d){d.preventDefault&&d.preventDefault();"edit"==a.mode[b.usermap]&&(d.stopPropagation&&d.stopPropagation(),this._mousedown=!0,this._mapdragged=!1,this._x=d.clientX,this._y=d.clientY,a.selectedOverlay[b.usermap]=this)};
f.onmouseup=function(d){d.preventDefault&&d.preventDefault();if("edit"==a.mode[b.usermap])if(a.selectedOverlay[b.usermap]==this)d.stopPropagation&&d.stopPropagation(),a.selectedOverlay[b.usermap]=null,this.createVertices(),d={event:"poschange",object:"maprect"},d.id=Number(this._id),d.points=this._points,window.console&&console.log(JSON.stringify(d)),this._mousedown=!1;else if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmouseup(d)};f.onmousemove=function(d){d.preventDefault&&
d.preventDefault();if("edit"==a.mode[b.usermap])if(a.selectedOverlay[b.usermap]==this){if(this._mousedown&&(d.stopPropagation&&d.stopPropagation(),2<Math.abs(d.clientX-this._x)||2<Math.abs(d.clientY-this._y))){this._mapdragged=!0;var c=l((d.clientX-this._x)/a.zoom[b.usermap].currentzoom,a.precision),e=l((d.clientY-this._y)/a.zoom[b.usermap].currentzoom,a.precision),g=this._points.split(" "),f,h;for(h in g)g.hasOwnProperty(h)&&(f=g[h].split(","),g[h]=l(L(q(parseFloat(f[0]))-e),a.precision)+","+l(parseFloat(f[1])+
c,a.precision));c="";for(h=0;h<g.length;h++)""!=c&&(c+=" "),c=c+g[h].split(",")[0]+","+g[h].split(",")[1];this._points=this._options.points=c;this.deleteVertices();this.drawMapRect();this.createVertices();this._x=d.clientX;this._y=d.clientY}}else if(null!=a.selectedOverlay[b.usermap])a.selectedOverlay[b.usermap].onmousemove(d);"normal"==a.mode[b.usermap]&&(a.div[b.usermap]._mousedown?document.getElementById("imap5_"+b.usermap+"_infobox_maprect_"+this._id)&&this.infobox.hide():document.getElementById("imap5_"+
b.usermap+"_infobox_maprect_"+this._id)&&(this.infobox.reposition(d.clientX,d.clientY),this.infobox.show()))};a.touchdevices&&(f.ontouchstart=function(a){1==a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=a.touches[0].clientY)},f.ontouchmove=function(a){1==a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1},f.ontouchend=function(d){if(this._touch&&!this._move&&
!a.div[b.usermap]._mapdragged){if("edit"==a.mode[b.usermap]){d={event:"click",object:"maprect"};d.id=this._id;window.console&&console.log(JSON.stringify(d));return}"undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.maprect[this._id].link&&("undefined"==typeof a.usermap[b.usermap].map.maprect[this._id].link_target?location.href=a.usermap[b.usermap].map.maprect[this._id].link:window.open(a.usermap[b.usermap].map.maprect[this._id].link,a.usermap[b.usermap].map.maprect[this._id].link_target));
if("edit"==a.mode[b.usermap])return;this.ishighlight?(this.ishighlight=!1,this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fill),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillOpacity)):(this.ishighlight=!0,this.getElementsByTagName("polygon")[0].setAttribute("fill",this._options.fillHighlight),this.getElementsByTagName("polygon")[0].setAttribute("fill-opacity",this._options.fillHighlightOpacity));0<a.infobox[b.usermap].length&&(document.getElementById("imap5_"+
b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),a.infobox[b.usermap].pop());"undefined"==typeof a.usermap[b.usermap].map.maprect[this._id]||"undefined"==typeof a.usermap[b.usermap].map.maprect[this._id].infobox||document.getElementById("imap5_"+b.usermap+"_infobox_maprect_"+this._id)||(d={},d.clientX=this._posX,d.clientY=
this._posY,d.obj="maprect",d.infobox=a.usermap[b.usermap].map.maprect[this._id].infobox,this.infobox=new z(b,this._id,d))}this._move=this._touch=!1});f.remove=function(){for(var d in this._mainvertices)this._mainvertices.hasOwnProperty(d)&&this._mainvertices[d].remove();a.g[b.usermap].removeChild(this);a.maprect[b.usermap][this._id]=null};f.drawMapRect();return f},Z=function(b,c,h){var e=a.usermap[b.usermap].map.id,f=r("g");a.g[b.usermap].appendChild(f);f._options=h;f._id=c;f.setAttribute("id","imap5_"+
b.usermap+"_mapcurve_"+c);f._points=h.points;f._movingpoints="";f._mainvertices=[];f._show=!0;f.updateVertices=function(b,c,e){var g=this._points.split(" ");g[b-1]=l(c,a.precision)+","+l(e,a.precision);b="";for(c=0;c<g.length;c++)""!=b&&(b+=" "),b=b+g[c].split(",")[0]+","+g[c].split(",")[1];this._points=this._options.points=b;this.drawMapCurve()};f.postPosChange=function(){this.createVertices();var a={event:"poschange",object:"mapcurve"};a.id=Number(this._id);a.points=this._points;window.console&&
console.log(JSON.stringify(a))};f.setPosition=function(d){this._points=a.usermap[b.usermap].map.mapcurve[this._id].points=d.points;this.drawMapCurve()};f.getPosition=function(){var a={};a.points=this._points;return a};f.setOptions=function(a){this._options=a};f.count=function(){return this._options.points.split(" ").length};f.addPoint=function(a,b){var c=this._options.points;this._options.points=this._points=c+" "+a+","+b;this.drawMapCurve()};f.hide=function(){this.style.visibility="hidden";this._show=
!1};f.show=function(){this.style.visibility="visible";this._show=!0};f.toggleCategory=function(){"normal"==a.mode[b.usermap]?"undefined"!=typeof a.usermap[b.usermap].map.categorylegend&&a.usermap[b.usermap].map.categorylegend.enable?0!=this._options.categoryid&&("undefined"!=typeof a.categorylegend[b.usermap]?-1!=a.categorylegend[b.usermap].visiblelist.indexOf(this._options.categoryid)?this.show():this.hide():this.show()):this.show():this.show()};f.createVertices=function(){null!=a.selectedVerticesObj[b.usermap]&&
a.selectedVerticesObj[b.usermap]!=this&&a.selectedVerticesObj[b.usermap].deleteVertices();a.selectedVerticesObj[b.usermap]=this;for(var d in this._mainvertices)this._mainvertices.hasOwnProperty(d)&&this._mainvertices[d].remove();this._mainvertices.length=0;var c=this._points.split(" "),e,g={};for(d=0;d<c.length;d++)e=c[d].split(","),g.lat=e[0],g.lng=e[1],g.type=0,g.removable=!1,this._mainvertices[d+1]=new K(b,d+1,this,g),g={}};f.deleteVertices=function(){for(var a in this._mainvertices)this._mainvertices.hasOwnProperty(a)&&
this._mainvertices[a].remove();this._mainvertices.length=0};f.hideSubVertices=function(){};f.showSubVertices=function(){};f.drawMapCurve=function(){var d=this.getElementsByTagName("path")[0];"undefined"!=typeof d&&this.removeChild(d);d=r("path");this.appendChild(d);d.setAttribute("fill","none");d.setAttribute("stroke",this._options.style.stroke);d.setAttribute("stroke-width",l(this._options.style.strokeWidth/a.zoom[b.usermap].currentzoom*(a.map[e].precision/a.factor[b.usermap]),a.precision));if("undefined"!=
typeof this._options.style.strokeDasharray&&"none"!==this._options.style.strokeDasharray){for(var c=this._options.style.strokeDasharray.split(","),f="",g=0;g<c.length;g++)""!=f&&(f+=","),f+=l(c[g]/a.zoom[b.usermap].currentzoom*(a.map[e].precision/a.factor[b.usermap]),a.precision);d.setAttribute("stroke-dasharray",f)}var c=this._options.points.split(" "),f="",h;1==this.count()?(h=c[0].split(","),g=q(h[0])*(a.map[e].precision/a.factor[b.usermap]),h=h[1]*(a.map[e].precision/a.factor[b.usermap]),f=f+
"M"+l(h,a.precision)+","+l(g,a.precision),""!=this._movingpoints&&(h=this._movingpoints.split(","),g=q(h[0])*(a.map[e].precision/a.factor[b.usermap]),h=h[1]*(a.map[e].precision/a.factor[b.usermap]),""!=f&&(f+=" L "),f=f+l(h,a.precision)+","+l(g,a.precision))):2==this.count()?(h=c[0].split(","),g=q(h[0])*(a.map[e].precision/a.factor[b.usermap]),h=h[1]*(a.map[e].precision/a.factor[b.usermap]),f=f+"M"+l(h,a.precision)+","+l(g,a.precision),""!=this._movingpoints&&(h=this._movingpoints.split(","),g=q(h[0])*
(a.map[e].precision/a.factor[b.usermap]),h=h[1]*(a.map[e].precision/a.factor[b.usermap]),""!=f&&(f+=" "),f=f+"Q "+l(h,a.precision)+","+l(g,a.precision)),h=c[1].split(","),g=q(h[0])*(a.map[e].precision/a.factor[b.usermap]),h=h[1]*(a.map[e].precision/a.factor[b.usermap]),f=f+" "+l(h,a.precision)+","+l(g,a.precision)):3==this.count()&&(h=c[0].split(","),g=q(h[0])*(a.map[e].precision/a.factor[b.usermap]),h=h[1]*(a.map[e].precision/a.factor[b.usermap]),f=f+"M"+l(h,a.precision)+","+l(g,a.precision),""!=
f&&(f+=" "),h=c[2].split(","),g=q(h[0])*(a.map[e].precision/a.factor[b.usermap]),h=h[1]*(a.map[e].precision/a.factor[b.usermap]),f=f+"Q "+l(h,a.precision)+","+l(g,a.precision),""!=f&&(f+=" "),h=c[1].split(","),g=q(h[0])*(a.map[e].precision/a.factor[b.usermap]),h=h[1]*(a.map[e].precision/a.factor[b.usermap]),f=f+l(h,a.precision)+","+l(g,a.precision));d.setAttribute("d",f);d.setAttribute("stroke-opacity",this._options.style.strokeOpacity);d.setAttribute("stroke-linejoin","round")};f.onmouseover=function(d){if("mapcurve"==
a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="pointer";"edit"==a.mode[b.usermap]&&s(b,d,"Click to select");if(!a.touchdevices&&"normal"==a.mode[b.usermap]&&("undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id].link&&(this.style.cursor="pointer"),"onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id].infobox&&
!document.getElementById("imap5_"+b.usermap+"_infobox_mapcurve_"+this._id))){var c={};c.clientX=d.clientX;c.clientY=d.clientY;c.obj="mapcurve";c.infobox=a.usermap[b.usermap].map.mapcurve[this._id].infobox;this.infobox=new z(b,this._id,c)}};f.onmouseout=function(d){if("mapcurve"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="auto";"edit"==a.mode[b.usermap]&&C(b);"normal"==a.mode[b.usermap]&&(this.style.cursor="auto","onmouseover"==a.usermap[b.usermap].infobox.show&&"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id]&&
"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id].infobox&&(null==d.relatedTarget||d.relatedTarget.id!="imap5_"+b.usermap+"_infobox_mapcurve_"+this._id)&&document.getElementById("imap5_"+b.usermap+"_infobox_mapcurve_"+this._id)&&this.infobox.remove())};f.onmousemove=function(d){d.preventDefault&&d.preventDefault();"normal"==a.mode[b.usermap]&&(a.div[b.usermap]._mousedown?document.getElementById("imap5_"+b.usermap+"_infobox_mapcurve_"+this._id)&&this.infobox.hide():document.getElementById("imap5_"+
b.usermap+"_infobox_mapcurve_"+this._id)&&(this.infobox.reposition(d.clientX,d.clientY),this.infobox.show()))};f.onclick=function(d){this._mapdragged||this._transformed||a.div[b.usermap]._mapdragged||("edit"==a.mode[b.usermap]?(this.createVertices(),d={event:"click",object:"mapcurve"},d.id=Number(this._id),window.console&&console.log(JSON.stringify(d))):"normal"==a.mode[b.usermap]&&"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id].link&&
("undefined"==typeof a.usermap[b.usermap].map.mapcurve[this._id].link_target?location.href=a.usermap[b.usermap].map.mapcurve[this._id].link:window.open(a.usermap[b.usermap].map.mapcurve[this._id].link,a.usermap[b.usermap].map.mapcurve[this._id].link_target)))};a.touchdevices&&(f.ontouchstart=function(a){1==a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=a.touches[0].clientY)},f.ontouchmove=function(a){1==a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-
this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1},f.ontouchend=function(d){if(this._touch&&!this._move&&!a.div[b.usermap]._mapdragged){if("edit"==a.mode[b.usermap]){d={event:"click",object:"mapcurve"};d.id=this._id;window.console&&console.log(JSON.stringify(d));return}"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id]&&"undefined"!=typeof a.usermap[b.usermap].map.mapcurve[this._id].link&&("undefined"==typeof a.usermap[b.usermap].map.mapcurve[this._id].link_target?
location.href=a.usermap[b.usermap].map.mapcurve[this._id].link:window.open(a.usermap[b.usermap].map.mapcurve[this._id].link,a.usermap[b.usermap].map.mapcurve[this._id].link_target));if("edit"==a.mode[b.usermap])return;0<a.infobox[b.usermap].length&&(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),
a.infobox[b.usermap].pop());"undefined"==typeof a.usermap[b.usermap].map.mapcurve[this._id]||"undefined"==typeof a.usermap[b.usermap].map.mapcurve[this._id].infobox||document.getElementById("imap5_"+b.usermap+"_infobox_mapcurve_"+this._id)||(d={},d.clientX=this._posX,d.clientY=this._posY,d.obj="mapcurve",d.infobox=a.usermap[b.usermap].map.mapcurve[this._id].infobox,this.infobox=new z(b,this._id,d))}this._move=this._touch=!1});f.remove=function(){for(var d in this._mainvertices)this._mainvertices.hasOwnProperty(d)&&
this._mainvertices[d].remove();a.g[b.usermap].removeChild(this);a.mapcurve[b.usermap][this._id]=null};f.drawMapCurve();return f},ha=function(b,c,h){var e=r("g"),f=a.usermap[b.usermap].map.id;a.g[b.usermap].appendChild(e);e._options=h;e._id=c;e.setAttribute("id","imap5_"+b.usermap+"_mapbubble_"+c);e.hide=function(){this.style.visibility="hidden"};e.show=function(){this.style.visibility="visible"};e.drawMapBubble=function(){if(this.hasChildNodes())for(;1<=this.childNodes.length;)this.removeChild(this.firstChild);
var d=r("g"),c=r("circle");d.appendChild(c);this.appendChild(d);c.setAttribute("cx",0);c.setAttribute("cy",0);c.setAttribute("r",Math.abs(this._options.bubblevalue/a.usermap[b.usermap].map.bubblemap.maxbubble)*a.usermap[b.usermap].map.bubblemap.radius);c.setAttribute("stroke","#EEEEEE");c.setAttribute("stroke-width",0);0<this._options.bubblevalue?c.setAttribute("fill",a.usermap[b.usermap].map.bubblemap.poscolor):c.setAttribute("fill",a.usermap[b.usermap].map.bubblemap.negcolor);c.setAttribute("fill-opacity",
a.usermap[b.usermap].map.bubblemap.opacity);d.setAttribute("transform","scale(1,-1)");d=Math.log(Math.tan(Math.PI/4+Math.PI*h.lat/360))*(180/Math.PI);c=h.lng;this._lat=d*(a.map[f].precision/a.factor[b.usermap]);this._lng=c*(a.map[f].precision/a.factor[b.usermap]);this.setAttribute("transform","translate("+l(c*(a.map[f].precision/a.factor[b.usermap]),a.precision)+","+l(d*(a.map[f].precision/a.factor[b.usermap]),a.precision)+") scale("+l(a.map[f].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,
a.precision)+")")};e.onmouseover=function(d){if("normal"==a.mode[b.usermap]){var c=this.getElementsByTagName("g")[0].getElementsByTagName("circle")[0];c.setAttribute("stroke","#EEEEEE");c.setAttribute("stroke-width",2);if(a.usermap[b.usermap].map.bubblemap.showdetails&&!document.getElementById("imap5_"+b.usermap+"_infobox_mapbubble_"+this._id)){var c=a.usermap[b.usermap].map.bubblemap.contentformat.replace(/__TITLE__/g,a.usermap[b.usermap].map.geometry[this._id].title).replace(/__DATA__/g,this._options.bubblevalue),
e={};e.clientX=d.clientX;e.clientY=d.clientY;e.obj="mapbubble";e.infobox=c;this.infobox=new z(b,this._id,e)}}};e.onmouseout=function(d){if("normal"==a.mode[b.usermap]){var c=this.getElementsByTagName("g")[0].getElementsByTagName("circle")[0];c.setAttribute("stroke","#EEEEEE");c.setAttribute("stroke-width",0);(null==d.relatedTarget||d.relatedTarget.id!="imap5_"+b.usermap+"_infobox_mapbubble_"+this._id)&&document.getElementById("imap5_"+b.usermap+"_infobox_mapbubble_"+this._id)&&this.infobox.remove()}};
e.onmousemove=function(d){d.preventDefault&&d.preventDefault();"normal"==a.mode[b.usermap]&&(a.div[b.usermap]._mousedown?document.getElementById("imap5_"+b.usermap+"_infobox_mapbubble_"+this._id)&&this.infobox.hide():document.getElementById("imap5_"+b.usermap+"_infobox_mapbubble_"+this._id)&&(this.infobox.reposition(d.clientX,d.clientY),this.infobox.show()))};a.touchdevices&&(e.ontouchstart=function(a){1==a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=a.touches[0].clientY)},
e.ontouchmove=function(a){1==a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1},e.ontouchend=function(d){if(this._touch&&!this._move&&!a.div[b.usermap]._mapdragged){if("edit"==a.mode[b.usermap])return;this.ishighlight?(this.ishighlight=!1,d=this.getElementsByTagName("g")[0],d=d.getElementsByTagName("circle")[0],d.setAttribute("stroke","#EEEEEE"),d.setAttribute("stroke-width",0)):(this.ishighlight=
!0,d=this.getElementsByTagName("g")[0],d=d.getElementsByTagName("circle")[0],d.setAttribute("stroke","#EEEEEE"),d.setAttribute("stroke-width",2));0<a.infobox[b.usermap].length&&(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),a.infobox[b.usermap].pop());if(!document.getElementById("imap5_"+
b.usermap+"_infobox_mapbubble_"+this._id)){d=a.usermap[b.usermap].map.bubblemap.contentformat.replace(/__TITLE__/g,a.usermap[b.usermap].map.geometry[this._id].title).replace(/__DATA__/g,this._options.bubblevalue);var c={};c.clientX=this._posX;c.clientY=this._posY;c.obj="mapbubble";c.infobox=d;this.infobox=new z(b,this._id,c)}}this._move=this._touch=!1});e.rescale=function(){this.setAttribute("transform","translate("+l(this._lng,a.precision)+","+l(this._lat,a.precision)+") scale("+l(a.map[f].precision/
a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")")};e.remove=function(){a.g[b.usermap].removeChild(this);a.mapbubble[b.usermap][this._id]=null};e.drawMapBubble();return e},ia=function(b,c,h){var e=r("g"),f=a.usermap[b.usermap].map.id;a.g[b.usermap].appendChild(e);e._options=h;e._id=c;e.setAttribute("id","imap5_"+b.usermap+"_piechart_"+c);e.hide=function(){this.style.visibility="hidden"};e.show=function(){this.style.visibility="visible"};e.drawPieChart=function(){if(this.hasChildNodes())for(;1<=
this.childNodes.length;)this.removeChild(this.firstChild);for(var d=a.usermap[b.usermap].map.piechart.radius,c=d/2,e=a.usermap[b.usermap].map.piechart.colorset.split(","),g=this._options.pievalue.split(","),t=0,p=a.usermap[b.usermap].map.piechart.series,q=0;q<p;q++)g.hasOwnProperty(q)&&(t+=parseFloat(g[q]));var s=[];if(0>=t)this.style.visibility="hidden",s=[0,0,0,0,0,0,0,0];else for(this.style.visibility="true",q=0;q<p;q++)g.hasOwnProperty(q)&&s.push(2*Math.PI*parseFloat(g[q])/t);for(var g=r("g"),
n=0,q=0;q<p;q++){var t=n+s[q],v=l(0+2*d*Math.sin(n),6),w=l(0-d*Math.cos(n),6),x=l(0+2*d*Math.sin(t),6),y=l(0-d*Math.cos(t),6),u=0,z=0;t-n>=Math.PI&&(u=1);if(n!=t){if(t-n==2*Math.PI)z=1;else var A="M 0,0 L "+v+","+w+" A "+2*d+","+d+" 0 "+u+" 1 "+x+","+y+" Z";z?(u=r("ellipse"),u.setAttribute("cx",0),u.setAttribute("cy",0),u.setAttribute("rx",2*d),u.setAttribute("ry",d)):(u=r("path"),u.setAttribute("d",A));u.setAttribute("fill",e[q]);u.setAttribute("fill-opacity",a.usermap[b.usermap].map.piechart.opacity);
u.setAttribute("stroke",a.usermap[b.usermap].map.piechart.stroke);u.setAttribute("stroke-width",a.usermap[b.usermap].map.piechart.strokeWidth);u.setAttribute("stroke-opacity",a.usermap[b.usermap].map.piechart.strokeOpacity);g.appendChild(u)}v=n;w=t;if(n>=Math.PI/2&&n<=3*Math.PI/2||t>=Math.PI/2&&t<=3*Math.PI/2||n<=Math.PI/2&&t>=3*Math.PI/2)t>=3*Math.PI/2&&(w=3*Math.PI/2),n<=Math.PI/2&&(v=Math.PI/2),u=0,w-v>Math.PI&&(u=1),n=l(0+2*d*Math.sin(v),6),x=l(0-d*Math.cos(v),6),y=l(0+2*d*Math.sin(w),6),z=l(0-
d*Math.cos(w),6),v!=w&&(A="M "+n+","+x+" L "+n+","+(x+c)+" A "+2*d+","+d+" 0 "+u+" 1 "+y+","+(z+c)+" L "+y+","+z+" A "+2*d+","+d+" 0 "+u+" 0 "+n+","+x+" Z ",u=r("path"),u.setAttribute("d",A),u.setAttribute("fill",e[q]),u.setAttribute("fill-opacity",a.usermap[b.usermap].map.piechart.opacity),u.setAttribute("stroke",a.usermap[b.usermap].map.piechart.stroke),u.setAttribute("stroke-width",a.usermap[b.usermap].map.piechart.strokeWidth),u.setAttribute("stroke-opacity",a.usermap[b.usermap].map.piechart.strokeOpacity),
g.appendChild(u));n=t}g.setAttribute("transform","scale(1,-1)");this.appendChild(g);d=Math.log(Math.tan(Math.PI/4+Math.PI*h.lat/360))*(180/Math.PI);c=h.lng;this._lat=d*(a.map[f].precision/a.factor[b.usermap]);this._lng=c*(a.map[f].precision/a.factor[b.usermap]);this.setAttribute("transform","translate("+l(c*(a.map[f].precision/a.factor[b.usermap]),a.precision)+","+l(d*(a.map[f].precision/a.factor[b.usermap]),a.precision)+") scale("+l(a.map[f].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,
a.precision)+")")};e.onmouseover=function(d){if("normal"==a.mode[b.usermap]){for(var c=this.getElementsByTagName("g")[0],e=c.getElementsByTagName("path"),f=0;f<e.length;f++)e.hasOwnProperty(f)&&e[f].setAttribute("stroke",a.usermap[b.usermap].map.piechart.strokeHover);c=c.getElementsByTagName("ellipse");for(f=0;f<c.length;f++)c.hasOwnProperty(f)&&c[f].setAttribute("stroke",a.usermap[b.usermap].map.piechart.strokeHover);if(a.usermap[b.usermap].map.piechart.showdetails&&!document.getElementById("imap5_"+
b.usermap+"_infobox_piechart_"+this._id)){for(var c=a.usermap[b.usermap].map.piechart.contentformat.replace(/__TITLE__/g,a.usermap[b.usermap].map.geometry[this._id].title),e=this._options.pievalue.split(","),h=0,p=a.usermap[b.usermap].map.piechart.series,f=0;f<p;f++)e.hasOwnProperty(f)&&(h+=parseFloat(e[f]));c=c.replace(/__DATA1__/g,e[0]);c=c.replace(/__DATA2__/g,e[1]);c=c.replace(/__DATA3__/g,e[2]);c=c.replace(/__DATA4__/g,e[3]);c=c.replace(/__DATA5__/g,e[4]);c=c.replace(/__DATA6__/g,e[5]);c=c.replace(/__DATA7__/g,
e[6]);c=c.replace(/__DATA8__/g,e[7]);c=c.replace(/__PERCENT1__/g,l(100*(parseFloat(e[0])/h),2));c=c.replace(/__PERCENT2__/g,l(100*(parseFloat(e[1])/h),2));c=c.replace(/__PERCENT3__/g,l(100*(parseFloat(e[2])/h),2));c=c.replace(/__PERCENT4__/g,l(100*(parseFloat(e[3])/h),2));c=c.replace(/__PERCENT5__/g,l(100*(parseFloat(e[4])/h),2));c=c.replace(/__PERCENT6__/g,l(100*(parseFloat(e[5])/h),2));c=c.replace(/__PERCENT7__/g,l(100*(parseFloat(e[6])/h),2));c=c.replace(/__PERCENT8__/g,l(100*(parseFloat(e[7])/
h),2));f={};f.clientX=d.clientX;f.clientY=d.clientY;f.obj="piechart";f.infobox=c;this.infobox=new z(b,this._id,f)}}};e.onmouseout=function(d){if("normal"==a.mode[b.usermap]){for(var c=this.getElementsByTagName("g")[0],e=c.getElementsByTagName("path"),f=0;f<e.length;f++)e.hasOwnProperty(f)&&e[f].setAttribute("stroke",a.usermap[b.usermap].map.piechart.stroke);c=c.getElementsByTagName("ellipse");for(f=0;f<c.length;f++)c.hasOwnProperty(f)&&c[f].setAttribute("stroke",a.usermap[b.usermap].map.piechart.stroke);
(null==d.relatedTarget||d.relatedTarget.id!="imap5_"+b.usermap+"_infobox_piechart_"+this._id)&&document.getElementById("imap5_"+b.usermap+"_infobox_piechart_"+this._id)&&this.infobox.remove()}};e.onmousemove=function(d){d.preventDefault&&d.preventDefault();"normal"==a.mode[b.usermap]&&(a.div[b.usermap]._mousedown?document.getElementById("imap5_"+b.usermap+"_infobox_piechart_"+this._id)&&this.infobox.hide():document.getElementById("imap5_"+b.usermap+"_infobox_piechart_"+this._id)&&(this.infobox.reposition(d.clientX,
d.clientY),this.infobox.show()))};a.touchdevices&&(e.ontouchstart=function(a){1==a.touches.length&&(this._touch=!0,this._move=!1,this._posX=a.touches[0].clientX,this._posY=a.touches[0].clientY)},e.ontouchmove=function(a){1==a.touches.length?this._touch&&(10<Math.abs(a.touches[0].clientX-this._posX)||10<Math.abs(a.touches[0].clientY-this._posY))&&(this._move=!0):this._touch=!1},e.ontouchend=function(d){if(this._touch&&!this._move&&!a.div[b.usermap]._mapdragged){if("edit"==a.mode[b.usermap])return;
if(this.ishighlight)for(this.ishighlight=!1,d=this.getElementsByTagName("g")[0],c=d.getElementsByTagName("path"),d=0;d<c.length;d++)c.hasOwnProperty(d)&&c[d].setAttribute("stroke",a.usermap[b.usermap].map.piechart.stroke);else{this.ishighlight=!0;d=this.getElementsByTagName("g")[0];var c=d.getElementsByTagName("path");for(d=0;d<c.length;d++)c.hasOwnProperty(d)&&c[d].setAttribute("stroke",a.usermap[b.usermap].map.piechart.strokeHover)}0<a.infobox[b.usermap].length&&(document.getElementById("imap5_"+
b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)&&a.div[b.usermap].removeChild(document.getElementById("imap5_"+b.usermap+"_infobox_"+a.infobox[b.usermap][0].object+"_"+a.infobox[b.usermap][0].id)),a.infobox[b.usermap].pop());if(!document.getElementById("imap5_"+b.usermap+"_infobox_piechart_"+this._id)){var c=a.usermap[b.usermap].map.piechart.contentformat.replace(/__TITLE__/g,a.usermap[b.usermap].map.geometry[this._id].title),e=this._options.pievalue.split(","),
f=0,h=a.usermap[b.usermap].map.piechart.series;for(d=0;d<h;d++)e.hasOwnProperty(d)&&(f+=parseFloat(e[d]));c=c.replace(/__DATA1__/g,e[0]);c=c.replace(/__DATA2__/g,e[1]);c=c.replace(/__DATA3__/g,e[2]);c=c.replace(/__DATA4__/g,e[3]);c=c.replace(/__DATA5__/g,e[4]);c=c.replace(/__DATA6__/g,e[5]);c=c.replace(/__DATA7__/g,e[6]);c=c.replace(/__DATA8__/g,e[7]);c=c.replace(/__PERCENT1__/g,l(100*(parseFloat(e[0])/f),2));c=c.replace(/__PERCENT2__/g,l(100*(parseFloat(e[1])/f),2));c=c.replace(/__PERCENT3__/g,l(100*
(parseFloat(e[2])/f),2));c=c.replace(/__PERCENT4__/g,l(100*(parseFloat(e[3])/f),2));c=c.replace(/__PERCENT5__/g,l(100*(parseFloat(e[4])/f),2));c=c.replace(/__PERCENT6__/g,l(100*(parseFloat(e[5])/f),2));c=c.replace(/__PERCENT7__/g,l(100*(parseFloat(e[6])/f),2));c=c.replace(/__PERCENT8__/g,l(100*(parseFloat(e[7])/f),2));d={};d.clientX=this._posX;d.clientY=this._posY;d.obj="piechart";d.infobox=c;this.infobox=new z(b,this._id,d)}}this._move=this._touch=!1});e.rescale=function(){this.setAttribute("transform",
"translate("+l(this._lng,a.precision)+","+l(this._lat,a.precision)+") scale("+l(a.map[f].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")")};e.remove=function(){a.g[b.usermap].removeChild(this);a.piechart[b.usermap][this._id]=null};e.drawPieChart();return e},Aa=function(b,c,h){var e=a.usermap[b.usermap].map.id,f=r("g");a.g[b.usermap].appendChild(f);f._options=h;f._id=c;f.setAttribute("id","imap5_"+b.usermap+"_mapabbr_"+c);f._lat=h.lat;f._lng=h.lng;f._dx=f._lng*(a.map[e].precision/
a.factor[b.usermap]);f._dy=q(f._lat)*(a.map[e].precision/a.factor[b.usermap]);f._show=!0;f.setPosition=function(d){this._lat=a.usermap[b.usermap].map.mapabbr[this._id].lat=d.lat;this._lng=a.usermap[b.usermap].map.mapabbr[this._id].lng=d.lng;this._dy=q(this._lat)*(a.map[e].precision/a.factor[b.usermap]);this._dx=this._lng*(a.map[e].precision/a.factor[b.usermap]);f.setAttribute("transform","translate("+l(this._dx,a.precision)+","+l(this._dy,a.precision)+") scale("+l(a.map[e].precision/a.factor[b.usermap]/
a.zoom[b.usermap].currentzoom,a.precision)+")")};f.getPosition=function(){var a={};a.lat=this._lat;a.lng=this._lng;return a};f.setOptions=function(a){this._options=a};f.setLabel=function(a){this._options.label.text=a;this.drawMapAbbr()};f.hide=function(){this.style.visibility="hidden";this._show=!1};f.show=function(){this.style.visibility="visible";this._show=!0};f.drawMapAbbr=function(){var d=this.getElementsByTagName("text")[0];"undefined"!=typeof d&&this.removeChild(d);if(""!=this._options.label.text){d=
r("text");this.appendChild(d);var c=document.createTextNode(this._options.label.text);d.appendChild(c);d.setAttribute("style","stroke-width:0");d.style.strokeOpacity=0;d.style.fontFamily=this._options.label.style.fontFamily;d.style.fill=this._options.label.style.fontColor;d.style.fontSize=this._options.label.style.fontSize;d.style.fontStyle=this._options.label.style.fontStyle;d.style.fontWeight=this._options.label.style.fontWeight;d.style.pointerEvents="none";c=0+parseInt(d.style.fontSize)/2-(d.getBBox().height+
d.getBBox().y)/2;d.setAttribute("x",0);d.setAttribute("y",c);d.setAttribute("transform","scale(1,-1)");d.setAttribute("text-anchor","middle")}d=Math.log(Math.tan(Math.PI/4+Math.PI*this._options.lat/360))*(180/Math.PI);c=this._options.lng;this._lat=d*(a.map[e].precision/a.factor[b.usermap]);this._lng=c*(a.map[e].precision/a.factor[b.usermap]);this.setAttribute("transform","translate("+l(c*(a.map[e].precision/a.factor[b.usermap]),a.precision)+","+l(d*(a.map[e].precision/a.factor[b.usermap]),a.precision)+
") scale("+l(a.map[e].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")")};f.remove=function(){a.g[b.usermap].removeChild(this);a.mapabbr[b.usermap][this._id]=null};f.drawMapAbbr();return f},K=function(b,c,h,e){var f=this,d=a.usermap[b.usermap].map.id,k=r("g");a.g[b.usermap].appendChild(k);k._options=e;k._id=c;0==e.type?k.setAttribute("id","imap5_"+b.usermap+"_verticesobj_"+c):k.setAttribute("id","imap5_"+b.usermap+"_subverticesobj_"+c);k._lat=e.lat;k._lng=e.lng;k._type=
e.type;k._removable=e.removeable;this._parentnode=h;k._dx=k._lng*(a.map[d].precision/a.factor[b.usermap]);k._dy=q(k._lat)*(a.map[d].precision/a.factor[b.usermap]);k.setOptions=function(a){this._options=a;this._lat=a.lat;this._lng=a.lng;this._type=a.type;this._removable=a.removable};k.hide=function(){this.style.visibility="hidden"};k.show=function(){this.style.visibility="visible"};k.onmouseover=function(d){"edit"==a.mode[b.usermap]&&(this.style.cursor="pointer");"edit"==a.mode[b.usermap]&&(0==e.type?
e.removable?s(b,d,"<strong>[Drag]</strong> to change position. <strong>[Right Click]</strong> to delete."):s(b,d,"<strong>[Drag]</strong> to change position."):s(b,d,"<strong>[Click]</strong> to split the line segment"))};k.onmouseout=function(d){"edit"==a.mode[b.usermap]&&(this.style.cursor="auto");"edit"==a.mode[b.usermap]&&C(b);"normal"==a.mode[b.usermap]&&(this.style.cursor="auto")};k.onmousedown=function(d){d.preventDefault&&d.preventDefault();"edit"==a.mode[b.usermap]&&(d.stopPropagation&&d.stopPropagation(),
this._mousedown=!0,this._mapdragged=!1,this._x=d.clientX,this._y=d.clientY,0==e.type?(a.selectedOverlay[b.usermap]=this,f._parentnode.hideSubVertices()):f._parentnode.addVertices(c,this._options.lat,this._options.lng))};0==e.type&&(k.onmousemove=function(h){h.preventDefault&&h.preventDefault();if("edit"==a.mode[b.usermap]&&(h.stopPropagation&&h.stopPropagation(),this._mousedown&&0==e.type&&(2<Math.abs(h.clientX-this._x)||2<Math.abs(h.clientY-this._y)))){this._mapdragged=!0;this._x=h.clientX;this._y=
h.clientY;var g=a.svgcoord[b.usermap];g.x=h.clientX;g.y=h.clientY;g=v(g,a.g[b.usermap]);g.x/=a.map[d].precision/a.factor[b.usermap];g.y/=a.map[d].precision/a.factor[b.usermap];h=g.x;var k=360*(Math.atan(Math.pow(Math.E,g.y.toFixed(a.precision)*Math.PI/180))-Math.PI/4)/Math.PI;M(k,h)||(this._lat=g.y*(a.map[d].precision/a.factor[b.usermap]),this._lng=g.x*(a.map[d].precision/a.factor[b.usermap]),this.setAttribute("transform","translate("+l(this._lng,a.precision)+","+l(this._lat,a.precision)+") scale("+
l(a.map[d].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")"),f._parentnode.updateVertices(c,k,h))}},k.onmouseup=function(d){d.preventDefault&&d.preventDefault();"edit"==a.mode[b.usermap]&&0==e.type&&(d.stopPropagation&&d.stopPropagation(),a.selectedOverlay[b.usermap]==this&&(a.selectedOverlay[b.usermap]=null),f._parentnode.postPosChange(),this._mousedown=!1)},k.oncontextmenu=function(d){d.preventDefault&&d.preventDefault();"edit"==a.mode[b.usermap]&&(d.stopPropagation&&
d.stopPropagation(),0==e.type&&e.removable&&f._parentnode.removeVertices(c))});k.drawVerticesObj=function(){var c=this.getElementsByTagName("g")[0];"undefined"!=typeof c&&this.removeChild(c);var c=r("g"),e=r("circle");c.appendChild(e);this.appendChild(c);e.setAttribute("cx",0);e.setAttribute("cy",0);e.setAttribute("r",5);e.setAttribute("stroke","#000000");e.setAttribute("stroke-width",1);1==this._type?(e.setAttribute("fill","#CCCCCC"),e.setAttribute("fill-opacity",0.5)):(e.setAttribute("fill","#FFFFFF"),
e.setAttribute("fill-opacity",1));c.setAttribute("transform","scale(1,-1)");c=Math.log(Math.tan(Math.PI/4+Math.PI*this._options.lat/360))*(180/Math.PI);e=this._options.lng;this._lat=c*(a.map[d].precision/a.factor[b.usermap]);this._lng=e*(a.map[d].precision/a.factor[b.usermap]);this.setAttribute("transform","translate("+l(e*(a.map[d].precision/a.factor[b.usermap]),a.precision)+","+l(c*(a.map[d].precision/a.factor[b.usermap]),a.precision)+") scale("+l(a.map[d].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,
a.precision)+")")};k.rescale=function(){this.setAttribute("transform","translate("+l(this._lng,a.precision)+","+l(this._lat,a.precision)+") scale("+l(a.map[d].precision/a.factor[b.usermap]/a.zoom[b.usermap].currentzoom,a.precision)+")")};k.remove=function(){a.g[b.usermap].removeChild(this)};k.drawVerticesObj();return k},z=function(b,c,h){var e=document.createElement("div");e.id="imap5_"+b.usermap+"_infobox_"+h.obj+"_"+c;e.options=h;e.style.position="fixed";e.style.top=h.clientY+3+"px";e.style.left=
h.clientX+3+"px";for(var f in a.usermap[b.usermap].infobox.style)"backgroundColor"!=f&&"opacity"!=f&&(e.style[f]=a.usermap[b.usermap].infobox.style[f]);e.style.backgroundColor="rgba("+ +F(a.usermap[b.usermap].infobox.style.backgroundColor)+","+G(a.usermap[b.usermap].infobox.style.backgroundColor)+","+H(a.usermap[b.usermap].infobox.style.backgroundColor)+","+a.usermap[b.usermap].infobox.style.opacity+")";e.innerHTML=h.infobox;a.div[b.usermap].appendChild(e);e.onmouseout=function(a){for(var b=a.relatedTarget;null!=
b;){if(b==this)return;b=b.parentNode}null!=a.relatedTarget&&this.id.split("_")[4]!=a.relatedTarget.parentNode.id&&this.remove()};e.onmouseup=function(a){a.stopPropagation&&a.stopPropagation()};e.onmousedown=function(a){a.stopPropagation&&a.stopPropagation()};e.onmousewheel=function(a){a.stopPropagation&&a.stopPropagation()};a.div[b.usermap].addEventListener&&e.addEventListener("DOMMouseScroll",function(a){a.stopPropagation&&a.stopPropagation()},!1);e.show=function(){this.style.display="block"};e.hide=
function(){this.style.display="none"};e.reposition=function(d,c){var e;e="undefined"!=typeof a.usermap[b.usermap].infobox.style.sensitivity?a.usermap[b.usermap].infobox.style.sensitivity:15;Math.sqrt((this.options.clientX-d)*(this.options.clientX-d)+(this.options.clientY-c)*(this.options.clientY-c))>e&&(this.options.clientX=d,this.options.clientY=c,d>document.body.offsetWidth/2?"undefined"!=typeof a.usermap[b.usermap].infobox.style.width?this.style.left=d-this.offsetWidth+"px":(e=Math.min(d,parseFloat(window.getComputedStyle(document.getElementById(this.id),
null).getPropertyValue("width"))),this.style.width=e+"px",this.style.left=d-e-3-2*parseInt(a.usermap[b.usermap].infobox.style.padding)+"px"):("undefined"==typeof a.usermap[b.usermap].infobox.style.width&&(this.style.width="auto"),this.style.left=d+3+"px"),this.style.top=c+3+"px")};e.remove=function(){a.div[b.usermap].removeChild(document.getElementById(this.id));a.infobox[b.usermap].pop()};a.touchdevices&&(e.ontouchstart=e.ontouchmove=e.ontouchend=function(a){a.stopPropagation&&a.stopPropagation()});
f={};f.object=h.obj;f.id=c;a.infobox[b.usermap].push(f);e.reposition(h.clientX,h.clientY);return e},la=function(b,c,h){var e=document.createElement("div");e.id="imap5_"+b.usermap+"_maplegend_"+c;e.options=h;e.style.position="fixed";e._show=!0;a.div[b.usermap].appendChild(e);e.setOptions=function(a){this.options=a};e.hide=function(){this.style.display="none";this._show=!1};e.show=function(){this.style.display="block";this._show=!0};e.toggleCategory=function(){"normal"==a.mode[b.usermap]?"undefined"!=
typeof a.usermap[b.usermap].map.categorylegend&&a.usermap[b.usermap].map.categorylegend.enable?0!=this.options.categoryid&&("undefined"!=typeof a.categorylegend[b.usermap]?-1!=a.categorylegend[b.usermap].visiblelist.indexOf(this.options.categoryid)?this.show():this.hide():this.show()):this.show():this.show()};e.drawMapLegend=function(){if(this.hasChildNodes())for(;1<=this.childNodes.length;)this.removeChild(this.firstChild);for(var c in h.style)"backgroundColor"!=c&&"opacity"!=c&&(this.style[c]=this.options.style[c]);
this.style.backgroundColor="rgba("+ +F(this.options.style.backgroundColor)+","+G(this.options.style.backgroundColor)+","+H(this.options.style.backgroundColor)+","+this.options.style.opacity+")";var d=0,e=this.options.columnsPerRow,l=parseInt(this.options.columnWidth)*e,g=parseInt(this.options.columnWidth)*e-6,q=parseInt(this.options.icon.width),p=parseInt(this.options.icon.height),r=parseInt(this.options.columnWidth)-(q+6)-6,s=parseInt(this.options.columnWidth),n=new J;n.style.width=l+"px";this.appendChild(n);
for(c in this.options.items)if(this.options.items.hasOwnProperty(c)){switch(this.options.items[c].type){case 1:n={};n.text=this.options.items[c].text;n.width=g;n.fontFamily=this.options.style.fontFamily;n.fontSize=this.options.style.fontSize;n.fontColor=this.options.style.fontColor;d=new sa(n);this.appendChild(d);d=0;break;case 2:n={};n.text=this.options.items[c].text;n.image=this.options.items[c].image;n.basepath=a.base[b.usermap];n.iconWidth=q;n.iconHeight=p;n.legendTextWidth=r;n.width=s;n.fontFamily=
this.options.style.fontFamily;n.fontSize=this.options.style.fontSize;n.fontColor=this.options.style.fontColor;n.columnsPerRow=this.options.columnsPerRow;n=new Ba(n);this.appendChild(n);d+=1;break;case 3:n={};n.text=this.options.items[c].text;n.fill=this.options.items[c].fill;n.opacity="undefined"!==typeof this.options.items[c].opacity?this.options.items[c].opacity:1;n.iconWidth=q;n.iconHeight=p;n.legendTextWidth=r;n.width=s;n.fontFamily=this.options.style.fontFamily;n.fontSize=this.options.style.fontSize;
n.fontColor=this.options.style.fontColor;n.columnsPerRow=this.options.columnsPerRow;n=new Ca(n);this.appendChild(n);d+=1;break;case 4:n={},n.text=this.options.items[c].text,n.stroke=this.options.items[c].stroke,n.opacity="undefined"!==typeof this.options.items[c].opacity?this.options.items[c].opacity:1,n.iconWidth=q,n.iconHeight=p,n.legendTextWidth=r,n.width=s,n.fontFamily=this.options.style.fontFamily,n.fontSize=this.options.style.fontSize,n.fontColor=this.options.style.fontColor,n.columnsPerRow=
this.options.columnsPerRow,n=new Da(n),this.appendChild(n),d+=1}if(d==e||"1"==this.options.items[c].type)n=new J,n.style.width=l+"px",this.appendChild(n),d=0}this.style.position="absolute";this.style.display="table";this.style.width=l+"px";switch(this.options.anchor){case 1:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.bottom="auto";this.style.right="auto";break;case 2:this.style.top=
parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.width)-parseInt(this.offsetWidth))/2+"px";this.style.bottom="auto";this.style.right="auto";break;case 3:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.right=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.bottom="auto";this.style.left="auto";break;case 4:this.style.top=
parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.height)-parseInt(this.offsetHeight))/2+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.bottom="auto";this.style.right="auto";break;case 5:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.height)-parseInt(this.offsetHeight))/2+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.width)-
parseInt(this.offsetWidth))/2+"px";this.style.bottom="auto";this.style.right="auto";break;case 6:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.height)-parseInt(this.offsetHeight))/2+"px";this.style.right=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.bottom="auto";this.style.left="auto";break;case 7:this.style.bottom=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+
10+"px";this.style.top="auto";this.style.right="auto";break;case 8:this.style.bottom=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.width)-parseInt(this.offsetWidth))/2+"px";this.style.top="auto";this.style.right="auto";break;case 9:this.style.bottom=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.right=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+
"px";this.style.top="auto";this.style.left="auto";break;default:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px",this.style.right=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px",this.style.bottom="auto",this.style.left="auto"}};e.remove=function(){a.div[b.usermap].removeChild(document.getElementById(this.id))};e.onmouseup=function(a){};e.onmousedown=function(a){};e.onmouseover=function(c){if("maplegend"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor=
"pointer";"edit"==a.mode[b.usermap]&&s(b,c,"Click to select")};e.onmouseout=function(c){if("maplegend"==a.mode[b.usermap]||"edit"==a.mode[b.usermap])this.style.cursor="auto";"edit"==a.mode[b.usermap]&&C(b)};e.onmousewheel=function(a){};a.div[b.usermap].addEventListener&&e.addEventListener("DOMMouseScroll",function(a){},!1);e.onclick=function(e){e.stopPropagation&&e.stopPropagation();this._mapdragged||this._transformed||a.div[b.usermap]._mapdragged||"edit"!=a.mode[b.usermap]||(e={event:"click",object:"maplegend"},
e.id=Number(c),window.console&&console.log(JSON.stringify(e)))};a.touchdevices&&(e.ontouchstart=e.ontouchmove=e.ontouchend=function(a){a.stopPropagation&&a.stopPropagation()});e.drawMapLegend();return e},sa=function(a){var c=document.createElement("div");c.style.cssFloat="left";c.style.overflow="hidden";c.style.textOverflow="ellipsis";c.style.whiteSpace="nowrap";c.style.padding="3px";c.style.fontFamily=a.fontFamily;c.style.fontSize=a.fontSize;c.style.color=a.fontColor;c.style.width=a.width+"px";c.style.fontWeight=
"bold";c.innerHTML=a.text;return c},Q=function(a){var c=document.createElement("div");c.style.cssFloat="left";c.style.overflow="hidden";c.style.textOverflow="ellipsis";c.style.whiteSpace="nowrap";c.style.width=a.width+"px";c.style.padding="3px";c.style.fontFamily=a.fontFamily;c.style.fontSize=a.fontSize;c.style.color=a.fontColor;c.style.border="0px";c.innerHTML=a.text;return c},Ba=function(a){var c=document.createElement("div"),h=document.createElement("div");h.style.cssFloat="left";h.style.padding=
"3px";h.style.width=a.iconWidth+"px";h.style.height=a.iconHeight+"px";var e=document.createElement("img");e.setAttribute("src",a.basepath+a.image);e.setAttribute("width",a.iconWidth+"px");e.setAttribute("height",a.iconHeight+"px");h.appendChild(e);e={};e.width=a.legendTextWidth;e.fontFamily=a.fontFamily;e.fontSize=a.fontSize;e.fontColor=a.fontColor;e.text=a.text;var e=new Q(e),f=new J;c.style.width=a.width+"px";c.style.height="auto";c.style.cssFloat="left";c.style.padding="0px";c.appendChild(h);c.appendChild(e);
c.appendChild(f);return c},Ca=function(a){var c=document.createElement("div"),h=document.createElement("div");h.style.cssFloat="left";h.style.margin="3px";h.style.width=a.iconWidth+"px";h.style.height=a.iconHeight+"px";h.style.backgroundColor=a.fill;h.style.opacity=a.opacity;var e={};e.width=a.legendTextWidth;e.fontFamily=a.fontFamily;e.fontSize=a.fontSize;e.fontColor=a.fontColor;e.text=a.text;var e=new Q(e),f=new J;c.style.width=a.width+"px";c.style.height="auto";c.style.cssFloat="left";c.style.padding=
"0px";c.appendChild(h);c.appendChild(e);c.appendChild(f);return c},Da=function(a){var c=document.createElement("div"),h=document.createElement("div");h.style.cssFloat="left";h.style.padding="3px";h.style.width=a.iconWidth+"px";h.style.height=a.iconHeight+"px";h.style.backgroundColor=a.fill;var e=r("svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg");e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");e.setAttribute("version","1.1");e.setAttribute("width",a.iconWidth+"px");e.setAttribute("height",
a.iconHeight+"px");e.style.overflow="hidden";var f=r("polyline");f.setAttribute("points","1,"+a.iconHeight/2+" "+(a.iconWidth-1)+","+a.iconHeight/2);f.style.fill="none";f.style.stroke=a.stroke;f.style.strokeOpacity=a.opacity;f.style.strokeWidth=2;e.appendChild(f);h.appendChild(e);e={};e.width=a.legendTextWidth;e.fontFamily=a.fontFamily;e.fontSize=a.fontSize;e.fontColor=a.fontColor;e.text=a.text;e=new Q(e);f=new J;f.style.width=a.width+"px";c.style.width=a.width+"px";c.style.height="auto";c.style.cssFloat=
"left";c.style.padding="0px";c.appendChild(h);c.appendChild(e);c.appendChild(f);return c},J=function(){var a=document.createElement("div");a.style.clear="both";return a},Ea=function(b){var c={};c.width=b.legendTextWidth;c.fontFamily=b.fontFamily;c.fontSize=b.fontSize;c.fontColor=b.fontColor;c.text=b.text;c=new Q(c);c.style.cursor="pointer";a.touchdevices||(c.onmouseover=function(){imap5.categorylegend[b.usermap].visiblelist.length=0;imap5.categorylegend[b.usermap].visiblelist.push(b.categoryid);var a=
{};a.usermap=b.usermap;imap5.updateCategoryLegend(a);this.style.textDecoration="underline"},c.onmouseout=function(){this.style.textDecoration="none"});a.touchdevices&&(c.onclick=function(){"undefined"!==typeof imap5.categorylegend[b.usermap].touchlist&&null!==imap5.categorylegend[b.usermap].touchlist&&"undefined"!==typeof imap5.categorylegend[b.usermap].touchlist.style&&(imap5.categorylegend[b.usermap].touchlist.style.textDecoration="none");imap5.categorylegend[b.usermap].visiblelist.length=0;imap5.categorylegend[b.usermap].visiblelist.push(b.categoryid);
imap5.categorylegend[b.usermap].touchlist=this;this.style.textDecoration="underline";var a={};a.usermap=b.usermap;imap5.updateCategoryLegend(a)});a.touchdevices&&(c.ontouchstart=function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();this._touch=1==a.touches.length?!0:!1});a.touchdevices&&(c.ontouchend=function(a){this._touch&&(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),"undefined"!==typeof imap5.categorylegend[b.usermap].touchlist&&
null!==imap5.categorylegend[b.usermap].touchlist&&"undefined"!==typeof imap5.categorylegend[b.usermap].touchlist.style&&(imap5.categorylegend[b.usermap].touchlist.style.textDecoration="none"),imap5.categorylegend[b.usermap].visiblelist.length=0,imap5.categorylegend[b.usermap].visiblelist.push(b.categoryid),imap5.categorylegend[b.usermap].touchlist=this,this.style.textDecoration="underline",a={},a.usermap=b.usermap,imap5.updateCategoryLegend(a))});return c},Fa=function(b){var c=document.createElement("div"),
h=document.createElement("div");h.style.cssFloat="left";h.style.width="16px";h.style.height="16px";var e=document.createElement("input");e.setAttribute("type","checkbox");e.checked=b.checked;e.setAttribute("width","16px");e.setAttribute("height","16px");h.appendChild(e);e.onclick=function(a){this.checked?imap5.categorylegend[b.usermap].visiblelist.push(b.categoryid):(a=imap5.categorylegend[b.usermap].visiblelist.indexOf(b.categoryid),imap5.categorylegend[b.usermap].visiblelist.splice(a,1));a={};a.usermap=
b.usermap;imap5.updateCategoryLegend(a)};var f={};f.width=b.legendTextWidth;f.fontFamily=b.fontFamily;f.fontSize=b.fontSize;f.fontColor=b.fontColor;f.text=b.text;f=new Q(f);f.checkbox=e;f.onclick=function(){this.checkbox.checked=!this.checkbox.checked;if(this.checkbox.checked)imap5.categorylegend[b.usermap].visiblelist.push(b.categoryid);else{var a=imap5.categorylegend[b.usermap].visiblelist.indexOf(b.categoryid);imap5.categorylegend[b.usermap].visiblelist.splice(a,1)}a={};a.usermap=b.usermap;imap5.updateCategoryLegend(a)};
a.touchdevices&&(f.ontouchstart=function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();this._touch=1==a.touches.length?!0:!1});a.touchdevices&&(f.ontouchend=function(a){this._touch&&(this.checkbox.checked=!this.checkbox.checked,this.checkbox.checked?imap5.categorylegend[b.usermap].visiblelist.push(b.categoryid):(a=imap5.categorylegend[b.usermap].visiblelist.indexOf(b.categoryid),imap5.categorylegend[b.usermap].visiblelist.splice(a,1)),a={},a.usermap=b.usermap,imap5.updateCategoryLegend(a))});
f.style.cursor="pointer";e=new J;c.style.width=b.width+"px";c.style.height="auto";c.style.cssFloat="left";c.style.padding="0px";c.appendChild(h);c.appendChild(f);c.appendChild(e);return c},ga=function(b,c){var h=r("g");h.id="imap5_"+b.usermap+"_maptitle";h.options=c;h._show=!0;a.svg[b.usermap].appendChild(h);h.setOptions=function(a){this.options=a};h.hide=function(){this.style.display="none";this._show=!1};h.show=function(){this.style.display="block";this._show=!0};h.remove=function(){a.svg[b.usermap].removeChild(this)};
h.drawMapTitle=function(){var c=this.getElementsByTagName("text")[0];"undefined"!=typeof c&&this.removeChild(c);c=r("text");c.appendChild(document.createTextNode(this.options.text));c.style.cursor="default";c.setAttribute("style","stroke-width:0");c.style.strokeOpacity=0;c.style.fontFamily=this.options.style.fontFamily;c.style.fill=this.options.style.fontColor;c.style.fontSize=this.options.style.fontSize;c.style.fontStyle=this.options.style.fontStyle;c.style.fontWeight=this.options.style.fontWeight;
c.style.pointerEvents="none";this.appendChild(c);c.setAttribute("x",-4096);c.setAttribute("y",-4096);c.setAttribute("text-anchor","middle");switch(this.options.anchor){case 1:c.setAttribute("text-anchor","start");c.setAttribute("x",0);c.setAttribute("y",parseInt(c.style.fontSize));break;case 2:c.setAttribute("text-anchor","middle");c.setAttribute("x",a.div[b.usermap].clientWidth/2);c.setAttribute("y",parseInt(c.style.fontSize));break;case 3:c.setAttribute("text-anchor","end");c.setAttribute("x",a.div[b.usermap].clientWidth);
c.setAttribute("y",parseInt(c.style.fontSize));break;case 4:c.setAttribute("text-anchor","start");c.setAttribute("x",0);c.setAttribute("y",a.div[b.usermap].clientHeight/2+parseInt(c.style.fontSize)/2);break;case 5:c.setAttribute("text-anchor","middle");c.setAttribute("x",a.div[b.usermap].clientWidth/2);c.setAttribute("y",a.div[b.usermap].clientHeight/2+parseInt(c.style.fontSize)/2);break;case 6:c.setAttribute("text-anchor","end");c.setAttribute("x",a.div[b.usermap].clientWidth);c.setAttribute("y",
a.div[b.usermap].clientHeight/2+parseInt(c.style.fontSize)/2);break;case 7:c.setAttribute("text-anchor","start");c.setAttribute("x",0);c.setAttribute("y",a.div[b.usermap].clientHeight-5);break;case 8:c.setAttribute("text-anchor","middle");c.setAttribute("x",a.div[b.usermap].clientWidth/2);c.setAttribute("y",a.div[b.usermap].clientHeight-5);break;case 9:c.setAttribute("text-anchor","end");c.setAttribute("x",a.div[b.usermap].clientWidth);c.setAttribute("y",a.div[b.usermap].clientHeight-5);break;default:c.setAttribute("text-anchor",
"middle"),c.setAttribute("x",a.div[b.usermap].clientWidth/2),c.setAttribute("y",parseInt(c.style.fontSize))}};h.drawMapTitle();return h},fa=function(b,c){var h=document.createElement("div");h.id="imap5_"+b.usermap+"_categorylegend";h.options=c;h.style.position="fixed";h._show=!0;a.div[b.usermap].appendChild(h);h.setOptions=function(a){this.options=a};h.hide=function(){this.style.display="none";this._show=!1};h.show=function(){this.style.display="block";this._show=!0};h.remove=function(){a.div[b.usermap].removeChild(document.getElementById(this.id))};
h.drawCategoryLegend=function(){this.visiblelist=[];this.touchlist={};if(this.hasChildNodes())for(;1<=this.childNodes.length;)this.removeChild(this.firstChild);for(var e in c.style)"backgroundColor"!=e&&"opacity"!=e&&(this.style[e]=this.options.style[e]);this.style.backgroundColor="rgba("+ +F(this.options.style.backgroundColor)+","+G(this.options.style.backgroundColor)+","+H(this.options.style.backgroundColor)+","+this.options.style.opacity+")";var f=0,d=this.options.columnsPerRow,h=parseInt(this.options.columnWidth)*
d,l=parseInt(this.options.columnWidth)*d-6,g=parseInt(this.options.columnWidth)-22-6,q=parseInt(this.options.columnWidth),p=new J;p.style.width=h+"px";this.appendChild(p);for(e in this.options.items)if(this.options.items.hasOwnProperty(e)){switch(this.options.items[e].type){case 1:p={};p.text=this.options.items[e].text;p.width=l;p.fontFamily=this.options.style.fontFamily;p.fontSize=this.options.style.fontSize;p.fontColor=this.options.style.fontColor;f=new sa(p);this.appendChild(f);f=0;break;case 2:0==
this.options.mode?(p={},p.text=this.options.items[e].text,p.categoryid=this.options.items[e].categoryid,p.checked=this.options.items[e].checked,this.options.items[e].checked&&-1==this.visiblelist.indexOf(this.options.items[e].categoryid)&&this.visiblelist.push(this.options.items[e].categoryid),p.usermap=b.usermap,p.legendTextWidth=g,p.width=q,p.fontFamily=this.options.style.fontFamily,p.fontSize=this.options.style.fontSize,p.fontColor=this.options.style.fontColor,p.columnsPerRow=this.options.columnsPerRow,
p=new Fa(p)):(p={},p.text=this.options.items[e].text,p.categoryid=this.options.items[e].categoryid,p.usermap=b.usermap,p.legendTextWidth=g+22,p.width=q,p.fontFamily=this.options.style.fontFamily,p.fontSize=this.options.style.fontSize,p.fontColor=this.options.style.fontColor,p.columnsPerRow=this.options.columnsPerRow,p=new Ea(p)),this.appendChild(p),f+=1}if(f==d||"1"==this.options.items[e].type)p=new J,p.style.width=h+"px",this.appendChild(p),f=0}this.style.position="absolute";this.style.display="table";
this.style.width=h+"px";switch(this.options.anchor){case 1:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.bottom="auto";this.style.right="auto";break;case 2:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.width)-parseInt(this.offsetWidth))/2+"px";
this.style.bottom="auto";this.style.right="auto";break;case 3:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.right=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.bottom="auto";this.style.left="auto";break;case 4:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.height)-parseInt(this.offsetHeight))/2+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+
"px";this.style.bottom="auto";this.style.right="auto";break;case 5:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.height)-parseInt(this.offsetHeight))/2+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.width)-parseInt(this.offsetWidth))/2+"px";this.style.bottom="auto";this.style.right="auto";break;case 6:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+
(parseInt(a.usermap[b.usermap].div.style.height)-parseInt(this.offsetHeight))/2+"px";this.style.right=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.bottom="auto";this.style.left="auto";break;case 7:this.style.bottom=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+"px";this.style.top="auto";this.style.right="auto";break;case 8:this.style.bottom=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+
"px";this.style.left=parseInt(a.usermap[b.usermap].div.style.borderWidth)+(parseInt(a.usermap[b.usermap].div.style.width)-parseInt(this.offsetWidth))/2+"px";this.style.top="auto";this.style.right="auto";break;case 9:this.style.bottom=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.right=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px";this.style.top="auto";this.style.left="auto";break;default:this.style.top=parseInt(a.usermap[b.usermap].div.style.borderWidth)+10+
"px",this.style.right=10-parseInt(a.usermap[b.usermap].div.style.borderWidth)+"px",this.style.bottom="auto",this.style.left="auto"}};h.onmouseup=function(a){};h.onmousedown=function(a){};h.onmouseover=function(c){"edit"==a.mode[b.usermap]&&(this.style.cursor="pointer");"edit"==a.mode[b.usermap]&&s(b,c,"Click to select")};h.onmouseout=function(c){"edit"==a.mode[b.usermap]&&(this.style.cursor="auto");"edit"==a.mode[b.usermap]&&C(b)};h.onmousewheel=function(a){};a.div[b.usermap].addEventListener&&h.addEventListener("DOMMouseScroll",
function(a){},!1);h.onclick=function(c){c.stopPropagation&&c.stopPropagation();this._mapdragged||this._transformed||a.div[b.usermap]._mapdragged||"edit"!=a.mode[b.usermap]||(c={event:"click",object:"categorylegend"},window.console&&console.log(JSON.stringify(c)))};a.touchdevices&&(h.ontouchstart=h.ontouchmove=h.ontouchend=function(a){a.stopPropagation&&a.stopPropagation()});h.drawCategoryLegend();return h}}})();